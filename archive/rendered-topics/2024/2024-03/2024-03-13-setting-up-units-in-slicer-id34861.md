# Setting up units in slicer

**Topic ID**: 34861
**Date**: 2024-03-13
**URL**: https://discourse.slicer.org/t/setting-up-units-in-slicer/34861

---

## Post #1 by @coco (2024-03-13 11:37 UTC)

<p>Hi everyone,<br>
I think there are a couple of posts about units some of which have been answered in length such as here: <a href="https://github.com/Slicer/Slicer/issues/5040" rel="noopener nofollow ugc">Fix custom unit management · Issue #5040 · Slicer/Slicer · GitHub</a><br>
But I am finding surprising that by creating a nrrd file using imageJ, set in microm, it can not be recognised as such and converted in mm in slicer automatically.<br>
Is this something that may be fixed in the future ? Could my ImageJ settings be wrong even though metadata clearly show um in imageJ, and changing this to microm does not solve the problem in slicer ?<br>
Thanks</p>

---

## Post #2 by @muratmaga (2024-03-13 17:22 UTC)

<p>Thats probably a problem in ImageJ A functional but incompelete NRRD header looks like this:</p>
<pre><code class="lang-auto">NRRD0004
# This NRRD file was generated by pynrrd
# on 2019-08-02 13:02:24(GMT).
# Complete NRRD file format specification at:
# http://teem.sourceforge.net/nrrd/format.html
type: uint8
dimension: 3
space: right-anterior-superior
sizes: 259 258 421
space directions: (1,0,0) (0,1,0) (0,0,1)
kinds: domain domain domain
encoding: gzip
space origin: (0,0,0)
</code></pre>
<p>spacing comes from the image directions. But without the NRRD field <code>space units</code> (<a href="https://teem.sourceforge.net/nrrd/format.html#spaceunits" class="inline-onebox">Teem: nrrd: Definition of NRRD File Format</a>), it is not clear whether 1 in this case is millimeters, meters, or microns, because there is no explicit unit defined. That’s an unfortunate side effect of NRRD writer used. Possibly that’s what ImageJ is doing that.</p>
<p>if you can obtain the header of the NRRD file you can check it for yourself. If the space unit defined as micron, and slicer is reading it as mm, than that would be a slicer issue and please report to us. Otherwise, if the header is incomplete, there is not much Slicer can do. You will be better of using the ImageStacks in Slicer to avoid issues like this.</p>

---

## Post #3 by @coco (2024-03-14 09:39 UTC)

<p>Thanks Murat,</p>
<p>I have checked nrrd at the end of my ImageJ preprocessing pipeline.<br>
Units are set correctly in the meta data:<br>
space units	“microns” “microns” “microns”.<br>
and I checked the header in a text editor, the units are indeed microns.<br>
<em><strong>indirect question: I haven’t changed ‘microns’ to ‘um’ in my header, would that help ?</strong></em></p>
<p>Opening this correctly set file in Slicer, image spacing is not converted to the right units but keeps the values set by imageJ. So if I have 2 um voxels as defined by my header, I get 2 mm voxels in Slicer. So we are keeping mm as units but manually change the Image spacing to reflect the true voxel sizes as it was suggested in other posts. This should be a quick fix but really my post was about : can we have slicer recognising the units as they seem to be correctly set up in the ImageJ output file.</p>
<p>But there’s more:<br>
Once processed in Slicer (rotation and croping), and saving the corresponding nrrd file, that nrrd file looses the units in the header.</p>
<p><em><strong>Also, indirect question: Is this implying that nrrd is not the best format to work with ? what is a good alternative considering our images are pretty big?</strong></em></p>
<p>Best</p>

---

## Post #4 by @muratmaga (2024-03-14 16:22 UTC)

<aside class="quote no-group" data-username="coco" data-post="3" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://avatars.discourse-cdn.com/v4/letter/c/8797f3/48.png" class="avatar"> coco:</div>
<blockquote>
<p>space units “microns” “microns” “microns”.</p>
</blockquote>
</aside>
<p>I can confirm that if you replace the “micron” with “um” “um” “um” slicer does indeed recognize units as micron. However, there is a weird bug, in which it then multiples those values by 1000, practically bringing the units back to millimeter scale. So for a NRRD header:</p>
<pre><code class="lang-auto">space directions: (35,0,0) (0,35,0) (0,0,35)
space units: "um" "um" "um"
</code></pre>
<p>slicer volumes module report the spacing as 35000 microns.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/c/7ca65d942985dc6ec290443b4fde63d6130eee84.png" data-download-href="/uploads/short-url/hMHDRaSbmyJk1E34qRS4bKIAV8g.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/c/7ca65d942985dc6ec290443b4fde63d6130eee84_2_690x276.png" alt="image" data-base62-sha1="hMHDRaSbmyJk1E34qRS4bKIAV8g" width="690" height="276" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/c/7ca65d942985dc6ec290443b4fde63d6130eee84_2_690x276.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/c/7ca65d942985dc6ec290443b4fde63d6130eee84_2_1035x414.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/c/7ca65d942985dc6ec290443b4fde63d6130eee84.png 2x" data-dominant-color="E8E8E8"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1274×510 26.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><a class="mention" href="/u/lassoan">@lassoan</a> <a class="mention" href="/u/pieper">@pieper</a> can you take a look?</p>
<aside class="quote no-group" data-username="coco" data-post="3" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://avatars.discourse-cdn.com/v4/letter/c/8797f3/48.png" class="avatar"> coco:</div>
<blockquote>
<p><em><strong>Also, indirect question: Is this implying that nrrd is not the best format to work with ? what is a good alternative considering our images are pretty big?</strong></em></p>
</blockquote>
</aside>
<p>I think NRRD is still the best format to use, perhaps until ZARR becomes more mature and commonly available in software package. You have couple options:</p>
<ol>
<li>You can use <code>ImageStacks</code> module in SlicerMorph to import your data into Slicer as opposed to Fiji, and enter the resolution in millimeters scale (so 0.035 as opposed to 35 microns).</li>
<li>You can save your data from fiji, but manually change the headers to bring the scale to mm units and values.</li>
</ol>
<p><a class="mention" href="/u/pieper">@pieper</a> <a class="mention" href="/u/lassoan">@lassoan</a><br>
We really have to fix that because entering a spacing value that is 1.24 microns as 0.00124 requires way to many significant digits, and can potentially cause precision issues during volume calculations and other things.</p>

---

## Post #5 by @coco (2024-03-14 16:29 UTC)

<aside class="quote no-group" data-username="coco" data-post="3" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://avatars.discourse-cdn.com/v4/letter/c/8797f3/48.png" class="avatar"> coco:</div>
<blockquote>
<p>But there’s more:<br>
Once processed in Slicer (rotation and croping), and saving the corresponding nrrd file, that nrrd file looses the units in the header.</p>
</blockquote>
</aside>
<p>Thanks Murat,<br>
and I agree having something reliable in terms of units would be ideal.<br>
What about this part of my post:<br>
<strong>Once processed in Slicer (rotation and croping), and saving the corresponding nrrd file, that nrrd file looses the units in the header.</strong><br>
Is this expected behaviour. I use the latest stable version (5.6.1) on linux</p>
<p>thanks again for all your hard work and making this tool available to the community</p>

---

## Post #6 by @pieper (2024-03-15 19:00 UTC)

<p>My experience is that expressing everything in mm is the most reliable path.  The units infrastructure in Slicer works for some things but probably not all.  It was added after the core code was in place.</p>
<p>I realize that for small specimens using mm could cause numerical instability, but I haven’t seen that tested thoroughly.  Perhaps try your desired operations in by making using the true small spacing in mm or by pretending that microns are mm and converting back to um in the end and see if the results are significantly different.  Then compare that with using the um and the units infrastructure.  Reporting issues based on this analysis could help narrow down where units support needs work and how it should be prioritized.</p>

---

## Post #7 by @muratmaga (2024-03-15 19:33 UTC)

<aside class="quote no-group" data-username="pieper" data-post="6" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>My experience is that expressing everything in mm is the most reliable path. The units infrastructure in Slicer works for some things but probably not all. It was added after the core code was in place.</p>
</blockquote>
</aside>
<p>The other issue is data interoperability. We do need the specify the units of the data saved in NRRD, which appears is currently missing in files written by Slicer.</p>
<aside class="quote no-group" data-username="pieper" data-post="6" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>Perhaps try your desired operations in by making using the true small spacing in mm or by pretending that microns are mm and converting back to um in the end and see if the results are significantly different.</p>
</blockquote>
</aside>
<p>Yes, we are testing this and will report back.</p>

---

## Post #8 by @muratmaga (2024-03-17 05:02 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="7" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>Yes, we are testing this and will report back.</p>
</blockquote>
</aside>
<p>Here are some results.</p>
<p>I loaded the same volume twice. One has the image spacing 0.00125mm, and the other one is 1.25 mm. In this case we are pretending we have a 1.25 micrometer resolution.</p>
<p>Then I segmented 3D sphere using 10% diameter of screen resolution, and the proceed to calculate label statistics.</p>
<p>The good news on this part is results are correct.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/4/b44e599d289f4736d03c1570d617a3709fa7c09b.png" data-download-href="/uploads/short-url/pJ3O9p2sNr3JJ0s00OgRJ2rRveP.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/4/b44e599d289f4736d03c1570d617a3709fa7c09b.png" alt="image" data-base62-sha1="pJ3O9p2sNr3JJ0s00OgRJ2rRveP" width="690" height="51" data-dominant-color="DFDFDF"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1210×90 10.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/f/a/fab7a5a0ff69597a59b5b8be4b7b494243cb0220.png" data-download-href="/uploads/short-url/zLWPqtJ9f3qPWp8f6s53qt9blKg.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/f/a/fab7a5a0ff69597a59b5b8be4b7b494243cb0220_2_690x58.png" alt="image" data-base62-sha1="zLWPqtJ9f3qPWp8f6s53qt9blKg" width="690" height="58" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/f/a/fab7a5a0ff69597a59b5b8be4b7b494243cb0220_2_690x58.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/f/a/fab7a5a0ff69597a59b5b8be4b7b494243cb0220_2_1035x87.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/f/a/fab7a5a0ff69597a59b5b8be4b7b494243cb0220.png 2x" data-dominant-color="E2E2E3"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1220×104 16.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Obviously some programs may not like the precision required for such small numbers, but at least we are not seeing a loss of precision within Slicer. Not sure what would happen if I go one order magnitude down, though. With lightsheet and confocal microscopy it is possible to image below micron resolution routinely.</p>
<p>Then I converted these segmentation to models, and that’s where we have a problem:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/1/61811249c1e733d32bff57f94b2de5548ed6b9c8.png" data-download-href="/uploads/short-url/dUyQDdYwwm7KeGqxcDK8X4B0NTy.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/1/61811249c1e733d32bff57f94b2de5548ed6b9c8_2_690x168.png" alt="image" data-base62-sha1="dUyQDdYwwm7KeGqxcDK8X4B0NTy" width="690" height="168" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/1/61811249c1e733d32bff57f94b2de5548ed6b9c8_2_690x168.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/1/61811249c1e733d32bff57f94b2de5548ed6b9c8_2_1035x252.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/1/61811249c1e733d32bff57f94b2de5548ed6b9c8.png 2x" data-dominant-color="ECECEC"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1230×300 27.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/6/26724459990c2f3e1e79ea8aa311120a4b4a1536.png" data-download-href="/uploads/short-url/5u6Xvo8cRTqY76JZDBn2rcCiG6a.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/6/26724459990c2f3e1e79ea8aa311120a4b4a1536_2_690x180.png" alt="image" data-base62-sha1="5u6Xvo8cRTqY76JZDBn2rcCiG6a" width="690" height="180" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/6/26724459990c2f3e1e79ea8aa311120a4b4a1536_2_690x180.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/6/26724459990c2f3e1e79ea8aa311120a4b4a1536_2_1035x270.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/6/26724459990c2f3e1e79ea8aa311120a4b4a1536.png 2x" data-dominant-color="ECECEC"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1228×322 17.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>The volume and SA of the model created from 0.00125 lost a lot of significance as it is reported. The precision of the displayed fields cannot be increased by the usual CTRL+ (I assume that’s because they are not user editable fields).</p>
<p><a class="mention" href="/u/coco">@coco</a> for the being, if you can set the units in Fiji to mm, and then calibrate and export your data from it, I think you will be fine.</p>
<p><a class="mention" href="/u/lassoan">@lassoan</a> <a class="mention" href="/u/pieper">@pieper</a> but the lack of space units field in the Slicer written NRRD needs to be addressed. That’s a data integrity and interoperability issue.</p>

---

## Post #9 by @pieper (2024-03-17 15:21 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="8" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p><a class="mention" href="/u/coco">@coco</a> for the being, if you can set the units in Fiji to mm, and then calibrate and export your data from it, I think you will be fine.</p>
</blockquote>
</aside>
<p>Yes, IMO this is still the recommended approach.</p>
<aside class="quote no-group" data-username="muratmaga" data-post="8" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p><a class="mention" href="/u/lassoan">@lassoan</a> <a class="mention" href="/u/pieper">@pieper</a> but the lack of space units field in the Slicer written NRRD needs to be addressed. That’s a data integrity and interoperability issue.</p>
</blockquote>
</aside>
<p>Yes, that one sounds pretty straightforward.</p>
<aside class="quote no-group" data-username="muratmaga" data-post="8" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>Here are some results.</p>
</blockquote>
</aside>
<p>Thanks for investigating this.  Agreed, getting units support to work well is an important feature that requires more work.</p>

---

## Post #10 by @lassoan (2024-03-18 02:44 UTC)

<p>We have an issue where we collect all the problems (mostly incomplete implementations) related to units. The hardcoded unit in Models module’s Information section is already included.</p>
<p>The fix for the model information section may be very simple: set the quantity property in the spinbox widget that displays the result.</p>

---

## Post #11 by @coco (2024-03-18 14:32 UTC)

<p>Thanks all for all your feedback on this,<br>
As far as I can see, the model information does not allow setting the number of digits so I am not sure if what you say Andras (re easy fix for model informations) are instructions to users or developpers.<br>
In any case, the model information tab would not be used to extract datas, correct ? I have only started playing with models and metrics we used were extracted directly from segments which according to Murat, do not have issues.</p>
<p>Thanks again for looking into this.</p>

---

## Post #12 by @lassoan (2024-05-30 13:04 UTC)

<aside class="quote no-group" data-username="coco" data-post="11" data-topic="34861">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://avatars.discourse-cdn.com/v4/letter/c/8797f3/48.png" class="avatar"> coco:</div>
<blockquote>
<p>I am not sure if what you say Andras (re easy fix for model informations) are instructions to users or developpers.</p>
</blockquote>
</aside>
<p>You can adjust the precision for surface area display in application settings / Units section. The only problem is that the widget that displays the surface area in Models module does not use this setting, so a little development work is needed.</p>

---
