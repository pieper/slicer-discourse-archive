# How can I draw normal vectors of a centerline in the 3D slicer?

**Topic ID**: 37933
**Date**: 2024-08-18
**URL**: https://discourse.slicer.org/t/how-can-i-draw-normal-vectors-of-a-centerline-in-the-3d-slicer/37933

---

## Post #1 by @mssm (2024-08-18 17:11 UTC)

<p>Dear respected experts,</p>
<p>Please teach me how to draw normal vectors in the 3D slicer.</p>
<p>I want to draw the normal vectors of the centerline of blood vessels obtained by VMTK’s “Extract centerline” module to visualize the torsions of blood vessels. However, despite googling the 3D slicer forum or other WEB resources, I don’t know how to do it.</p>
<p>I know the centerline markup created with VMTK contains a tangent vector, normal vector, and binormal vector at each control point, and they can be extracted as Numpy arrays. I want to display these vectors at each control point.</p>
<p>I would be deeply grateful if you could provide me with some hints on how to do it or where to look.</p>
<p>Regards,</p>
<p>A neurosurgeon from Japan</p>

---

## Post #2 by @chir.set (2024-08-18 20:33 UTC)

<aside class="quote no-group" data-username="mssm" data-post="1" data-topic="37933">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/mssm/48/76622_2.png" class="avatar"> mssm:</div>
<blockquote>
<p>draw the normal vectors of the centerline</p>
</blockquote>
</aside>
<p>I have been curious enough about the ‘torsion’ you mentioned. The quick-and-dirty function below creates a Model node mapping the normals along a centerline curve generated by the ‘Extract centerline’ module.</p>
<p>The ‘torsion’ is not really apparent on the few centerlines I have tested. If you can, please post a demonstrative image.</p>
<pre><code class="lang-auto">def showCenterlineCurveNormals(curveNode):
    curve = curveNode.GetCurveWorld()
    normals = curve.GetPointData().GetArray("Normals")
    numberOfPoints = curve.GetNumberOfPoints()
    
    points = vtk.vtkPoints()
    visuals = vtk.vtkPolyData()
    visuals.AllocateEstimate(numberOfPoints, 2)
    visuals.SetPoints(points)
    
    for i in range(numberOfPoints):
        p1 = curve.GetPoint(i)
        p2 = [0.0] * 3
        normal = normals.GetTuple3(i)
        vtk.vtkMath().Add(normal, p1, p2)
        
        cellIds = vtk.vtkIdList()
        id = points.InsertNextPoint(p1)
        cellIds.InsertNextId(id)
        id = points.InsertNextPoint(p2)
        cellIds.InsertNextId(id)
        
        visuals.InsertNextCell(vtk.VTK_POLY_LINE, cellIds)
    
    visuals.Squeeze()
    model = slicer.modules.models.logic().AddModel(visuals)
</code></pre>

---

## Post #3 by @mssm (2024-08-18 23:39 UTC)

<p>Dear chir.set SET,</p>
<p>Than you very much for your help.<br>
I am going to try your code.</p>
<p>I am attaching the image of a case of internal carotid artery with coloring according to curvature and torsion.</p>
<p>I would like to utilize the torsion of vessel in some way.</p>
<p>Regards,</p>
<p>Masaaki</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/6/66ab3585b1f41b82844134f9474fff6c9e50639c.jpeg" data-download-href="/uploads/short-url/eEfvYsJcnSoFRuwA4YgQ7RrzWVK.jpeg?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66ab3585b1f41b82844134f9474fff6c9e50639c_2_690x387.jpeg" alt="image" data-base62-sha1="eEfvYsJcnSoFRuwA4YgQ7RrzWVK" width="690" height="387" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66ab3585b1f41b82844134f9474fff6c9e50639c_2_690x387.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66ab3585b1f41b82844134f9474fff6c9e50639c_2_1035x580.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66ab3585b1f41b82844134f9474fff6c9e50639c_2_1380x774.jpeg 2x" data-dominant-color="AAA9D4"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1077 83 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #4 by @lassoan (2024-08-19 08:17 UTC)

<p>You can easily draw the tangent, normal, and binormal vector directions for a curve. We normally use this for testing. How to get this feature:</p>
<ol>
<li>Open the Python console in Slicer (<code>Ctrl</code>+<code>3</code>)</li>
<li>Copy-paste the <a href="https://github.com/Slicer/Slicer/blob/bf4af8a947a6bf080ce09a199c379cdb4394e7ae/Modules/Loadable/Markups/Testing/Python/MarkupsCurveCoordinateFrameTest.py#L14-L76">vector drawing code</a> from into the Python console</li>
<li>Draw normals for the first curve in the scene by copy-pasting this code into the Python console:</li>
</ol>
<pre data-code-wrap="python"><code class="lang-python">curveNode = slicer.mrmlScene.GetFirstNodeByClass("vtkMRMLMarkupsCurveNode")
addCoordinateSystemUpdater(createCoordinateSystemsModel(curveNode))
</code></pre>
<p></p><div class="video-placeholder-container" data-video-src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/a/e/aefd4d5f974008a58132029848bfdae1330691ab.mp4" data-thumbnail-src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/b/db984fbc37996b411bd121af843e0d88eb3a2f4a.png">
  </div><p></p>

---

## Post #5 by @mssm (2024-08-19 08:38 UTC)

<p>Dear Andras Lasso sensei,</p>
<p>Thanks a lot.</p>
<p>I tried the magic code right away. However, I got the error message as shown in the attached image.</p>
<p>Could you please help me again?</p>
<p>I also looked into “addCoordinateSystemUpdator”. For some reason, I couldn’t use it in my environment.</p>
<p>MacStudio, M2, MacOS Sonoma 14.6.1<br>
Slicer 5.6.2 r32448 / f10cd8c</p>
<p>Regards,</p>
<p>Masaaki</p>
<p>By the way, when application is starting, such messages appears in the python console:</p>
<p>Python 3.9.10 (main, Apr  5 2024, 00:33:09)<br>
[Clang 14.0.6 (<a href="https://github.com/tru/llvm-release-build" rel="noopener nofollow ugc">https://github.com/tru/llvm-release-build</a> 686807a176470032c208f2 on darwin</p>
<blockquote>
<blockquote>
<blockquote></blockquote>
</blockquote>
</blockquote>
<p>Failed to load vtkSlicerCrossSectionAnalysisModuleLogicPython: No module named vtkSlicerShapeModuleMRMLPython<br>
Failed to load vtkSlicerStenosisMeasurement3DModuleLogicPython: No module named vtkSlicerShapeModuleMRMLPython<br>
[Qt]   Error(s):<br>
[Qt]     CLI executable: /Applications/Slicer.app/Contents/Extensions-32448/SlicerVMTK/lib/Slicer-5.6/qt-loadable-modules/vtkvmtk.py<br>
[Qt]     The process failed to start. Either the invoked program is missing, or you may have insufficient permissions to invoke the program.<br>
[Qt] Fail to instantiate module  “vtkvmtk”<br>
[Qt] The following modules failed to be instantiated:<br>
[Qt]    vtkvmtk<br>
[Qt] Populating font family aliases took 92 ms. Replace uses of missing font family “.AppleSystemUIFont” with one that exists to avoid this cost.<br>
[FD] 2024-08-19 17:49:10.513 Slicer[69837:4024985] NSEventModifierFlagFunction specified to -setKeyEquivalentModifierMask: for item &lt;NSMenuItem: 0x600007cd9570 PopClipãè¡¨ç¤º, ke=‘Command-F15’&gt;, but is only supported for system-provided menu items; will not be used</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/6/76bbf89393e57e02fe5efc08f118dda476ebf3e2.jpeg" data-download-href="/uploads/short-url/gWn4bzBlaz6MDPIMJHAisSr6dge.jpeg?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/6/76bbf89393e57e02fe5efc08f118dda476ebf3e2_2_690x352.jpeg" alt="image" data-base62-sha1="gWn4bzBlaz6MDPIMJHAisSr6dge" width="690" height="352" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/6/76bbf89393e57e02fe5efc08f118dda476ebf3e2_2_690x352.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/6/76bbf89393e57e02fe5efc08f118dda476ebf3e2_2_1035x528.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/6/76bbf89393e57e02fe5efc08f118dda476ebf3e2_2_1380x704.jpeg 2x" data-dominant-color="D1CEE2"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1870×956 116 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #6 by @lassoan (2024-08-19 09:54 UTC)

<p>You need to copy the highlighted piece of code from github to the Slicer Python console. It will fix the <code>... not defined</code> error in the screenshot. You can ignore the messages that are logged during startup.</p>

---

## Post #7 by @mssm (2024-08-19 23:00 UTC)

<p>Thank you so much.<br>
You are working hard and helping many researchers. Take care !<br>
Regards,</p>

---
