# Import nifti segmentation files

**Topic ID**: 35423
**Date**: 2024-04-11
**URL**: https://discourse.slicer.org/t/import-nifti-segmentation-files/35423

---

## Post #1 by @ssfzzzc (2024-04-11 04:53 UTC)

<p>I trained a CT segmentation model that saves its result (n x 512 x 512 binary label map) into a .nii.gz file.   I tried to import the segmentation file into slicer, but the segmentation mask always appeared outside the CT image. I tried to change orientation, change dimension order and save the result in .nrrd format, none worked, mask always appeared outside CT image. ITK-snap however had no difficulty load the result and the mask was  in correct position. What should i do to make its result accessible to slicer? Does it have anything to do with orientation? Thanks in advance.</p>

---

## Post #2 by @pieper (2024-04-11 18:53 UTC)

<p>You’ll find a lot of information about nifti orientation issues in the forum.</p>
<p>This thread might help:</p>
<aside class="quote quote-modified" data-post="1" data-topic="24495">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://avatars.discourse-cdn.com/v4/letter/g/b3f665/48.png" class="avatar">
    <a href="https://discourse.slicer.org/t/open-nifti-in-3d-slicer/24495">Open Nifti in 3D Slicer</a> <a class="badge-category__wrapper " href="/c/support/11"><span data-category-id="11" style="--category-badge-color: #3AB54A; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="The Support category is for all usage questions and general discussion of Slicer and extensions."><span class="badge-category__name">Support</span></span></a>
  </div>
  <blockquote>
    I usually converted the image data from our small animal PET scanner into Nifti to be able to open it in slicer. In the newer versions we have problems and get an error message. Neither newly converted data nor Nifti files that were previously already opened in slicer still work. 
“Error occured while loading selected files.” Details: “Error: Loading (path+file name) -  load failed.” 
In version 4.10.xx it still works, in all versions 5.0x it does not work. I am using the windows-version. 
Is th…
  </blockquote>
</aside>


---

## Post #3 by @ssfzzzc (2024-04-12 08:03 UTC)

<p>Thank you for your reply.<br>
In fact my problem is not with NIFTI. I just want Slicer to recognize a numpy binary labelmap. I read the thread you provided. I saved that numpy array in nrrd form using pynrrd, and tried to give it different headers. I almost tried every combination of orientation, direction and RAS spaces, none of them worked. Slicer can read the mask file, but the segmentation mask always appeared outside the CT image. In fact I had no problem loading segmentation generated by Slicer using SimpleITK, but Slicer just cannot correctly recognize any segmentation that is not generated by itself. I really don’t know what should I do to make it work…</p>

---

## Post #4 by @pieper (2024-04-12 18:34 UTC)

<p>If you are really stuck making a nifti file work, but you know the numpy data is in the same pixel space as the volume you can do something like this:</p>
<pre><code class="lang-auto">    volumeNode = slicer.util.loadVolume(volumePath, properties={"singleFile": True})
    prob = numpy.load(probPath)['probabilities'][1] * 1000
    ijkToRAS = vtk.vtkMatrix4x4()
    volumeNode.GetIJKToRASMatrix(ijkToRAS)
    probNode = slicer.util.addVolumeFromArray(prob, name ="prob", ijkToRAS=ijkToRAS)
</code></pre>

---
