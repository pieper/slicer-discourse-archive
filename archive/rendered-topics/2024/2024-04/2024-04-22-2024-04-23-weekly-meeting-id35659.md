---
topic_id: 35659
title: "2024 04 23 Weekly Meeting"
date: 2024-04-22
url: https://discourse.slicer.org/t/35659
---

# 2024.04.23 Weekly Meeting

**Topic ID**: 35659
**Date**: 2024-04-22
**URL**: https://discourse.slicer.org/t/2024-04-23-weekly-meeting/35659

---

## Post #1 by @Sam_Horvath (2024-04-22 20:31 UTC)

<p>Tomorrow, we will be having our next weekly hangout at <strong>10:00 AM ET until 11:00 AM ET</strong> .</p>
<p>Anyone is welcome to join at this link: <a href="https://bit.ly/slicer-googlemeet-hosted-by-kitware">https://bit.ly/slicer-googlemeet-hosted-by-kitware</a></p>
<hr>
<div class="discourse-post-event" data-start="2024-04-23 10:00" data-status="public" data-name="Weekly Meeting" data-url="https://bit.ly/slicer-googlemeet-hosted-by-kitware" data-timezone="America/New_York" data-allowed-groups="trust_level_0"></div>
<p><strong>Agenda:</strong></p>
<p>Please post to this thread to put a topic on the agenda!  We will try to prioritize agenda items during the meeting.</p>
<hr>
<p>Thanks<br>
Sam and J-Christophe</p>

---

## Post #2 by @evaherbst (2024-04-23 11:10 UTC)

<p>I would like to discuss 1) modifying the TotalSegmentator widget as suggested in <a href="https://discourse.slicer.org/t/running-totalsegmentator-from-python-console/35461/13">this thread</a> and 2) <a href="https://discourse.slicer.org/t/totalsegmentator-extra-task-license-not-saved-in-slicer-6-2/35622/3">fixing my issue</a> with TotalSegmentator license not being saved</p>

---

## Post #3 by @jcfr (2024-04-23 13:20 UTC)

<p>Discuss and finalize these two pull requests:</p>
<ul>
<li><a href="https://github.com/Slicer/ExtensionsIndex/pull/2011">ExtensionsIndex#2011</a>: CI: Transition from s4ext to json</li>
<li><a href="https://github.com/Slicer/Slicer/pull/7629">Slicer#7629</a>: Switch extension index entry format from “s4ext” to “json”</li>
</ul>
<p>Notes:</p>
<ul>
<li>Added support for using a restricted set of HTML tags in extension description  through <a href="https://github.com/girder/slicer_package_manager/pull/123">girder/slicer_package_manager#123</a> and <a href="https://github.com/KitwareMedical/slicer-extensions-webapp/pull/159">KitwareMedical/slicer-extensions-webapp#159</a>.</li>
</ul>
<p>Related posts:</p>
<ul>
<li><a href="https://discourse.slicer.org/t/introduction-of-tiers-for-slicer-extensions/34870" class="inline-onebox">Introduction of "tiers" for Slicer extensions</a></li>
</ul>

---

## Post #4 by @allemangd (2024-04-23 13:31 UTC)

<p>Discuss revision of proposal for scripted modules requirements.txt support following last week’s feedback.</p>
<aside class="onebox githubissue" data-onebox-src="https://github.com/Slicer/Slicer/issues/7707">
  <header class="source">

      <a href="https://github.com/Slicer/Slicer/issues/7707" target="_blank" rel="noopener nofollow ugc">github.com/Slicer/Slicer</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/Slicer/Slicer/issues/7707" target="_blank" rel="noopener nofollow ugc">Allow scripted modules to declare and lazily install pip requirements</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-04-22" data-time="20:15:54" data-timezone="UTC">08:15PM - 22 Apr 24 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/allemangD" target="_blank" rel="noopener nofollow ugc">
          <img alt="allemangD" src="https://avatars.githubusercontent.com/u/10702931?v=4" class="onebox-avatar-inline" width="20" height="20">
          allemangD
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          make-simple-things-simple
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Continuation of #7697; tightly coupled to #7171 and #6913.

After discussion a<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">nd feedback at the weekly hangout Apr 16 (see https://github.com/Slicer/Slicer/issues/7697#issuecomment-2059271196 and https://github.com/Slicer/Slicer/issues/7697#issuecomment-2059273077) I think my first issue conflated three separate tasks:

- Declare and install dependencies
- Run modules in an isolated subprocess (CLI modules)
- Run modules in an isolated environment (venv, conda, poetry, etc)

I'm interested in tackling only the first of these, and since CLI have questionable value anyway it doesn't make sense to require CLI usage to get the benefit here. Really, what we want is a way for scripted module's logic to depend on pypi packages, and only install those packages when they are needed. Doing this purely in the Python layer allows all scripted modules to benefit.

## Draft implementation and features

I have a Python 3.9 draft implementation of a `LazyImportGroup` context manager, based on the [`LazyLoader`](https://docs.python.org/3/library/importlib.html#importlib.util.LazyLoader) and [`lazy_import` recipe](https://docs.python.org/3/library/importlib.html#implementing-lazy-imports) in the standard library `importlib` documentation.

https://github.com/allemangD/lazyloader - see the doctests for `LazyImportGroup` for more details.

The important principles here are:

- Consolidate. Keep all `import` statements at top-level, all dependencies in `requirements.txt`.
- Lazy. Do not install or import expensive libraries until they are used.
- Reliable. Do not import libraries unless they are guaranteed to be available in a user's environment.

These were not mentioned during the discussion last week, but I think they are important:

- Support static analysis.
- Be explicit about when "magic" occurs.

---

Usage requires the extension developer place a `requirements.txt` in a python package, installed via `RESOURCES` argument of the existing CMake macros. The [anchor and path](https://docs.python.org/3/library/importlib.resources.html#importlib.resources.files) for that `requirements.txt` resource are given as an argument to `LazyImportGroup` context manager, wrapping top-level imports.

```py
with LazyImportGroup('lib:requirements.txt'):
  import lib.logic
  import itk
```

These imports are real import statements that are detected by static analysis, and run-time magic only occurs with imports within the context manager. These imports produce proxy modules that defer install and real import until first usage:

```py
def onApplyButton(self):
  lib.logic.do_the_task(...)
  #        ^ attribute access triggers install and import

def onComputeButton(self):
  itk.Fpfh....
  #  ^ attribute access triggers install and import
```

---

Modules imported within a `LazyImportGroup` can safely have bare top-level imports of their dependencies. This is probably recommended usage for this tool:

```
qt-scripted-modules
|- libCompute
|   |- __init__.py
|   |- requirements.txt
|   \- logic.py
\- Compute.py
```

Above, `__init__.py` and `train` can safely include their dependencies at top level, as long as `Compute.py` imports them in a lazy group:

```
# requirements.txt
A
B
```

```py
# train.py
import A
```

```py
# __init__.py
import B
from .logic import ...
```

```py
# Compute.py
with LazyImportGroup('libCompute:requirements.txt'):
  import libCompute
  import libCompute.logic
```

---

Only the first attribute access of a module in a group will trigger the installation for all imports in that group. There may be multiple groups with different requirements to denote multiple feature sets, and only the used features will be installed. Each group is installed at most a single time.

```py
with LazyImportGroup('lib:training-requirements.txt'):
   import X
   import Y

with LazyImportGroup('libinference:requirements.txt'):
   import Z
```

The first attribute access of X or Y will install `training-requirements.txt`, and the first attribute access of Z will install `inference-requirements.txt`.

A fast `pip install --no-deps --dry-run --report` check is first used to ensure all the items in `requirements.txt` are satisfied. If so, no action is taken, the module is imported, and the proxy module is updated. If not, the requirements are first installed with `pip install -r`.

The dry-run report is used to produce a summary of packages to be installed. The Slicer implementation should show this to the user with `slicer.util.confirmOkCancelDisplay`.

Not implemented in the draft, but the report and install steps could accept a `-c constraints.txt` argument to pin Slicer libraries like `numpy`, `SimpleITK`, etc. Also the requirements of other groups could be inspected to detect incompatibilities with messages like: "Module X wants to install package Y which is incompatible with module Z. Proceed?"

---

I've tested these proxy objects on plain python packages, loadable packages, and even `itk`'s complex lazy-loaded metapackage. It works on all of these, although there are some caveats on object identity and safe import order. See the doctests for details.

## Outstanding questions

- Where to place this? Suggest `slicer.LazyImportGroup`.
- Bikeshed the name? Signature? It also does pip installations.
- Best practices on confirmation dialog?
- Should constraints files or compatibility checks between modules be part of this initial feature? Or should they be delayed till we see usage in practice.

---

From prior discussions: cc @jcfr @pieper @lassoan @ebrahimebrahim</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>


---

## Post #5 by @jcfr (2024-04-23 17:28 UTC)

<h3><a name="p-110073-meeting-notes-1" class="anchor" href="#p-110073-meeting-notes-1" aria-label="Heading link"></a>Meeting notes</h3>
<ul>
<li>Comment on SlicerWMA extension renaming
<ul>
<li>See <a href="https://github.com/Slicer/ExtensionsIndex/pull/2039#discussion_r1576314015">https://github.com/Slicer/ExtensionsIndex/pull/2039#discussion_r1576314015</a></li>
</ul>
</li>
<li>TotalSegmentator
<ul>
<li>Discussed <a href="https://discourse.slicer.org/t/running-totalsegmentator-from-python-console/35461/13">this thread</a></li>
<li>Suggested path forward: Add an interactive option</li>
</ul>
</li>
<li>artisynth
<ul>
<li>Combined MultiBody/FEM Simulation</li>
<li><a href="https://www.artisynth.org/Software/Documentation" class="inline-onebox">ArtiSynth | Software / Documentation</a></li>
<li><a href="https://github.com/artisynth" class="inline-onebox">artisynth · GitHub</a></li>
</ul>
</li>
<li><a href="https://github.com/Slicer/slicer-media-assets">slicer-media-assets</a>
<ul>
<li>Added <code>QStyled</code> variation</li>
<li>Transition to <code>README.md</code></li>
<li>Use <a href="https://hackmd.io/">https://hackmd.io/</a> by first copying <code>README.txt</code> and modiyfing it</li>
</ul>
</li>
<li>Extension Index: Transition from s4ext to json. Pull requests ready for review
<ul>
<li><a href="https://github.com/Slicer/ExtensionsIndex/pull/2011">ExtensionsIndex#2011</a>: CI: Transition from s4ext to json</li>
<li><a href="https://github.com/Slicer/Slicer/pull/7629">Slicer#7629</a>: Switch extension index entry format from “s4ext” to “json”</li>
</ul>
</li>
<li>Proposal for scripted modules <code>requirements.txt</code> support
<ul>
<li><a href="https://github.com/Slicer/Slicer/issues/7707">Slicer#7707</a>: Allow scripted modules to declare and lazily install pip requirements</li>
<li>Follow-up notes posted at <a href="https://github.com/Slicer/Slicer/issues/7707#issuecomment-2072745362" class="inline-onebox">Allow scripted modules to declare and lazily install pip requirements · Issue #7707 · Slicer/Slicer · GitHub</a></li>
</ul>
</li>
<li>SlicerTelemetry
<ul>
<li>Working on identifying URL for mapping with specific “action” and associated data to log</li>
</ul>
</li>
<li>Training
<ul>
<li>Example of portal: <a href="http://www.graysvertebrateanatomy.com/work/3d-imaging-resources/">http://www.graysvertebrateanatomy.com/work/3d-imaging-resources/</a></li>
</ul>
</li>
</ul>

---

## Post #6 by @pieper (2024-04-23 17:53 UTC)

<aside class="quote no-group" data-username="jcfr" data-post="5" data-topic="35659">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/jcfr/48/17825_2.png" class="avatar"> jcfr:</div>
<blockquote>
<ul>
<li>Training
<ul>
<li>Example of portal: <a href="http://www.graysvertebrateanatomy.com/work/3d-imaging-resources/">http://www.graysvertebrateanatomy.com/work/3d-imaging-resources/</a></li>
</ul>
</li>
</ul>
</blockquote>
</aside>
<p>This portal is really nice.  Be sure to check out this Quick Guide document.  It nicely summarizes the steps in a workflow and each slicer icon is a deep link into a demo video illustrating the use of the tool.  It’s designed for biology samples but it’s a great resource for anyone doing segmentation and analysis:</p>
<p><a href="http://www.graysvertebrateanatomy.com/__static/c0e61a322fc1f771762f9a4d60fbf7ee/gray-3d-slicer-quick-guide.pdf?dl=1" class="onebox" target="_blank" rel="noopener">http://www.graysvertebrateanatomy.com/__static/c0e61a322fc1f771762f9a4d60fbf7ee/gray-3d-slicer-quick-guide.pdf?dl=1</a></p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/b/5b1b19e5e72c1564ccf776942c0798ad7039ad08.png" data-download-href="/uploads/short-url/cZXvQZXLXrybuQ4np2ItnI3xFmE.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/5/b/5b1b19e5e72c1564ccf776942c0798ad7039ad08_2_690x438.png" alt="image" data-base62-sha1="cZXvQZXLXrybuQ4np2ItnI3xFmE" width="690" height="438" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/5/b/5b1b19e5e72c1564ccf776942c0798ad7039ad08_2_690x438.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/b/5b1b19e5e72c1564ccf776942c0798ad7039ad08.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/b/5b1b19e5e72c1564ccf776942c0798ad7039ad08.png 2x" data-dominant-color="A3998F"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">998×634 178 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><p></p>

---
