# How to handle the new parameter node wrapper?

**Topic ID**: 33957
**Date**: 2024-01-24
**URL**: https://discourse.slicer.org/t/how-to-handle-the-new-parameter-node-wrapper/33957

---

## Post #1 by @chir.set (2024-01-24 20:53 UTC)

<p>Hi <a class="mention" href="/u/lassoan">@lassoan</a>, <a class="mention" href="/u/pieper">@pieper</a>, <a class="mention" href="/u/jcfr">@jcfr</a>, <span class="mention">@devs</span>,</p>
<p>I am in the process of porting some modules of SlicerVMTK to the new parameter node wrapper. A sample port is available in this <a href="https://github.com/chir-set/SlicerExtension-VMTK/tree/SampleNewParameterNodePort" rel="noopener nofollow ugc">branch</a>.</p>
<p>I am requesting advice about handling things basically and in complicated cases.</p>
<ol>
<li>In the QuickArterySegmentation module of the above branch, I made the parameter node available in the logic class since it is generated by the logic class itself. The parameter node references input objects that are mapped by the wrapper to UI elements in the widget class, and also output objects that appear in the views but not as module widget elements. I wish to know if this is an acceptable way to do things.</li>
</ol>
<p>The described approach implies also that during Python scripting, all input and output nodes must be directly get/set using the parameter node referenced in the logic class.</p>
<p>Otherwise, the input/output elements will have to be declared as members of the logic class and accessed directly or through accessor functions, or passed as parameters to functions of the logic class.</p>
<ol start="2">
<li>
<p>A member of the *ParameterNode class must be declared with a known data type. Python does not seem to have a variant data type. This is a problem for a qMRMLNodeComboBox that can accept many vtkMRMLNode derived classes. I didn’t find any solution for this and see it as a limitation of the new parameter node design. Please advise about this.</p>
</li>
<li>
<p>The *ParameterNode class does not handle some widgets, like ctkSliders* (used very often), qMRMLSpinBox and qMRMLSegmentSelectorWidget. This is another limitation that would probably be fixed when possible.</p>
</li>
</ol>
<p>Considering these limitations, it may not be possible to always use the new parameter node wrapper. A mix up of the old and the new handling methods would have to be done, which would put the new design in question.</p>
<p>Regarding SlicerVMTK, the port is relatively trivial for StenosisMeasurement1D, StenosisMeasurement2D, QuickArterySegmentation and GuidedArterySegmentation modules. For CrossSectionAnalysis and ExtractCenterline, it’s a headache. As for ExtractCenterline, I did not find a compelling need for any change.</p>
<p>Thank you for any comment.</p>
<p>Regards.</p>

---

## Post #2 by @pieper (2024-01-24 22:42 UTC)

<p>Thanks for investigating this.  I haven’t used hte ParameterNodeWrapper approach myself so I can’t advise in detail.  My understanding is that it does have a limited initial feature set and that not all use cases would be a good fit for it.  Others who know the code base should chime in on how good a fit the parameter node wrappers are for vmtk.</p>

---

## Post #3 by @chir.set (2024-01-25 19:36 UTC)

<aside class="quote no-group" data-username="pieper" data-post="2" data-topic="33957">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>a limited initial feature set and that not all use cases would be a good fit for it.</p>
</blockquote>
</aside>
<p>Thank you for your reply, I know thence where to stop expecting.</p>
<p>I still wish to know if the usage described in <span class="hashtag-raw">#1</span> is acceptable. Anyone?</p>

---

## Post #4 by @Sam_Horvath (2024-01-25 19:55 UTC)

<p>Hi!</p>
<ol>
<li>
<p>Yes, absolutely.</p>
</li>
<li>
<p>The variant datatype you will want to use here is <code>typing.Union</code> .  We need to expand the documentation on this, but an example-ish can be found here: <a href="https://github.com/Slicer/Slicer/blob/5199545b8b17cee46c801137298087a823e54ca7/Base/Python/slicer/tests/test_slicer_parameter_node_wrapper_gui_creation.py#L70" class="inline-onebox">Slicer/Base/Python/slicer/tests/test_slicer_parameter_node_wrapper_gui_creation.py at 5199545b8b17cee46c801137298087a823e54ca7 · Slicer/Slicer · GitHub</a></p>
</li>
<li>
<p>We are working on adding missing widgets, see this issue: <a href="https://github.com/Slicer/Slicer/issues/7308" class="inline-onebox">Parameter node wrapper GUI connectors are missing for many widgets · Issue #7308 · Slicer/Slicer · GitHub</a></p>
</li>
</ol>

---

## Post #5 by @chir.set (2024-01-25 21:05 UTC)

<p>Thank you <a class="mention" href="/u/sam_horvath">@Sam_Horvath</a> , I know better now how to move forward.</p>

---
