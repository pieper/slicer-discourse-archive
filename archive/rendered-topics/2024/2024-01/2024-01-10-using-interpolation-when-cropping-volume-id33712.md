# Using interpolation when cropping volume

**Topic ID**: 33712
**Date**: 2024-01-10
**URL**: https://discourse.slicer.org/t/using-interpolation-when-cropping-volume/33712

---

## Post #1 by @rsalkin (2024-01-10 04:28 UTC)

<p>Hello,</p>
<p>I am currently using the cropping feature (converters → crop volume) to select a specific ROI on lung CTs. Using the cropping bounding box, I also crop binary tumor segmentations (read as volumes). The “interpolated cropping”, “Linear” is set by default in Slicer during cropping. But when I crop with this option (interpolation selected), the cropped segmentations are different from the original segmentation (see attached img1, and MRIcron images). The tumor boundary is very different and smaller and the imaging is also slightly less sharp. But when I switch off the interpolation, the cropped tumor segmentation is much closer to the original tumor segmentation (see attached img2). I would like to know why this may be happening and if this is commonly seen behavior? Also, would it be ok if I do all my cropping without the interpolation option for both segmentations as well as imaging volumes? Could that cause any issues in any cases? Thank you very much for your advice!</p>
<p>Image 1:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/f/bf2ed23d619104d627c3fe68b128d0b332818738.png" data-download-href="/uploads/short-url/rhhvFYnCKjntSQtCfeQciHkRCkg.png?dl=1" title="cropping_issue" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/f/bf2ed23d619104d627c3fe68b128d0b332818738_2_576x500.png" alt="cropping_issue" data-base62-sha1="rhhvFYnCKjntSQtCfeQciHkRCkg" width="576" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/f/bf2ed23d619104d627c3fe68b128d0b332818738_2_576x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/f/bf2ed23d619104d627c3fe68b128d0b332818738.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/f/bf2ed23d619104d627c3fe68b128d0b332818738.png 2x" data-dominant-color="888889"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">cropping_issue</span><span class="informations">836×725 173 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/1/e100e9bda7851e7b1a52a5e1b37fa98c7638858b.png" data-download-href="/uploads/short-url/w6tnZPjHQB0WK0lTCu5bXDU9KKn.png?dl=1" title="segs_zoomed_in" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/1/e100e9bda7851e7b1a52a5e1b37fa98c7638858b_2_690x443.png" alt="segs_zoomed_in" data-base62-sha1="w6tnZPjHQB0WK0lTCu5bXDU9KKn" width="690" height="443" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/1/e100e9bda7851e7b1a52a5e1b37fa98c7638858b_2_690x443.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/1/e100e9bda7851e7b1a52a5e1b37fa98c7638858b_2_1035x664.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/1/e100e9bda7851e7b1a52a5e1b37fa98c7638858b.png 2x" data-dominant-color="728673"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">segs_zoomed_in</span><span class="informations">1094×703 83 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>MRIcron view:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/8/d/8db5a524ea5816300b5889fa062be07bb47e98d1.png" data-download-href="/uploads/short-url/kdCuLdgYNmmHwoD7jWXtG5bVsxr.png?dl=1" title="segs_view2_mricron" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/8/d/8db5a524ea5816300b5889fa062be07bb47e98d1_2_672x500.png" alt="segs_view2_mricron" data-base62-sha1="kdCuLdgYNmmHwoD7jWXtG5bVsxr" width="672" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/8/d/8db5a524ea5816300b5889fa062be07bb47e98d1_2_672x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/8/d/8db5a524ea5816300b5889fa062be07bb47e98d1.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/8/d/8db5a524ea5816300b5889fa062be07bb47e98d1.png 2x" data-dominant-color="18150C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">segs_view2_mricron</span><span class="informations">941×700 26 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/1/e/1e34ee68c6fec8d2ad5746fbc65a1c0351f56c48.png" data-download-href="/uploads/short-url/4jdJbMrdbYv4GBumgZs46K9EV5u.png?dl=1" title="segs_view1_mricron" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/1/e/1e34ee68c6fec8d2ad5746fbc65a1c0351f56c48_2_690x341.png" alt="segs_view1_mricron" data-base62-sha1="4jdJbMrdbYv4GBumgZs46K9EV5u" width="690" height="341" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/1/e/1e34ee68c6fec8d2ad5746fbc65a1c0351f56c48_2_690x341.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/1/e/1e34ee68c6fec8d2ad5746fbc65a1c0351f56c48_2_1035x511.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/1/e/1e34ee68c6fec8d2ad5746fbc65a1c0351f56c48.png 2x" data-dominant-color="12120D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">segs_view1_mricron</span><span class="informations">1140×564 24.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/5/7532dcd7cc6124238f1c9eb31c0a274a64a242f3.png" data-download-href="/uploads/short-url/gIMPSGfdU6fMFxgxJaWhjvW7fc7.png?dl=1" title="segs_view3_mricron" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/5/7532dcd7cc6124238f1c9eb31c0a274a64a242f3_2_654x500.png" alt="segs_view3_mricron" data-base62-sha1="gIMPSGfdU6fMFxgxJaWhjvW7fc7" width="654" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/5/7532dcd7cc6124238f1c9eb31c0a274a64a242f3_2_654x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/5/7532dcd7cc6124238f1c9eb31c0a274a64a242f3.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/5/7532dcd7cc6124238f1c9eb31c0a274a64a242f3.png 2x" data-dominant-color="191709"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">segs_view3_mricron</span><span class="informations">887×678 25.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Non-interpolated segmentations (image 2) (cropped is green, original yellow):</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/b/dbe7100c742b6ef745577a4c7d2e13b0077cc8d5.jpeg" data-download-href="/uploads/short-url/vnlCacQvRyO15ne3DNsTdlFDDEh.jpeg?dl=1" title="non-interoplated segmentations" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/b/dbe7100c742b6ef745577a4c7d2e13b0077cc8d5_2_520x500.jpeg" alt="non-interoplated segmentations" data-base62-sha1="vnlCacQvRyO15ne3DNsTdlFDDEh" width="520" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/b/dbe7100c742b6ef745577a4c7d2e13b0077cc8d5_2_520x500.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/b/dbe7100c742b6ef745577a4c7d2e13b0077cc8d5_2_780x750.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/b/dbe7100c742b6ef745577a4c7d2e13b0077cc8d5.jpeg 2x" data-dominant-color="5F5B51"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">non-interoplated segmentations</span><span class="informations">1020×980 68 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #2 by @pieper (2024-01-10 15:56 UTC)

<p>Resampling of binary images can be very lossy as you see here when the feature size is close to the resolution of the images, so what you see is not unexpected.  If you can increase the resolution you could get better results.  Or if you know they are binary data (only zero and non-zero, not multiple non-zero values) you can convert to scalar volumes and perhaps blur before cropping and then re-threshold.</p>

---

## Post #3 by @rsalkin (2024-01-11 00:34 UTC)

<p>Thanks for your reply, Steve. Yes, we are interested in cropping binary segmentations; we see this discrepancy more clearly in binary segmentations than image volumes.</p>
<p>A couple of follow-up questions:</p>
<ol>
<li>As seen in the pictures, by disabling the interpolation option while cropping, we are not seeing the discrepancy in binary segmentations anymore for some reason. Could that be a reasonable workaround for this issue?”</li>
<li>By increasing the resolution as you suggest, do you mean resampling the entire binary segmentation into a higher resolution spacing and cropping that? How can we do that in Slicer?</li>
</ol>
<p>Thanks again for your help!</p>

---

## Post #4 by @pieper (2024-01-11 19:23 UTC)

<p>If you are just cropping without transforming (no scaling or rotation) then no interpolation should be used.</p>
<p>If you are applying a transform, then you need to use nearest neighbor in CropVolume for a labelmap to avoid mixing up the segments.  If the resolution isn’t good you may want to increase it first, e.g. by setting the geometry in the SegmentEditor (go back and forth between labelmap volume and segmentation as needed).</p>
<p>If you only have one segment, you can make a continuous tone volume (e.g. a float using CastScalarVolume) after converting a labelmap to a scalar volume in the Volumes module.  Then you can transform the scalar volume with interpolation and then re-threshold to get a more faithful transformed binary segmentation.</p>

---
