---
topic_id: 28943
title: "Nrrd File Cannot Be Reopened After Saving It"
date: 2023-04-16
url: https://discourse.slicer.org/t/28943
---

# .nrrd file cannot be reopened after saving it

**Topic ID**: 28943
**Date**: 2023-04-16
**URL**: https://discourse.slicer.org/t/nrrd-file-cannot-be-reopened-after-saving-it/28943

---

## Post #1 by @Joshua_Binswanger (2023-04-16 19:18 UTC)

<p>Hey Slicer People,</p>
<p>First off: Super powerful and fun to use software! really appreciate all you created and did! Hard to belive all this is free <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>Anyways, I stumbled upon a problem which baffles me a bit. I created some segmentations in the segment editor and everything worked fine. I added another segmentation saved the file and wanted to create a surface representation and the porgram gave me an out of memory error message. I clicked ok, quit the program and wanted to open the file again. Now I want to open the file again (segmentation file saved as seg.nrrd) I get an out of memory error again…</p>
<p>" Slicer has caught an application error, please save your work and restart.</p>
<p>The application has run out of memory. Increasing virtual memory size in system settings or adding more RAM may fix this issue.</p>
<p>If you have a repeatable sequence of steps that causes this message, please report the issue following instructions available at <a href="https://slicer.org" rel="noopener nofollow ugc">https://slicer.org</a></p>
<p>The message detail is:</p>
<p>Exception thrown in event: bad array new length"</p>
<p>This is kinda bad for me as I dont have a back up… I was wondering if I could somehow adjust the .nrrd file so that I dont get the out of memory error when I open the file. Already checked if “Segmentation_MasterRepresentation:=Binary labelmap” is set. So it should not load any Closed Surface Representations, which can cause problems.</p>
<p>How  would you suggest to go about saving my segmentations… Is there a way to modify the .nrrd header to only load certain labelmaps?</p>
<p>Thanks for any help in advance, would really appreaciate it. Especially to understand what went wrong and how to avoid it next time… <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>Best<br>
Joshua</p>

---

## Post #2 by @lassoan (2023-04-16 19:20 UTC)

<p>Is “closed surface” representation listed in the image header, too? You may need to remove that to prevent automatic creation of closed surface representation on load.</p>

---

## Post #3 by @Joshua_Binswanger (2023-04-16 20:49 UTC)

<p>Hey Andras,</p>
<p>Thanks for the quick reply. I am not sure which image header you refer to. It is a different file you refer to then the seg.nrrd? Unfortunately I am not that familiar with the technical aspects of file handling… <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=15" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>But the whole header of the seg.nrrd file reads:</p>
<p>NRRD0004</p>
<h1><a name="p-93602-complete-nrrd-file-format-specification-at-1" class="anchor" href="#p-93602-complete-nrrd-file-format-specification-at-1" aria-label="Heading link"></a>Complete NRRD file format specification at:</h1>
<h1><a name="p-93602-httpteemsourceforgenetnrrdformathtml-2" class="anchor" href="#p-93602-httpteemsourceforgenetnrrdformathtml-2" aria-label="Heading link"></a><a href="http://teem.sourceforge.net/nrrd/format.html" class="inline-onebox" rel="noopener nofollow ugc">Teem: nrrd: Definition of NRRD File Format</a></h1>
<p>type: unsigned char<br>
dimension: 4<br>
space: left-posterior-superior<br>
sizes: 7 907 688 840<br>
space directions: none (1.0000000150184933,0,0) (0,1.0000000150184933,0) (0,0,1)<br>
kinds: list domain domain domain<br>
encoding: gzip<br>
space origin: (0,-8.0000001201479467,-14)<br>
Segment0_Color:=0.501961 0.682353 0.501961<br>
Segment0_ColorAutoGenerated:=1<br>
Segment0_Extent:=0 906 0 687 0 839<br>
Segment0_ID:=EICHE_Segementationen_Gefaesse_1000x<br>
Segment0_LabelValue:=1<br>
Segment0_Layer:=0<br>
Segment0_Name:=EICHE_Segementationen_Gefaesse_1000x<br>
Segment0_NameAutoGenerated:=1<br>
Segment0_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment1_Color:=0.501961 0.682353 0.501961<br>
Segment1_ColorAutoGenerated:=1<br>
Segment1_Extent:=0 899 8 677 14 827<br>
Segment1_ID:=Segment_1<br>
Segment1_LabelValue:=1<br>
Segment1_Layer:=1<br>
Segment1_Name:=SpÃ¤tholzgefaesse<br>
Segment1_NameAutoGenerated:=0<br>
Segment1_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment2_Color:=0.717647 0.611765 0.862745<br>
Segment2_ColorAutoGenerated:=1<br>
Segment2_Extent:=0 906 0 687 0 827<br>
Segment2_ID:=Segment_36<br>
Segment2_LabelValue:=1<br>
Segment2_Layer:=2<br>
Segment2_Name:=Final Holzstrahlen 0<br>
Segment2_NameAutoGenerated:=0<br>
Segment2_Tags:=Segmentation.Status:completed|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment3_Color:=0.498039 0.588235 0.345098<br>
Segment3_ColorAutoGenerated:=1<br>
Segment3_Extent:=0 906 0 687 14 827<br>
Segment3_ID:=Segment_29<br>
Segment3_LabelValue:=1<br>
Segment3_Layer:=3<br>
Segment3_Name:=Final Holzstrahlen 1<br>
Segment3_NameAutoGenerated:=0<br>
Segment3_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment4_Color:=0.305882 0.247059 0<br>
Segment4_ColorAutoGenerated:=1<br>
Segment4_Extent:=0 906 0 687 14 827<br>
Segment4_ID:=Segment_28<br>
Segment4_LabelValue:=1<br>
Segment4_Layer:=4<br>
Segment4_Name:=Final Holzstrahlen 2<br>
Segment4_NameAutoGenerated:=0<br>
Segment4_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment5_Color:=0.333333 0.737255 1<br>
Segment5_ColorAutoGenerated:=1<br>
Segment5_Extent:=0 906 0 687 12 827<br>
Segment5_ID:=Segment_43<br>
Segment5_LabelValue:=1<br>
Segment5_Layer:=5<br>
Segment5_Name:=Final Holzstrahlen 3<br>
Segment5_NameAutoGenerated:=1<br>
Segment5_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment6_Color:=0.501961 0.682353 0.501961<br>
Segment6_ColorAutoGenerated:=1<br>
Segment6_Extent:=0 899 8 677 14 827<br>
Segment6_ID:=Segment_10<br>
Segment6_LabelValue:=2<br>
Segment6_Layer:=1<br>
Segment6_Name:=Complete<br>
Segment6_NameAutoGenerated:=0<br>
Segment6_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment7_Color:=0.945098 0.839216 0.568627<br>
Segment7_ColorAutoGenerated:=1<br>
Segment7_Extent:=0 296 104 397 0 839<br>
Segment7_ID:=Segment_13<br>
Segment7_LabelValue:=1<br>
Segment7_Layer:=6<br>
Segment7_Name:=Gefaesse_Ausschnitt<br>
Segment7_NameAutoGenerated:=0<br>
Segment7_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segment8_Color:=0.694118 0.478431 0.396078<br>
Segment8_ColorAutoGenerated:=1<br>
Segment8_Extent:=0 906 0 687 0 839<br>
Segment8_ID:=Segment_14<br>
Segment8_LabelValue:=2<br>
Segment8_Layer:=0<br>
Segment8_Name:=Segment_14<br>
Segment8_NameAutoGenerated:=1<br>
Segment8_Tags:=Segmentation.Status:inprogress|TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|<br>
Segmentation_ContainedRepresentationNames:=Binary labelmap|Closed surface|<br>
Segmentation_ConversionParameters:=Decimation factor|0.0|Desired reduction in the total number of polygons. Range: 0.0 (no decimation) to 1.0 (as much simplification as possible). Value of 0.8 typically reduces data set size by 80% without losing too much details.&amp;Smoothing factor|0.2|Smoothing factor. Range: 0.0 (no smoothing) to 1.0 (strong smoothing).&amp;Compute surface normals|1|Compute surface normals. 1 (default) = surface normals are computed. 0 = surface normals are not computed (slightly faster but produces less smooth surface display).&amp;Joint smoothing|0|Perform joint smoothing.&amp;Reference image geometry|-1.0000000150184933;0;0;0;0;-1.0000000150184933;0;0;0;0;1;0;0;0;0;1;0;899;0;669;0;813;|Image geometry description string determining the geometry of the labelmap that is created in course of conversion. Can be copied from a volume, using the button.&amp;Oversampling factor|1|Determines the oversampling of the reference image geometry. If it’s a number, then all segments are oversampled with the same value (value of 1 means no oversampling). If it has the value “A”, then automatic oversampling is calculated.&amp;Crop to reference image geometry|0|Crop the model to the extent of reference geometry. 0 (default) = created labelmap will contain the entire model. 1 = created labelmap extent will be within reference image extent.&amp;Collapse labelmaps|1|Merge the labelmaps into as few shared labelmaps as possible 1 = created labelmaps will be shared if possible without overwriting each other.&amp;Fractional labelmap oversampling factor|1|Determines the oversampling of the reference image geometry. All segments are oversampled with the same value (value of 1 means no oversampling).&amp;Threshold fraction|0.5|Determines the threshold that the closed surface is created at as a fractional value between 0 and 1.&amp;<br>
Segmentation_MasterRepresentation:=Binary labelmap<br>
Segmentation_ReferenceImageExtentOffset:=0 -8 -14</p>
<p>There is a “Closed surface” Part…</p>

---

## Post #4 by @pieper (2023-04-16 20:58 UTC)

<p>I’ve run into this before too, you have to remove this text:</p>
<p><code>Closed surface|</code></p>
<p>from this line:</p>
<p><code>Segmentation_ContainedRepresentationNames:=Binary labelmap|Closed surface|</code></p>
<p><a class="mention" href="/u/lassoan">@lassoan</a> I’d still vote not to have this state in the nrrd header, but if you want to keep it we should at least have a load option to bypass it.</p>

---

## Post #5 by @lassoan (2023-04-16 21:14 UTC)

<p>Having an option to override it in the file reader options would be useful for sure.</p>
<p><a class="mention" href="/u/joshua_binswanger">@Joshua_Binswanger</a> would you mind adding a post to the “Feature request” category for this? Thank you.</p>

---

## Post #6 by @Joshua_Binswanger (2023-04-18 14:07 UTC)

<p>Hey,</p>
<p>Sorry for the late reply. Just got back to my machine. I created the changes suggest by <a class="mention" href="/u/pieper">@pieper</a><br>
Unfortunately now another Error is thrown:</p>
<p>Exception thrown in event: D:\D\S\S-0-build\ITK\Modules\IO\NRRD\src\itkNrrdImageIO.cxx:769:<br>
ITK ERROR: NrrdImageIO(000001C01D8D04C0): Read: Error reading C:/Users/Josh/Desktop/Detail_Segmentation/EICHE_Segementationen_Gefaesse_1000x_1.seg.nrrd:<br>
[nrrd] nrrdLoad: trouble reading “C:/Users/Josh/Desktop/Detail_Segmentation/EICHE_Segementationen_Gefaesse_1000x_1.seg.nrrd”<br>
[nrrd] nrrdRead: trouble<br>
[nrrd] _nrrdRead: trouble reading NRRD file<br>
[nrrd] _nrrdFormatNRRD_read:<br>
[nrrd] _nrrdEncodingGzip_read: error reading from gzFile<br>
[nrrd] _nrrdGzRead: data read error<br>
[nrrd] _nrrdGzCheckHeader: gzip compression method is not deflate</p>
<p>I changed the suggested line to:</p>
<p>Segmentation_ContainedRepresentationNames:=Binary labelmap</p>
<p><a class="mention" href="/u/lassoan">@lassoan</a> : I will gladly make a feature request, once I am sure the above problem is just on my end… <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>

---

## Post #7 by @pieper (2023-04-18 15:34 UTC)

<p>Probably whatever tool you used to edit the header caused some other change to the file that changed the binary data (probably some automatic windows end of line conversion).  I used vim to make the suggested edit on my machine.  Also I believe the line should be like this, but I"m not sure if the ending <code>|</code> symbol is needed or not:</p>
<p><code>Segmentation_ContainedRepresentationNames:=Binary labelmap|</code></p>

---

## Post #8 by @Joshua_Binswanger (2023-04-18 15:57 UTC)

<p>Yeahy, got it to work. What a dumb mistake… Thanks so much for all the help!<br>
Create a feature request: <a href="https://discourse.slicer.org/t/removing-closed-surface-from-seg-nrrd-image-header-line-segmentation-containedrepresentationnames/28987" class="inline-onebox">Removing "Closed Surface" from seg.nrrd image header Line: Segmentation_ContainedRepresentationNames</a></p>
<p>Thanks for the support! you are all doing great work!</p>

---
