# Prevent slicer overwritting nrrd header.

**Topic ID**: 29601
**Date**: 2023-05-23
**URL**: https://discourse.slicer.org/t/prevent-slicer-overwritting-nrrd-header/29601

---

## Post #1 by @mmonteiro (2023-05-23 11:11 UTC)

<p>Hello,</p>
<p>I am trying to store some custom metadata in the nrrd header of my segmentation files. For example, the id of the annotator which segmented the file. The intended workflow is to:</p>
<ol>
<li>Load a nrrd segmentation file with custom header metadata into Slicer.</li>
<li>Edit some segments.</li>
<li>Save/Export the new segmentation file while keeping the custom metadata.</li>
</ol>
<p>However, when I load a segmentation file into Slicer and export it again Slicer removes all metadata fields it does not recognise.</p>
<p>Is there a way of keeping the custom metadata while passing through Slicer?</p>
<p>Thanks for your help,</p>

---

## Post #2 by @lassoan (2023-05-23 11:42 UTC)

<p>This would make sense. Instead of just passing through the data, it would be better to make the additional metadata available for reading/writing within Slicer. We already have this feature for each segment: for each segment you can store “tags” - a list of custom key/value pairs. Would it be OK if we added a single “Segmentation_tags” NRRD custom metadata field? The alternative would be to expose each unknown NRRD custom metadata field in a segmentation tag.</p>

---

## Post #3 by @mmonteiro (2023-05-23 12:48 UTC)

<p>Thanks for your answer,</p>
<p>I noticed that even when passing metadata using the segment tags (e.g. Segment0_Tags), the metadata still gets overwritten by Slicer.</p>

---

## Post #4 by @lassoan (2023-05-23 13:26 UTC)

<p>Segment tags are read from and written to the .seg.nrrd file. If you find that a tag is not preserved then maybe you did not use the correct format.</p>

---

## Post #5 by @mmonteiro (2023-05-23 14:16 UTC)

<p>Maybe I misunderstood, this is my part of my header before going through slicer as printed by <code>pynrrd</code> using <code>nrrd.read_header()</code>:</p>
<pre><code class="lang-python">OrderedDict([...
             ('Segment0_ID', 'c05184dc-408d-428e-a95a-ec1a22e56127'),
             ('Segment0_Name', 'left-lung'),
             ('Segment0_Layer', '0'),
             ('Segment0_LabelValue', '1'),
             ('Segment0_Tags', 'AnnotatorID|asdf|'),
             ('Segment0_Color',
              '0.06274509803921569 0.9098039215686274 0.7098039215686275'),
             ...
</code></pre>
<p>However, after going through slicer Segment0_Tags gets overwritten to</p>
<pre><code class="lang-python">OrderedDict([...
             ('Segment0_Color', '0.0627451 0.909804 0.709804'),
             ('Segment0_ColorAutoGenerated', '1'),
             ('Segment0_Extent', '0 98 0 67 0 27'),
             ('Segment0_ID', 'c05184dc-408d-428e-a95a-ec1a22e56127'),
             ('Segment0_LabelValue', '1'),
             ('Segment0_Layer', '0'),
             ('Segment0_Name', 'left-lung'),
             ('Segment0_NameAutoGenerated', '1'),
             ('Segment0_Tags',
              'TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SCT^85756007^Tissue~SCT^85756007^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|'),
</code></pre>
<p>What is the correct format for <code>Segment0_Tags</code> that ensures that custom tags will be preserved?</p>
<p>Thanks in advance,</p>
<pre><code class="lang-auto"></code></pre>

---

## Post #6 by @lassoan (2023-05-23 22:08 UTC)

<p>The specification is available here:</p>
<p><a href="https://slicer.readthedocs.io/en/latest/developer_guide/modules/segmentations.html#segment-custom-fields" class="onebox" target="_blank" rel="noopener">https://slicer.readthedocs.io/en/latest/developer_guide/modules/segmentations.html#segment-custom-fields</a></p>
<p>In your example the field was discarded because you haven’t specified any key:value pairs.</p>

---

## Post #7 by @mmonteiro (2023-05-24 08:37 UTC)

<p>Thank you for clarifying, that solved the issue.<br>
For future reference, as long as you add tags as <code>key:value|</code> slicer will not discard them.</p>

---
