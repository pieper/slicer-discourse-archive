# Various errors with PLUS Toolkit Ultrasound Simulator

**Topic ID**: 32168
**Date**: 2023-10-11
**URL**: https://discourse.slicer.org/t/various-errors-with-plus-toolkit-ultrasound-simulator/32168

---

## Post #1 by @olivares471 (2023-10-11 22:37 UTC)

<p>Hi everyone,</p>
<p>My question regards more the PLUS Toolkit library and maybe IGT, but I’ve been recommended this forum for support with this issue since PLUS is often used with Slicer3D and IGT. Here’s my <a href="https://github.com/PlusToolkit/PlusLib/discussions/1119" rel="noopener nofollow ugc">original post</a> on the PLUS repo.</p>
<p>Basically I’m currently working on a way to reproduce the interactions between Slicer3D and the PLUS Toolkit’s Ultrasound simulator, but using Unity instead of Slicer in order to easily create a 3D environment supporting VR interactions. My project revolves around simulating, in real time, an ultrasound image of the forearm of a patient (3D mesh).</p>
<p>I tried to understands how Slicer3D communicates with PLUS via IGT and to reproduce it in Unity/C#. The Unity system I’m working on works by creating a TCP Listener to which the PLUS US Sim will connect to in order to send it various tool’s transform matrices. Simultaneously, I create a TCP client that connects to PLUS and that will receive the simulated ultrasound image data.</p>
<p>My problem is that my solution works very briefly before the PlusServer.exe stops responding and shows me a few errors. I was wondering if some of you would have an idea of what it could mean.</p>
<p>Right after sending the starting transforms and receiving the first US image, PLUS seems to stop working and sends multiple error logs. This next screenshot show the errors after the first data exchange. The error seems to be <code>Failed to get oldest timestamp: no overlap between tracking and video data[...]</code>:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/a/e/aef08263d109e7f5f2f9cf2f3bf3aebb32ae13da.png" data-download-href="/uploads/short-url/oXAmRpqAUOGMrQBhHFWnj5B9TOW.png?dl=1" title="BugPlusUSSim" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/a/e/aef08263d109e7f5f2f9cf2f3bf3aebb32ae13da.png" alt="BugPlusUSSim" data-base62-sha1="oXAmRpqAUOGMrQBhHFWnj5B9TOW" width="690" height="385" data-dominant-color="241D1A"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">BugPlusUSSim</span><span class="informations">1112×622 52.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>After a few logs of this error, I get multiple <code>Failed to get video buffer item by timestamp [X ...]</code>. And then I get a <code>ToolTimeStampedUpdate failed for tool:</code> message until I close the PlusServer.exe. This next screenshot show all of these errors.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/7/e71b8873412ce97417311503d11565ce21dbf345.png" data-download-href="/uploads/short-url/wYthF38IqHyol7cDmIpuC7CE2mF.png?dl=1" title="BugPlusUSSim2" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/7/e71b8873412ce97417311503d11565ce21dbf345.png" alt="BugPlusUSSim2" data-base62-sha1="wYthF38IqHyol7cDmIpuC7CE2mF" width="690" height="392" data-dominant-color="221B1C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">BugPlusUSSim2</span><span class="informations">1111×632 36.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>I’m pretty confident that at least a few data messages are exchanged between my solution and PLUS before it stops working since my mesh objects (tools) are move to the right position/rotation in the PLUS 3D space and I receive at least one image from PLUS that I can display (as seen on the screenshot bellow)<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/3/c/3cdc8cdd4af0e50f37fcd5a64a88f95be2673476.png" data-download-href="/uploads/short-url/8GpaQyj7ZEXKkFwzdKVbQjmjN3g.png?dl=1" title="BugPlusUSSim3" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/3/c/3cdc8cdd4af0e50f37fcd5a64a88f95be2673476_2_688x500.png" alt="BugPlusUSSim3" data-base62-sha1="8GpaQyj7ZEXKkFwzdKVbQjmjN3g" width="688" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/3/c/3cdc8cdd4af0e50f37fcd5a64a88f95be2673476_2_688x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/3/c/3cdc8cdd4af0e50f37fcd5a64a88f95be2673476.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/3/c/3cdc8cdd4af0e50f37fcd5a64a88f95be2673476.png 2x" data-dominant-color="5C5E60"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">BugPlusUSSim3</span><span class="informations">928×674 118 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>From what I can tell, maybe there is a timestamp issue between the data messages I send and PLUS, but I’m not sure how that would be possible since from what I understand PLUS is not using the timestamp (always 0) I send via the data message containing the transform matrix of X tool. Would anyone know what these error messages could mean?</p>
<p>Thank you!</p>

---
