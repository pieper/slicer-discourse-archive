# Calculate a scalp to scalp distance

**Topic ID**: 1141
**Date**: 2017-09-28
**URL**: https://discourse.slicer.org/t/calculate-a-scalp-to-scalp-distance/1141

---

## Post #1 by @Frederic (2017-09-28 14:01 UTC)

<p>Dear Slicer experts,</p>
<p>Quick mail to know if you know a way/a module to calculate a scalp to scalp distance (i.e. distance along the surface)?</p>
<p>More than “CurveMaker”, I would like an automatic way to realize that (1/mesh the brain,2/ calculate distance between nodes?).</p>
<p>Thanks in advance,<br>
All the best,</p>
<p>Frederic</p>

---

## Post #2 by @lassoan (2017-09-28 23:40 UTC)

<p>You can use <code>Model to model distance</code> extension to measure distance between surfaces.</p>
<p>What do you mean by “More than CurveMaker…”?</p>

---

## Post #3 by @Frederic (2017-09-29 09:14 UTC)

<p>Hi Andras,<br>
Thanks for your quick reply.</p>
<p>My question lacked of precision: I have several T1-weighted images, and I would like, always on the same scalp, calculate distance along the surface.</p>
<p>“Model to model distance” seems works for two different models, I would rather work just about one model (T1–&gt;mesh of the scalp–&gt;compute the distance between two points on the mesh).<br>
Is-it possible?</p>
<p>Thanks a lot!<br>
Frederic</p>

---

## Post #4 by @lassoan (2017-09-29 12:58 UTC)

<p>I don’t know about any module that provides this but it’s very easy to create a new module for this, as this VTK class compute geodesic path on a surface: <a href="https://www.vtk.org/doc/nightly/html/classvtkDijkstraGraphGeodesicPath.html#details">https://www.vtk.org/doc/nightly/html/classvtkDijkstraGraphGeodesicPath.html#details</a></p>

---

## Post #5 by @Frederic (2017-10-02 16:16 UTC)

<p>Thanks Andrea,<br>
Very easy for you, but not for me ;).</p>
<p>Before use the VTK class, how is-it possible to mesh the scalp of T1 image with 3dslicer?</p>
<p>Thanks once again,</p>
<p>Frederic</p>

---

## Post #6 by @lassoan (2017-10-02 16:28 UTC)

<p>Use Segment Editor tool to create surface mesh from an image.</p>

---

## Post #7 by @Frederic (2017-10-03 15:42 UTC)

<p>Great, Thanks a lot Andras.</p>

---

## Post #8 by @Frederic (2017-10-06 15:30 UTC)

<p>Dear Andras and Slicer users,<br>
I have begun my script to calculate distance along the surface.<br>
However, I butt into an obstacle. Indeed, How could I make correspond vertex (in bold below) of my vtkPolyDataMapper with coordinate obtain by the fiducal properties (in italic)?<br>
Perhaps by a KD-Tree (tk.vtkKdTree)?</p>
<p>Thanks in advance.<br>
Frederic</p>
<p>In python:</p>
<pre><code class="lang-python">##Access to Fiducial Properties
fidList = slicer.util.getNode('F')
numFids = fidList.GetNumberOfFiducials()
for i in range(numFids):
  ras = [0,0,0]
  fidList.GetNthFiducialPosition(i,ras)
  print i,": RAS =",ras_

#vtkDijkstraGraphGeodesicPath
dijkstra = vtk.vtkDijkstraGraphGeodesicPath()
dijkstra.SetInputConnection(reader.GetOutputPort())
dijkstra.SetStartVertex(**20**)
dijkstra.SetEndVertex(**500000**)
dijkstra.Update()</code></pre>

---

## Post #9 by @lassoan (2017-10-07 04:50 UTC)

<p>To get index of a point closest to a spatial position, you need use a locator:</p>
<pre><code>somePolyData = someModelNode.GetPolyData()
pointLocator = vtk.vtkPointLocator()
pointLocator.SetDataSet(somePolyData)
pointLocator.BuildLocator()
closestPointId = curvePointsLocator.FindClosestPoint(point)
</code></pre>
<p>Not that these are all standard VTK operations, there is nothing specific to Slicer. So, you may find answers by searching in <a href="https://github.com/Kitware/VTK">VTK source code</a>, reading the <a href="https://www.vtk.org/vtk-textbook/">VTK textbook</a> (it is worth reading the book cover to cover, a few times), and browsing <a href="https://lorensen.github.io/VTKExamples/site/">VTK examples</a>.</p>

---

## Post #10 by @doc-xie (2017-10-09 13:21 UTC)

<p>Hello，I have the same question with you? On the surface of the scalp，how to measure the distance between two pionts without Curve maker module?Dose the problem has been solved?<br>
Thanks for your attention!</p>

---

## Post #11 by @lassoan (2017-10-09 14:42 UTC)

<p><a class="mention" href="/u/frederic">@Frederic</a> it would be great if you could upload current version of your module to Github, even if it is not functional yet. It would allow me, <a class="mention" href="/u/doc-xie">@doc-xie</a>, and others to see the progress and help out. The core of this feature can be implemented by adding 30-40 lines of python code to the module template generated by Extension wizard module, so it should be possible to complete it in a couple of days. If you get stuck anywhere then let us know.</p>

---

## Post #12 by @Frederic (2017-10-09 17:27 UTC)

<p>Hi,<br>
First of all, thanks <a class="mention" href="/u/lassoan">@lassoan</a> for your locator code.<br>
Second, my in progress draft for the module was <a href="https://github.com/FredericBr/Frederic" rel="nofollow noopener">here</a>, with two python scripts: One is a standalone version for python (without 3dslicer) and the second for 3dslicer.<br>
I am moving slowly because I found this <a href="https://github.com/zarquon42b/RvtkStatismo" rel="nofollow noopener">RvtkStatismo</a> that made all that I want (HTH <a class="mention" href="/u/doc-xie">@doc-xie</a>) .</p>

---

## Post #13 by @lassoan (2017-10-09 18:26 UTC)

<p>Thanks for the update. Slicer is a frontend, from where you can use various libraries. So, if you find Statismo useful then you can add wrappers to make it avaiable directly from Slicer.</p>
<p><a class="mention" href="/u/doc-xie">@doc-xie</a> if you are interested to pick it up from where <a class="mention" href="/u/frederic">@Frederic</a> left off then, I would recommend to create a skeleton extension and a Python scripted module inside (as explained in the <a href="https://www.slicer.org/wiki/Documentation/Nightly/Training#Slicer4_Programming_Tutorial">Slicer programming tutorial</a>) and add Frederic’s processing code to that.</p>

---

## Post #14 by @doc-xie (2017-10-17 12:53 UTC)

<p>Yes, thanks for your believing, I am very intresting about 3D Slicer, but I am a new learner and have not any knowledge about Python. So I decide to study it with your help because the importance of Python. By the way, I am looking forward to the progress of this topic!</p>

---

## Post #15 by @Frederic (2017-10-17 13:34 UTC)

<p>I have made much advance in this script, I will return to you when I will have more time (I defend my PhD research in two weeks).<br>
Best,<br>
Frederic</p>

---

## Post #16 by @doc-xie (2017-11-14 08:33 UTC)

<p>OK!<br>
Waiting for your good news!</p>

---

## Post #17 by @doc-xie (2017-12-14 08:18 UTC)

<p>Hello Frederic!<br>
Is there any progress in the calculation tools or methods of measurement excepting Curve maker Module in 3D Slicer?<br>
Best wishes!</p>

---

## Post #18 by @Frederic (2017-12-14 11:31 UTC)

<p>Hi doc-xie.<br>
Yes, I have update the <a href="https://github.com/FredericBr/GeodesicPathSlicer" rel="nofollow noopener">Github</a>.<br>
<a class="mention" href="/u/lassoan">@lassoan</a> could you help me to create an extension (I have begun on my Github)?<br>
<a class="mention" href="/u/doc-xie">@doc-xie</a> For the moment, you could use it from your python interactor (for 3 points):</p>
<p>1/ Load your model in 3dslicer<br>
2/ Draw your 3 points with the “Create-and-Place-Fiducial” button<br>
3/ Insert this code in your python interactor:</p>
<pre><code>import sys, slicer, numpy, os, math, vtk

model = getNode('name_of_your_data') #Go to Data module and see the name of your model, "Name"
#Access to Fiducial Properties (to determinate the start and the end point of the geodesic path)
fidList = slicer.util.getNode('F')
numFids = fidList.GetNumberOfFiducials()
list=[]
for i in range(numFids):
  ras = [0,0,0]
  fidList.GetNthFiducialPosition(i,ras)
  print i,": RAS =",ras
  list.append(ras)
  
#create locator
pd = model.GetModelDisplayNode()
pd1=pd.GetOutputPolyData()
pd1.GetNumberOfPoints()
loc = vtk.vtkPointLocator()
loc.SetDataSet(pd1)
loc.BuildLocator()
closestPointId = loc.FindClosestPoint(list[0]) #point1 
closestPointId1 = loc.FindClosestPoint(list[1]) #point2
closestPointId2 = loc.FindClosestPoint(list[2]) #point3

#get the distance of the geodesic path 
appendFilter = vtk.vtkAppendFilter()
appendFilter.MergePointsOn()
points = vtk.vtkPoints()

vIds = [closestPointId,closestPointId1,closestPointId2]
p0 = [0,0,0]
p1 = [0,0,0]
dist = 0.0
for n in range(len(vIds)-1):
	v0 = vIds[n]
	v1 = vIds[n+1]
	
	#create geodesic path: vtkDijkstraGraphGeodesicPath
	dijkstra = vtk.vtkDijkstraGraphGeodesicPath()
	dijkstra.SetInputConnection(pd.GetOutputPolyDataConnection())
	dijkstra.SetStartVertex(v0)
	dijkstra.SetEndVertex(v1)
	dijkstra.Update()
				
	pts = dijkstra.GetOutput().GetPoints()
	end = n&lt;len(vIds)-2 and 0 or -1
	for ptId in range(pts.GetNumberOfPoints()-1, end, -1):
		pts.GetPoint(ptId, p0)
		points.InsertNextPoint(p0)		
	
	for ptId in range(pts.GetNumberOfPoints()-1):
		pts.GetPoint(ptId, p0)
		pts.GetPoint(ptId+1, p1)
		dist += math.sqrt(vtk.vtkMath.Distance2BetweenPoints(p0, p1))
		
	appendFilter.AddInputConnection(dijkstra.GetOutputPort())

print 'length= ', dist/10 ,'cm'
</code></pre>
<p>Best</p>

---

## Post #19 by @doc-xie (2017-12-14 12:51 UTC)

<p>Hi,Frederic!<br>
After I insert the code in my phthon interactor, what i get is following:</p>
<p>Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘vIds’ is not defined</p>
<blockquote>
<blockquote>
<blockquote>
<p>print 'length= ', dist/10 ,‘cm’<br>
length=  0.0 cm</p>
</blockquote>
</blockquote>
</blockquote>
<p>What is the reason?<br>
Thanks a lot!<br>
doc-xie</p>

---

## Post #20 by @Frederic (2017-12-14 13:06 UTC)

<p>Don’t forget to change this line:<br>
<code>model = getNode('name_of_your_data') #Go to Data module and see the name of your model, "Name"</code></p>

---

## Post #21 by @doc-xie (2017-12-14 13:18 UTC)

<p>I am so bad about the result.<br>
When I change the “name of your data”,“Name” or both of them,the result is the same as before.</p>
<p>Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘vIds’ is not defined</p>
<blockquote>
<blockquote>
<blockquote>
<p>print 'length= ', dist/10 ,‘cm’<br>
length=  0.0 cm</p>
</blockquote>
</blockquote>
</blockquote>
<p>Looking forward to your reply!<br>
Thanks!<br>
doc-xie</p>

---

## Post #22 by @Frederic (2017-12-14 13:22 UTC)

<p>What do you obtain after write<br>
<code>model</code><br>
in your interactor?</p>

---

## Post #23 by @timeanddoctor (2017-12-14 13:27 UTC)

<blockquote>
<blockquote>
<blockquote>
<p>import sys, slicer, numpy, os, math, vtk</p>
<p>model = getNode(‘kk’) <span class="hashtag-raw">#Go</span> to Data module and see the name of your model, “Name”<br>
<span class="hashtag-raw">#Access</span> to Fiducial Properties (to determinate the start and the end point of the geodesic path)<br>
fidList = slicer.util.getNode(‘F’)<br>
numFids = fidList.GetNumberOfFiducials()<br>
list=<span class="chcklst-box fa fa-square-o fa-fw"></span><br>
for i in range(numFids):<br>
…   ras = [0,0,0]<br>
…   fidList.GetNthFiducialPosition(i,ras)<br>
…   print i,“: RAS =”,ras<br>
…   list.append(ras)<br>
…<br>
… <span class="hashtag-raw">#create</span> locator<br>
… pd = model.GetModelDisplayNode()<br>
File “”, line 8<br>
pd = model.GetModelDisplayNode()<br>
^<br>
SyntaxError: invalid syntax<br>
pd1=pd.GetOutputPolyData()<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘pd’ is not defined<br>
pd1.GetNumberOfPoints()<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘pd1’ is not defined<br>
loc = vtk.vtkPointLocator()<br>
loc.SetDataSet(pd1)<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘pd1’ is not defined<br>
loc.BuildLocator()<br>
closestPointId = loc.FindClosestPoint(list[0]) <span class="hashtag-raw">#point1</span><br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
IndexError: list index out of range<br>
closestPointId1 = loc.FindClosestPoint(list[1]) <span class="hashtag-raw">#point2</span><br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
IndexError: list index out of range<br>
closestPointId2 = loc.FindClosestPoint(list[2]) <span class="hashtag-raw">#point3</span><br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
IndexError: list index out of range</p>
<p><span class="hashtag-raw">#get</span> the distance of the geodesic path<br>
appendFilter = vtk.vtkAppendFilter()<br>
appendFilter.MergePointsOn()<br>
points = vtk.vtkPoints()</p>
<p>vIds = [closestPointId,closestPointId1,closestPointId2]<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘closestPointId’ is not defined<br>
p0 = [0,0,0]<br>
p1 = [0,0,0]<br>
dist = 0.0<br>
for n in range(len(vIds)-1):<br>
… 	v0 = vIds[n]<br>
… 	v1 = vIds[n+1]<br>
… 	<br>
… 	<span class="hashtag-raw">#create</span> geodesic path: vtkDijkstraGraphGeodesicPath<br>
… 	dijkstra = vtk.vtkDijkstraGraphGeodesicPath()<br>
… 	dijkstra.SetInputConnection(pd.GetOutputPolyDataConnection())<br>
… 	dijkstra.SetStartVertex(v0)<br>
… 	dijkstra.SetEndVertex(v1)<br>
… 	dijkstra.Update()<br>
… 				<br>
… 	pts = dijkstra.GetOutput().GetPoints()<br>
… 	end = n&lt;len(vIds)-2 and 0 or -1<br>
… 	for ptId in range(pts.GetNumberOfPoints()-1, end, -1):<br>
… 		pts.GetPoint(ptId, p0)<br>
… 		points.InsertNextPoint(p0)		<br>
… 	<br>
… 	for ptId in range(pts.GetNumberOfPoints()-1):<br>
… 		pts.GetPoint(ptId, p0)<br>
… 		pts.GetPoint(ptId+1, p1)<br>
… 		dist += math.sqrt(vtk.vtkMath.Distance2BetweenPoints(p0, p1))<br>
… 		<br>
… 	appendFilter.AddInputConnection(dijkstra.GetOutputPort())<br>
…<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘vIds’ is not defined<br>
print 'length= ', dist/10 ,‘cm’<br>
length=  0.0 cm</p>
</blockquote>
</blockquote>
</blockquote>

---

## Post #24 by @doc-xie (2017-12-14 13:31 UTC)

<p>The result just like before:</p>
<p>Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘vIds’ is not defined</p>
<blockquote>
<blockquote>
<blockquote>
<p>print 'length= ', dist/10 ,‘cm’<br>
length=  0.0 cm</p>
</blockquote>
</blockquote>
</blockquote>
<p>Dose the code should be changed include “name of your data” and “Name”?<br>
Best wishes!<br>
doc-xie</p>

---

## Post #25 by @Frederic (2017-12-14 13:31 UTC)

<p>the error is here:<br>
… <span class="hashtag">#create</span> locator<br>
… pd = model.GetModelDisplayNode()</p>
<p>The indentation is bad.<br>
Stop after each loop, press “enter key” and copy/past the rest of the code.</p>

---

## Post #26 by @Frederic (2017-12-14 13:45 UTC)

<p>Cf. paint<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/6/66381724c774a67f85c2d89ba9dd601be4006e05.png" data-download-href="/uploads/short-url/eAgSfYB1uz16n20v60AFObtSUi9.png?dl=1" title="Sans titre" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66381724c774a67f85c2d89ba9dd601be4006e05_2_628x500.png" alt="Sans titre" data-base62-sha1="eAgSfYB1uz16n20v60AFObtSUi9" width="628" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66381724c774a67f85c2d89ba9dd601be4006e05_2_628x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66381724c774a67f85c2d89ba9dd601be4006e05_2_942x750.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/6/66381724c774a67f85c2d89ba9dd601be4006e05_2_1256x1000.png 2x" data-dominant-color="B0AFB7"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Sans titre</span><span class="informations">1287×1024 137 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #27 by @doc-xie (2017-12-14 13:50 UTC)

<p>I cannot understand your meaning precisely.<br>
How many and which code should be changed in total?<br>
Would you like show us the step in details?<br>
How to stop the loop?<br>
Or can you release the changed code?<br>
Because the problem confused me for a long tine.<br>
Thank you very much!<br>
doc-xie</p>

---

## Post #28 by @Frederic (2017-12-14 13:59 UTC)

<p>The code is the same.<br>
Just copy it step by step.</p>

---

## Post #29 by @doc-xie (2017-12-14 14:13 UTC)

<p>But I got the same result,what is the reason?<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/1/51d92fd93194d9881198a20d5b21351a9276364a.jpeg" data-download-href="/uploads/short-url/bG3ZKhlaFaD0UQr8t7tEBj7qSgi.jpg?dl=1" title="无标题" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/51d92fd93194d9881198a20d5b21351a9276364a_2_690x387.jpg" alt="无标题" data-base62-sha1="bG3ZKhlaFaD0UQr8t7tEBj7qSgi" width="690" height="387" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/51d92fd93194d9881198a20d5b21351a9276364a_2_690x387.jpg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/51d92fd93194d9881198a20d5b21351a9276364a_2_1035x580.jpg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/1/51d92fd93194d9881198a20d5b21351a9276364a.jpeg 2x" data-dominant-color="E4E7ED"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">无标题</span><span class="informations">1366×768 210 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #30 by @Frederic (2017-12-14 14:34 UTC)

<p>Do you have draw 3 fiducials points on your bones?</p>

---

## Post #31 by @doc-xie (2017-12-14 14:58 UTC)

<p>Yes,I set three fiducial points on the surface of the bone model.<br>
Is there any other code should be changed?<br>
Thanks for your quick answer!<br>
doc-xie</p>

---

## Post #32 by @Frederic (2017-12-14 15:02 UTC)

<p>Please, could you send me, a picture with:<br>
Your model + your 3 points + the code in the python interactor.<br>
Thx</p>

---

## Post #33 by @doc-xie (2017-12-15 02:35 UTC)

<p>My model is bone,and the three Fiducial points locate on the surface of the bone.<br>
The code with the changed name of the bone is in the following picture!<br>
<a>无标题|690x387</a></p>

---

## Post #34 by @Frederic (2017-12-15 08:12 UTC)

<p>Hi,<br>
I don’t see your picture, the link is break.</p>

---

## Post #35 by @doc-xie (2017-12-15 13:26 UTC)

<p>Hello,Frederic!<br>
The picture show the model,Fiducial pionts and the changed code.<br>
Is there any mistake with it?</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/9/3/93d0cfc22142a5e78f08e70ea8365691ff0f91e7.jpeg" data-download-href="/uploads/short-url/l5Dz1hT0AAHD3dp9ssSq10wLS19.jpg?dl=1" title="0000" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/9/93d0cfc22142a5e78f08e70ea8365691ff0f91e7_2_690x387.jpg" alt="0000" data-base62-sha1="l5Dz1hT0AAHD3dp9ssSq10wLS19" width="690" height="387" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/9/93d0cfc22142a5e78f08e70ea8365691ff0f91e7_2_690x387.jpg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/9/93d0cfc22142a5e78f08e70ea8365691ff0f91e7_2_1035x580.jpg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/9/3/93d0cfc22142a5e78f08e70ea8365691ff0f91e7.jpeg 2x" data-dominant-color="CBCBD3"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">0000</span><span class="informations">1366×768 238 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>Thanks a lot!<br>
doc-xie</p>

---

## Post #36 by @Frederic (2017-12-15 13:42 UTC)

<p>It seems good.<br>
Write the code until 'list.append(ras)'<br>
Then, say me what do you obtain in list.<br>
(write list in interactor).</p>

---

## Post #37 by @doc-xie (2017-12-15 13:48 UTC)

<p>The result is:<br>
0 : RAS = [-64.88647044483935, 31.38609213676277, 22.4068165428881]<br>
1 : RAS = [-67.15588955489847, 15.631492316231501, -7.362209206466714]<br>
2 : RAS = [-69.599602782564, -17.377627328452363, -16.836592046659394]</p>

---

## Post #38 by @Frederic (2017-12-15 14:03 UTC)

<p>Perfect. Now write the code until the loop. What do you obtain for the ClosestPointId, ClosestPointId1, ClosestPointId2?</p>

---

## Post #39 by @doc-xie (2017-12-15 14:06 UTC)

<p>There are some mistakes with these code:<br>
File “”, line 8<br>
pd = model.GetModelDisplayNode()<br>
^<br>
SyntaxError: invalid syntax</p>
<blockquote>
<blockquote>
<blockquote>
<p>pd1=pd.GetOutputPolyData()<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘pd’ is not defined<br>
pd1.GetNumberOfPoints()<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘pd1’ is not defined<br>
loc = vtk.vtkPointLocator()<br>
loc.SetDataSet(pd1)<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘pd1’ is not defined<br>
loc.BuildLocator()<br>
closestPointId = loc.FindClosestPoint(list[0]) <span class="hashtag-raw">#point1</span><br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
IndexError: list index out of range<br>
closestPointId1 = loc.FindClosestPoint(list[1]) <span class="hashtag-raw">#point2</span><br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
IndexError: list index out of range<br>
closestPointId2 = loc.FindClosestPoint(list[2]) <span class="hashtag-raw">#point3</span></p>
</blockquote>
</blockquote>
</blockquote>

---

## Post #40 by @Frederic (2017-12-15 14:23 UTC)

<p>Please, could you send me your model (bones)?</p>

---

## Post #41 by @doc-xie (2017-12-15 14:25 UTC)

<p>OK! Sure!<br>
How can I send it to you?<br>
Would you like tell me about your e-mail?<br>
Best wishes!<br>
doc-xie</p>

---

## Post #42 by @Frederic (2017-12-15 14:42 UTC)

<p>By WeTransfer? Dropbox? And you give me the link after.<br>
Best</p>

---

## Post #44 by @doc-xie (2017-12-15 14:46 UTC)

<p>link：<a href="https://pan.baidu.com/s/1kVjAtc7" rel="nofollow noopener">https://pan.baidu.com/s/1kVjAtc7</a><br>
passwords：1bhl</p>

---

## Post #45 by @Frederic (2017-12-15 15:21 UTC)

<p>Thanks for your nmrl data, but I have need of you bone.vtk please.</p>

---

## Post #46 by @doc-xie (2017-12-16 14:11 UTC)

<p>Link：<a href="https://pan.baidu.com/s/1c2HE9Vy" rel="nofollow noopener">https://pan.baidu.com/s/1c2HE9Vy</a><br>
passwords：k1xq</p>

---

## Post #47 by @Frederic (2017-12-18 09:47 UTC)

<p>Convert your ‘bone.vtk’ in ‘bone.stl’ by 3dslicer, and It will works like a charm (cf. paint).<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/5/d59d5b8e2baf41c577e22828732d500da30c1f77.jpeg" data-download-href="/uploads/short-url/utIPYLUz8GC2kGy87IUyWj2uhg3.jpg?dl=1" title="Sans titre" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d59d5b8e2baf41c577e22828732d500da30c1f77_2_619x500.jpg" alt="Sans titre" data-base62-sha1="utIPYLUz8GC2kGy87IUyWj2uhg3" width="619" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d59d5b8e2baf41c577e22828732d500da30c1f77_2_619x500.jpg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d59d5b8e2baf41c577e22828732d500da30c1f77_2_928x750.jpg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/5/d59d5b8e2baf41c577e22828732d500da30c1f77.jpeg 2x" data-dominant-color="CDCDD2"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Sans titre</span><span class="informations">1220×984 259 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #48 by @doc-xie (2017-12-18 13:37 UTC)

<p>Good job!<br>
But after I load the bone.stl into 3D Slicer and paste the code with the name of the model changed by “bone”,the result is the same as before:<br>
Traceback (most recent call last):<br>
File “”, line 1, in <br>
NameError: name ‘vIds’ is not defined</p>
<blockquote>
<blockquote>
<blockquote>
<p>print 'length= ', dist/10 ,‘cm’<br>
length=  0.0 cm</p>
</blockquote>
</blockquote>
</blockquote>
<p>What is the reason about this?<br>
Thanks a lot!<br>
dox-xie</p>

---

## Post #49 by @Frederic (2017-12-18 14:27 UTC)

<p>Once again, I think that is an indentation problem.<br>
copy the code one line by one line.</p>

---

## Post #50 by @timeanddoctor (2017-12-24 12:25 UTC)

<aside class="quote no-group" data-username="Frederic" data-post="49" data-topic="1141">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/frederic/48/4907_2.png" class="avatar"> Frederic:</div>
<blockquote>
<p>think that is an indentation problem.</p>
<p>copy the code one line by one line.</p>
</blockquote>
</aside>
<p>Are there a module to run this code automatically.<br>
I deleted all space and repeated,  the errors occurred again.<br>
Could you send me this code with no indentation, so I can copy it in the same time.</p>

---

## Post #51 by @Frederic (2018-01-09 15:06 UTC)

<p>No module yet, but I hope to make one later.<br>
The code with no indentation:</p>
<pre><code>import sys, slicer, numpy, os, math, vtk

model = getNode('name_of_your_data.vtk') #Go to Data module and see the name of your model, "Name"
#Access to Fiducial Properties (to determinate the start and the end point of the geodesic path)
fidList = slicer.util.getNode('F')
numFids = fidList.GetNumberOfFiducials()
list=[]
for i in range(numFids):
ras = [0,0,0]
fidList.GetNthFiducialPosition(i,ras)
print i,": RAS =",ras
list.append(ras)
  
#create locator
pd = model.GetModelDisplayNode()
pd1=pd.GetOutputPolyData()
pd1.GetNumberOfPoints()
loc = vtk.vtkPointLocator()
loc.SetDataSet(pd1)
loc.BuildLocator()
closestPointId = loc.FindClosestPoint(list[0]) #point1 
closestPointId1 = loc.FindClosestPoint(list[1]) #point2
closestPointId2 = loc.FindClosestPoint(list[2]) #point3

#get the distance of the geodesic path 
appendFilter = vtk.vtkAppendFilter()
appendFilter.MergePointsOn()
points = vtk.vtkPoints()

vIds = [closestPointId,closestPointId1,closestPointId2]
p0 = [0,0,0]
p1 = [0,0,0]
dist = 0.0
for n in range(len(vIds)-1):
v0 = vIds[n]
v1 = vIds[n+1]
	
#create geodesic path: vtkDijkstraGraphGeodesicPath
dijkstra = vtk.vtkDijkstraGraphGeodesicPath()
dijkstra.SetInputConnection(pd.GetOutputPolyDataConnection())
dijkstra.SetStartVertex(v0)
dijkstra.SetEndVertex(v1)
dijkstra.Update()
				
pts = dijkstra.GetOutput().GetPoints()
end = n&lt;len(vIds)-2 and 0 or -1
for ptId in range(pts.GetNumberOfPoints()-1, end, -1):
pts.GetPoint(ptId, p0)
points.InsertNextPoint(p0)		  
for ptId in range(pts.GetNumberOfPoints()-1):
pts.GetPoint(ptId, p0)
pts.GetPoint(ptId+1, p1)
dist += math.sqrt(vtk.vtkMath.Distance2BetweenPoints(p0, p1))
   		
appendFilter.AddInputConnection(dijkstra.GetOutputPort())
print 'length= ', dist/10 ,'cm'</code></pre>

---
