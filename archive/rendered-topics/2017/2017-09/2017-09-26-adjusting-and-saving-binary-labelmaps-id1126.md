---
topic_id: 1126
title: "Adjusting And Saving Binary Labelmaps"
date: 2017-09-26
url: https://discourse.slicer.org/t/1126
---

# Adjusting and saving binary labelmaps

**Topic ID**: 1126
**Date**: 2017-09-26
**URL**: https://discourse.slicer.org/t/adjusting-and-saving-binary-labelmaps/1126

---

## Post #1 by @stevenagl12 (2017-09-26 19:22 UTC)

<p>I have cropped ROI volumes that were registered and their segmentations transforms and exported to binary labelmaps. I am trying to save those labelmaps to files that have the same dimensions so that I can create a probabilistic atlas from them. I assumed that the registration and transformation of those segmentations would have constrained the labelmap images to the same dimensions, but I guess I was wrong. Is there a way to shift all of the segmentation labelmaps to have the same number of binary voxels and save those images to be called up in MATLAB to perform the euclidean distance transform and such?</p>

---

## Post #2 by @lassoan (2017-09-26 19:40 UTC)

<p>When you export to Segmentation to Labelmap in Segmentations module’s Export-import section, in the Advanced section you can set a Reference volume. Segments will be padded/resampled to have the same geometry as the Reference volume.</p>
<p>Note that with numpy, SimpleITK, VTK, etc. libraries readily available in Slicer in Python, it’s hard to find anything that is worth sent to be computed in Matlab.</p>
<p>For example, you have several distance map computation algorithms in SimpleITK that you can call directly from Slicer. Just load MRHead sample volume and copy-paste this into the Python console:</p>
<pre><code>import SimpleITK as sitk
import sitkUtils

intputVolumeNode = getNode('MRHead')
inputImage = sitkUtils.PullVolumeFromSlicer(inputVolumeNode)

dtFilter = sitk.SignedMaurerDistanceMapImageFilter()
dtFilter.SetSquaredDistance(False)
outputImage = dtFilter.Execute(inputImage)
    
outputVolumeNode = sitkUtils.PushVolumeToSlicer(outputImage, name='DistanceMap')
slicer.util.setSliceViewerLayers(background = outputVolumeNode)</code></pre>

---

## Post #3 by @stevenagl12 (2017-09-26 20:16 UTC)

<p>Is there a way to add all of the distance maps generated by the filter and then normalize that output by using the max and minimum distances to get a probabilistic distance atlas in slicer?</p>

---

## Post #4 by @stevenagl12 (2017-09-26 20:17 UTC)

<p>Also, can slicer perform efficient belief propagation or markov random fields?</p>

---

## Post #5 by @lassoan (2017-09-26 20:20 UTC)

<aside class="quote no-group" data-username="stevenagl12" data-post="3" data-topic="1126" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/stevenagl12/48/3391_2.png" class="avatar"> stevenagl12:</div>
<blockquote>
<p>Is there a way to add all of the distance maps generated by the filter and then normalize that output by using the max and minimum distances to get a probabilistic distance atlas in slicer?</p>
</blockquote>
</aside>
<p>These seem to be basic numpy operations. Typically there is a direct mapping of these simple Matlab functions to numpy - see <a href="https://docs.scipy.org/doc/numpy-dev/user/numpy-for-matlab-users.html">https://docs.scipy.org/doc/numpy-dev/user/numpy-for-matlab-users.html</a>.</p>

---

## Post #6 by @lassoan (2017-09-26 20:28 UTC)

<aside class="quote no-group" data-username="stevenagl12" data-post="4" data-topic="1126">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/stevenagl12/48/3391_2.png" class="avatar"> stevenagl12:</div>
<blockquote>
<p>can slicer perform efficient belief propagation or markov random fields</p>
</blockquote>
</aside>
<p>ITK has some <a href="https://itk.org/Doxygen/html/group__MRFFilters.html">MRF filters</a>, you should be able to access them in Python via SimpleITK. There should be tons of other Python-based tools, which you may be able to import into Slicer directly (if they are Python-only). If you need larger, binary packages then for now you need to launch a separate Python interpreter to perform those computations (but this limitation should go away when Slicer is upgraded to use Python3).</p>

---

## Post #7 by @stevenagl12 (2018-06-13 17:03 UTC)

<p>Is there a way, that when saving a binary file, you can save the pixel values for a particular object as a specific number that you want? Say you have the object of a target artery among other things in the binary labelmap. Can you save the labelmap with those pixels as 7200, and others as specific codes? Or altering a saved binary labelmap to adhere to those codes?</p>

---

## Post #8 by @lassoan (2018-06-13 19:05 UTC)

<p>Probably the easiest is to export the segmentation to a labelmap node and then update voxel values with a numpy: <code>voxelArray[voxelArray &gt; 0] = 7200</code>. See examples in the <a href="https://www.slicer.org/wiki/Documentation/Nightly/ScriptRepository#Modify_voxels_in_a_volume">script repository</a>.</p>

---
