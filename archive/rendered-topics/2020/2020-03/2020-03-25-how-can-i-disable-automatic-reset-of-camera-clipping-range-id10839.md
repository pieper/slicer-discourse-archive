# How can I disable automatic reset of camera clipping range?

**Topic ID**: 10839
**Date**: 2020-03-25
**URL**: https://discourse.slicer.org/t/how-can-i-disable-automatic-reset-of-camera-clipping-range/10839

---

## Post #1 by @mikebind (2020-03-25 23:16 UTC)

<p>I am working on some endoscopic type visualizations where the camera is often quite close to surfaces (models or volume renderings).  These are automatically removed because they are too close to the camera’s close clipping plane, but I would like them to remain visible.  I can set the clipping range I want with code like</p>
<pre><code>camNode.GetCamera().SetClippingRange(.001,100)
</code></pre>
<p>However, as soon as I interact with the view with the mouse in any way (click and drag to rotate view, scroll wheel to zoom, middle click to translate) the clipping range is automatically reset to the values generated by</p>
<pre><code>camNode.GetCamera().ResetClippingRange()
</code></pre>
<p>Is there a way I can prevent this from happening?  Thanks!</p>

---

## Post #2 by @lassoan (2020-03-25 23:43 UTC)

<p>Near clipping distance is almost set to 0 automatically when you are inside any rendered object. It is not set to as low as 0.001 to avoid various inaccuracies and instabilities. See VTK’s clipping range setting implementation <a href="https://github.com/Kitware/VTK/blob/5fcd706ac4930f280fe1864738e2d63d0bef4a96/Rendering/Core/vtkRenderer.cxx#L1196-L1308">here</a>. You can ask experts on <a href="https://discourse.vtk.org/">VTK forum</a> about the details of this algorithm.</p>
<p>In practice, the automatically set near clipping distance should be sufficient (and you should be able to achieve the desired behavior by adjusting the camera position and view angle). What near clipping distance do you get by default? Do you use parallel projection? What view angle value do you use? Can you post a few screenshots?</p>
<p>You may experiment with adding an observer to the camera (with low priority, so it is called after default clipping range setting code is executed) and adjust the clipping range after each motion.</p>

---

## Post #3 by @mikebind (2020-03-26 17:08 UTC)

<p>Thanks for your help.  I am using a camera with a wide view angle (100 deg) to simulate an endoscopy camera.  The default clipping range the camera is reset to depends on the view, but is typically something like (0.3157, 315.7), with the far plane distance 100x the close plane distance.  With those default values, the view looks like this:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/7/677c6c3161adf53fea5ed8cb5ca7dab7a7bd512e.png" data-download-href="/uploads/short-url/eLtKJfOs69sjq9RGMzFI8u7w6Pc.png?dl=1" title="3DDefaultClip" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/7/677c6c3161adf53fea5ed8cb5ca7dab7a7bd512e_2_501x374.png" alt="3DDefaultClip" data-base62-sha1="eLtKJfOs69sjq9RGMzFI8u7w6Pc" width="501" height="374" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/7/677c6c3161adf53fea5ed8cb5ca7dab7a7bd512e_2_501x374.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/7/677c6c3161adf53fea5ed8cb5ca7dab7a7bd512e_2_751x561.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/7/677c6c3161adf53fea5ed8cb5ca7dab7a7bd512e_2_1002x748.png 2x" data-dominant-color="939427"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">3DDefaultClip</span><span class="informations">1572×1176 70.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>The camera is located entirely within the yellow structure, so the purple/blue exterior should not be visible. If I manually set the clipping range to (0.01,100), this is what I see instead:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/1/d1efdae245b639a15fa21623c0f95105e7eaf42b.png" data-download-href="/uploads/short-url/tXbG3txXzj9cTdqPwKZN2danItJ.png?dl=1" title="NearPlane_p01" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/1/d1efdae245b639a15fa21623c0f95105e7eaf42b_2_501x374.png" alt="NearPlane_p01" data-base62-sha1="tXbG3txXzj9cTdqPwKZN2danItJ" width="501" height="374" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/1/d1efdae245b639a15fa21623c0f95105e7eaf42b_2_501x374.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/1/d1efdae245b639a15fa21623c0f95105e7eaf42b_2_751x561.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/1/d1efdae245b639a15fa21623c0f95105e7eaf42b_2_1002x748.png 2x" data-dominant-color="959500"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">NearPlane_p01</span><span class="informations">1572×1176 88.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>I see from the vtk default clipping range code you sent that the problem for me is that the default range is limited to be a factor of at most 100 between the near clipping plane and the far clipping plane (unless the zBuffer depth is &gt;16bit).   I understand that the rationale for limiting the range is effective use of the zBuffer resolution, but because I am inside a small and curving tube, I do not need anything more than ~50 mm away to be rendered, and do want it to be clear the the camera is inside a tube.</p>
<p>I will look into how to add a low-priority observer to the camera to apply my own clipping range. Thanks.</p>

---

## Post #4 by @lassoan (2020-03-26 18:01 UTC)

<p>It is very important to limit the far/near distance ratio to keep the Z buffer functional, otherwise all features that rely on the z buffer may malfunction (picking, occlusion, depth peeling, etc.).</p>
<p>I could not reproduce problem of seeing outside a tube when being inside the tube. Could you share your scene?</p>

---

## Post #5 by @mikebind (2020-03-26 20:09 UTC)

<p>Here is a scene that illustrates this issue.<br>
<aside class="onebox googledrive">
  <header class="source">
      <a href="https://drive.google.com/file/d/1pExOr-DeX5yf4hrWUJTbsjsg39ZKdAVy/view?usp=drive_open" target="_blank" rel="nofollow noopener">drive.google.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://drive.google.com/file/d/1pExOr-DeX5yf4hrWUJTbsjsg39ZKdAVy/view?usp=drive_open" target="_blank" rel="nofollow noopener"><span class="googledocs-onebox-logo g-drive-logo"></span></a>



<h3><a href="https://drive.google.com/file/d/1pExOr-DeX5yf4hrWUJTbsjsg39ZKdAVy/view?usp=drive_open" target="_blank" rel="nofollow noopener">ToPostClip.mrb</a></h3>

<p>Google Drive file.</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<br>
When you open it, you should see the full 3D view showing the interior of a yellow tube.  However, if you click and drag anywhere on the view, you will see that the blue background becomes visible around the edges.  The camera has a view angle of 110 deg.  If you set the clipping range manually as follows, the enclosed view is restored:</p>
<pre><code>camNode = getNode('Camera')
camNode.GetCamera().SetClippingRange(0.1,50)</code></pre>

---
