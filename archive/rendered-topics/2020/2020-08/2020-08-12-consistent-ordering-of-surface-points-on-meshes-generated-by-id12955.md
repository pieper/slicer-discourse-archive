# Consistent ordering of surface points on meshes generated by SPHARM-PDM

**Topic ID**: 12955
**Date**: 2020-08-12
**URL**: https://discourse.slicer.org/t/consistent-ordering-of-surface-points-on-meshes-generated-by-spharm-pdm/12955

---

## Post #1 by @Zhiy (2020-08-12 01:59 UTC)

<p>Hi,</p>
<p>I am using SPHARM-PDM downloaded from <a href="https://www.nitrc.org/frs/download.php/6480/spharm-pdm_v1.13_linux64.zip" rel="noopener nofollow ugc">spharm-pdm_v1.13_linux64.zip</a>.<br>
My inputs are binary image files (*.nrrd). My expectation is that SPHARM-PDM can output triangle meshes that have a consistent ordering on the surface points. For example, those meshes are ordered from top to bottom, left to right, etc. The result is not, as shown in the picture below. This picture shows three surfaces (transparent ellipsoidal ones) generated by SPHARM. I connect the i_th point between surface <strong>a</strong> and <strong>b</strong>, forming the cyan line segment; I connect the i_th point between surface <strong>a</strong> and <strong>c</strong>, forming the red line segment. These two line segments share a same end on <strong>a</strong>. However, the other two ends apparently are on different sides, despite they have the same ordinal position on the respective mesh.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/b/db857f3603dba5808021835932dc2548b884f963.png" data-download-href="/uploads/short-url/vjYA4Ezj3djFDGS9MeEwYnOmIh5.png?dl=1" title="spharm_inconsistency" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/b/db857f3603dba5808021835932dc2548b884f963_2_520x500.png" alt="spharm_inconsistency" data-base62-sha1="vjYA4Ezj3djFDGS9MeEwYnOmIh5" width="520" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/b/db857f3603dba5808021835932dc2548b884f963_2_520x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/b/db857f3603dba5808021835932dc2548b884f963.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/b/db857f3603dba5808021835932dc2548b884f963.png 2x" data-dominant-color="587092"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">spharm_inconsistency</span><span class="informations">597×573 62.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Please help me look at the way I call the program. I guess that I missed some parameters  but I don’t know which. I know there are some about flip … But I’m not sure this is a general solution, i.e., I may need watch out the correspondence of every surface I generated; otherwise, I may have inconsistently oriented surfaces.  Anyone had such a problem?</p>
<p>I call SPHARM-PDM like this:</p>
<pre><code class="lang-auto">GenParaMeshCLP --label 255 image.nrrd output_para.vtk output_surf.vtk
ParaToSPHARMMeshCLP output_para.vtk output_surf.vtk final_mesh --subdivLevel 10
</code></pre>
<p>Also, I noticed that there are some updates in SPHARM-PDM. If a new version is suggested, could you please also suggest a convenient way to use SPHARM-PDM in a python script like the above or better?</p>
<p>Thanks in advance.</p>

---

## Post #2 by @styner (2020-08-13 19:17 UTC)

<p>Hi Zhiyuan<br>
the newest SPHARM-PDM distribution is part of SlicerSALT. We do not update the binary distributions on  NITRC anymore. So, you may want to check out SlicerSALT.</p>
<p>In addition, SPHARM-PDM will not give you good correspondences for objects with symmetry (in your case you have several symmetry axes) as the alignment of the parameter space is based on the first order ellipsoid. And I think that’s exactly what’s happening here, i.e. that one of the spherical parametrization phi or theta is flipped. You can manually force un/flip the parametrization using the final flip option in ParaToSPHARMMeshCLP</p>
<p>Martin</p>

---

## Post #3 by @Zhiy (2020-08-16 19:56 UTC)

<p>Thanks Martin. I guess for shapes that are slightly bent or twisted ellipsoids, the near-symmetry causes the same problem.</p>
<p>Zhiyuan</p>

---
