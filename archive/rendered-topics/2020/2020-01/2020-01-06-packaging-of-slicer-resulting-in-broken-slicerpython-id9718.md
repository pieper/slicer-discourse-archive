---
topic_id: 9718
title: "Packaging Of Slicer Resulting In Broken Slicerpython"
date: 2020-01-06
url: https://discourse.slicer.org/t/9718
---

# Packaging of Slicer resulting in broken SlicerPython

**Topic ID**: 9718
**Date**: 2020-01-06
**URL**: https://discourse.slicer.org/t/packaging-of-slicer-resulting-in-broken-slicerpython/9718

---

## Post #1 by @jamesobutler (2020-01-06 18:07 UTC)

<p>I have manually built Slicer (at <a href="https://github.com/Slicer/Slicer/commit/b8402a53083c0f132a37dc72eaa0000b10bc5235" rel="nofollow noopener">e17d2025</a>) and when I package the project and install it, then I noticed I’m unable to run SlicerPython.exe/PythonSlicer.exe. It is able to run from my build tree though.  I did not have any python paths present in any sys path environment variable at time of build.</p>
<pre><code class="lang-auto">PS C:\Users\JamesButler\AppData\Local\NA-MIC\Slicer 4.11.0-2019-12-06\bin&gt; ./SlicerPython.exe
PS C:\Users\JamesButler\AppData\Local\NA-MIC\Slicer 4.11.0-2019-12-06\bin&gt;
</code></pre>
<pre><code class="lang-auto">PS C:\S5R\python-install\bin&gt; ./SlicerPython.exe
Python 3.6.7 (default, Jan  6 2020, 07:41:45) [MSC v.1900 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt;
</code></pre>
<p>Is there something about LauncherSettings that are messed up in the packaged/installed version?</p>

---

## Post #2 by @Sam_Horvath (2020-01-06 18:24 UTC)

<p>The PythonSlicer/SlicerPython appears to be working in the most recent nightly.</p>
<pre><code class="lang-auto">PS C:\Users\sam.horvath\AppData\Local\NA-MIC\Slicer 4.11.0-2020-01-05\bin&gt; ./SlicerPython.exe
Python 3.6.7 (default, Jan  5 2020, 23:24:24) [MSC v.1900 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
</code></pre>
<p>…testing packaging on local machine currently…</p>

---

## Post #3 by @lassoan (2020-01-06 18:29 UTC)

<p>PythonSlicer in latest preview release (Slicer 4.11.0-2020-01-05) install works well for me, too. What do you mean that you are unable to run it? Is it a custom application or a factory build of Slicer?</p>
<aside class="quote no-group" data-username="jamesobutler" data-post="1" data-topic="9718">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/jamesobutler/48/7511_2.png" class="avatar"> jamesobutler:</div>
<blockquote>
<p>Is there something about LauncherSettings that are messed up in the packaged/installed version?</p>
</blockquote>
</aside>
<p>.ini file content is completely different for build and install tree, so it is possible that something only works in one but broken in the other. Most Python launcher settings are taken from the main application’s settings (designated by <code>additionalSettingsFilePath</code> field).</p>

---

## Post #4 by @jamesobutler (2020-01-06 18:33 UTC)

<blockquote>
<p>What do you mean that you are unable to run it?</p>
</blockquote>
<p>As I attempted to detail above in the powershell output, it just exits out automatically when I try to run it.</p>
<blockquote>
<p>Is it a custom application or a factory build of Slicer?</p>
</blockquote>
<p>It is not a Slicer Custom App. I just cloned, configured Slicer and used the default configure options and built. Then I proceeded to package this Slicer and install.</p>

---

## Post #5 by @lassoan (2020-01-06 18:34 UTC)

<p>Does factory-built Slicer installations work? Do you see any difference in the generated .ini files in factory-built and self-built versions in the install tree?</p>

---

## Post #6 by @Sam_Horvath (2020-01-06 18:35 UTC)

<p>Do you get any output if you run <code>./SlicerPython.exe --help</code> ?</p>

---

## Post #7 by @jamesobutler (2020-01-06 18:39 UTC)

<p>No output either when calling <code>./SlicerPython.exe --help</code></p>

---

## Post #8 by @jamesobutler (2020-01-06 18:47 UTC)

<p>I downloaded the nearly identical <a href="http://slicer.kitware.com/midas3/api/rest?method=midas.bitstream.download&amp;name=Slicer-4.11.0-2019-12-06-win-amd64.exe&amp;checksum=55a1586c7e72900647c400b94b31071b" rel="nofollow noopener">Slicer-4.11.0-2019-12-06-win-amd64</a> generated by the factory machine and running <code>./SlicerPython.exe</code> does actually work.</p>
<p>I checked for differences between factory and my package of SlicerPythonLauncherSettings, PythonSlicerLauncherSettings, SlicerDesignerLauncherSettings, and SlicerLauncherSettings.  The only difference was in SlicerLauncherSettings where mine specified <code>revision=e17d202</code> instead of <code>revision=28668</code>.</p>

---

## Post #9 by @Sam_Horvath (2020-01-06 18:50 UTC)

<p>What happens if you run <code>./python-real.exe</code> ?</p>

---

## Post #10 by @lassoan (2020-01-06 18:52 UTC)

<p>Does it work if you replace PythonSlicer.exe in your own build/install tree with the one in the factory-built package?</p>

---

## Post #11 by @jamesobutler (2020-01-06 18:56 UTC)

<p>After running ./python-real.exe</p>
<pre><code class="lang-auto">PS C:\Users\JamesButler\AppData\Local\NA-MIC\Slicer 4.11.0-2019-12-06\bin&gt; ./python-real.exe
Fatal Python error: Py_Initialize: unable to load the file system codec
ModuleNotFoundError: No module named 'encodings'

Current thread 0x000025c4 (most recent call first):
PS C:\Users\JamesButler\AppData\Local\NA-MIC\Slicer 4.11.0-2019-12-06\bin&gt;
</code></pre>

---

## Post #12 by @Sam_Horvath (2020-01-06 18:59 UTC)

<p>So, this looks like an error with the Python build itself, not the launcher.  Things are clearly missing from the install tree .The factory version gives the python prompt for me:</p>
<pre><code class="lang-auto">PS C:\Users\sam.horvath\AppData\Local\NA-MIC\Slicer 4.11.0-2020-01-05\bin&gt; ./python-real.exe
Python 3.6.7 (default, Jan  5 2020, 23:24:24) [MSC v.1900 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
</code></pre>
<p>I would try packaging from a clean build</p>

---

## Post #13 by @jamesobutler (2020-01-06 19:01 UTC)

<p>I started everything from a clean build tree today. There were no build errors and no packaging errors.</p>

---

## Post #14 by @lassoan (2020-01-06 19:01 UTC)

<aside class="quote no-group" data-username="Sam_Horvath" data-post="12" data-topic="9718">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/sam_horvath/48/3092_2.png" class="avatar"> Sam_Horvath:</div>
<blockquote>
<p>So, this looks like an error with the Python build itself, not the launcher. Things are clearly missing from the install tree .The factory version gives the python prompt for me:</p>
</blockquote>
</aside>
<p>This is very odd. Running ./python-real.exe without the launcher is expected to fail with <code>No module named 'encodings'</code> message (since it cannot find very basic Python libraries).</p>

---

## Post #15 by @lassoan (2020-01-06 19:06 UTC)

<p>I was able to reproduce the problem on my computer - my builds use <code>CTKAPPLAUNCHER\bin\CTKAppLauncherW.exe</code> as <code>SlicerPython.exe</code> and <code>PythonSlicer.exe</code>. This is incorrect, because <code>CTKAppLauncherW.exe</code> is a Windows GUI application and the <code>CTKAppLauncher.exe</code> console application should be used as launcher instead.</p>

---

## Post #16 by @Sam_Horvath (2020-01-06 19:06 UTC)

<p>Huh.  Guess its still the launcher then…</p>

---

## Post #17 by @lassoan (2020-01-06 19:12 UTC)

<p>The root cause of the problem is here:</p>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/Slicer/Slicer/blob/fa707a1fd3e78f9ce87969ce6248415ad8392546/CMake/SlicerBlockInstallPython.cmake#L111-L114" target="_blank">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/Slicer/Slicer/blob/fa707a1fd3e78f9ce87969ce6248415ad8392546/CMake/SlicerBlockInstallPython.cmake#L111-L114" target="_blank">Slicer/Slicer/blob/fa707a1fd3e78f9ce87969ce6248415ad8392546/CMake/SlicerBlockInstallPython.cmake#L111-L114</a></h4>
<pre class="onebox"><code class="lang-cmake"><ol class="start lines" start="111" style="counter-reset: li-counter 110 ;">
<li>set(_launcher CTKAppLauncher)</li>
<li>if(Slicer_BUILD_WIN32_CONSOLE)</li>
<li>  set(_launcher CTKAppLauncherW)</li>
<li>endif()</li>
</ol></code></pre>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Python should be always configured with CTKAppLauncher executable - regardless of the main application is a console or GUI application. I’ll push a fix.</p>

---

## Post #18 by @lassoan (2020-01-06 19:52 UTC)

<p>Fix committed in r28712.</p>

---

## Post #19 by @jamesobutler (2020-01-06 23:46 UTC)

<p>Thank you <a class="mention" href="/u/sam_horvath">@Sam_Horvath</a> for helping with debugging and thank you <a class="mention" href="/u/lassoan">@lassoan</a> for help debugging and issuing the Slicer fix! <img src="https://emoji.discourse-cdn.com/twitter/pray.png?v=9" title=":pray:" class="emoji" alt=":pray:"></p>
<p>I’ve tested the fix and can confirm that SlicerPython/PythonSlicer launches correctly when I package and install my Slicer build.</p>

---
