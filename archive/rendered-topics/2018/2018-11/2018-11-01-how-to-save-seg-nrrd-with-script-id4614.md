---
topic_id: 4614
title: "How To Save Seg Nrrd With Script"
date: 2018-11-01
url: https://discourse.slicer.org/t/4614
---

# How to save .seg.nrrd with script?

**Topic ID**: 4614
**Date**: 2018-11-01
**URL**: https://discourse.slicer.org/t/how-to-save-seg-nrrd-with-script/4614

---

## Post #1 by @kayarre (2018-11-01 18:05 UTC)

<p>Hi,<br>
I am trying to save a segmentation node using the <code>slicer.util.SaveNode</code> where the node is a <code>vtkMRMLSegmentationNode</code> but I get this weird error even though it appears to save the segmentation. it might be a bug somewhere else, but I can’t quite figure it out:</p>
<pre><code class="lang-auto">Saved node case4_ventricle in /home/sansomk/caseFiles/mri/VWI_proj/case4/image_vols/case4_ventricle.seg.nrrd
Warning: In /work/Stable/Slicer-4100/Libs/MRML/Core/vtkMRMLSegmentationNode.cxx, line 599
vtkMRMLSegmentationNode (0x86c6270): GenerateMergedLabelmap: Segment not found: vtkMRMLSegmentationNode1

Bad table range: [0, -1]

GetOutputImageData: Lookup table exists but empty!

Bad table range: [0, -1]

GetOutputImageData: Lookup table exists but empty!

error: [/home/sansomk/tools/Slicer-4.10.0-linux-amd64/bin/SlicerApp-real] exit abnormally - Report the problem.
</code></pre>
<p>so the problem is that it fails on:<br>
<code>slicer.vtkSlicerSegmentationsModuleLogic.ExportSegmentsToLabelmapNode(segmentationNode, segmentIDs, maskVolumeNode, inputVolumeNode)</code></p>
<p>I think maybe the problem is that segmentsIDs should be a array of each segment string…?</p>
<p>so this was the solution:</p>
<pre><code class="lang-auto">segmentIDs = vtk.vtkStringArray()
for segID in range(segmentationNode.GetSegmentation().GetNumberOfSegments()):
    segmentIDs.InsertNextValue(segmentationNode.GetSegmentation().GetNthSegmentID(segID))
</code></pre>

---

## Post #2 by @jcfr (2018-11-03 01:33 UTC)

<p>Thanks for reporting the problem.</p>
<p>Using Slicer (revision <a href="https://github.com/Slicer/Slicer/commit/36997169adf0e323015fb368aeb3ea9ecdb2e793">3699716</a>), after loading <code>MRHead</code> sample data and creating two segments, then using <code>slicer.util.saveNode</code>, I am not able to reproduce the problem.</p>
<p>Could you provide more details about the workflow leading to this error ?</p>
<p>Which exact version of Slicer are you using ?</p>
<pre><code class="lang-auto">&gt;&gt;&gt; slicer.util.saveNode(slicer.mrmlScene.GetNodeByID("vtkMRMLSegmentationNode1"), "/tmp/foo.seg.nrrd")
True
</code></pre>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/c/dc5d364db94c00de59fd3f4c8980b8ceb9a47512.png" data-download-href="/uploads/short-url/vrqKthiyh9NKjdoBlqBssqmGjZM.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/c/dc5d364db94c00de59fd3f4c8980b8ceb9a47512_2_690x382.png" alt="image" data-base62-sha1="vrqKthiyh9NKjdoBlqBssqmGjZM" width="690" height="382" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/c/dc5d364db94c00de59fd3f4c8980b8ceb9a47512_2_690x382.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/c/dc5d364db94c00de59fd3f4c8980b8ceb9a47512_2_1035x573.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/c/dc5d364db94c00de59fd3f4c8980b8ceb9a47512.png 2x" data-dominant-color="AEAEB6"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1272×705 174 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Looking at the header of the saved <code>nrrd</code> file also confirms the segments are saved:</p>
<pre><code class="lang-auto">$ head -n 30 /tmp/foo.seg.nrrd
NRRD0005
# Complete NRRD file format specification at:
# http://teem.sourceforge.net/nrrd/format.html
type: unsigned char
dimension: 4
space: right-anterior-superior
sizes: 2 74 1 116
space directions: none (0,-1,0) (-0,0,-1) (1.2999954223632799,-0,0)
kinds: list domain domain domain
encoding: gzip
space origin: (-86.6448974609375,23.928604125976989,-10.214302062987983)
measurement frame: (1,0,0) (0,1,0) (0,0,1)
Segment0_Color:=0.501961 0.682353 0.501961
Segment0_ColorAutoGenerated:=1
Segment0_Extent:=0 52 0 0 76 115
Segment0_ID:=Segment_1
Segment0_Name:=Segment_1
Segment0_NameAutoGenerated:=1
Segment0_Tags:=TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SRT^T-D0050^Tissue~SRT^T-D0050^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|
Segment1_Color:=0.945098 0.839216 0.568627
Segment1_ColorAutoGenerated:=1
Segment1_Extent:=3 73 0 0 0 65
Segment1_ID:=Segment_2
Segment1_Name:=Segment_2
Segment1_NameAutoGenerated:=1
Segment1_Tags:=TerminologyEntry:Segmentation category and type - 3D Slicer General Anatomy list~SRT^T-D0050^Tissue~SRT^T-D0050^Tissue~^^~Anatomic codes - DICOM master list~^^~^^|
Segmentation_ContainedRepresentationNames:=Binary labelmap|Closed surface|
Segmentation_ConversionParameters:=Compute surface normals|1|Compute surface normals. 1 (default) = surface normals are computed. 0 = surface normals are not computed (slightly faster but produces less smooth surface display).&amp;Crop to reference image geometry|0|Crop the model to the extent of reference geometry. 0 (default) = created labelmap will contain the entire model. 1 = created labelmap extent will be within reference image extent.&amp;Decimation factor|0.0|Desired reduction in the total number of polygons. Range: 0.0 (no decimation) to 1.0 (as much simplification as possible). Value of 0.8 typically reduces data set size by 80% without losing too much details.&amp;Fractional labelmap oversampling factor|1|Determines the oversampling of the reference image geometry. All segments are oversampled with the same value (value of 1 means no oversampling).&amp;Oversampling factor|1|Determines the oversampling of the reference image geometry. If it's a number, then all segments are oversampled with the same value (value of 1 means no oversampling). If it has the value "A", then automatic oversampling is calculated.&amp;Reference image geometry|0;0;1.29999542236328;-86.6448974609375;-1;0;0;133.928604125977;0;-1;0;116.785697937012;0;0;0;1;0;255;0;255;0;129;|Image geometry description string determining the geometry of the labelmap that is created in course of conversion. Can be copied from a volume, using the button.&amp;Smoothing factor|0.5|Smoothing factor. Range: 0.0 (no smoothing) to 1.0 (strong smoothing).&amp;Threshold fraction|0.5|Determines the threshold that the closed surface is created at as a fractional value between 0 and 1.&amp;
Segmentation_MasterRepresentation:=Binary labelmap
Segmentation_ReferenceImageExtentOffset:=110 127 0
</code></pre>

---

## Post #3 by @kayarre (2018-11-05 23:36 UTC)

<p>Version 4.10</p>
<p>What I determined is that I was passing the segmentationNode instead of a list of the segments that make up the segmentationNode.<br>
Does that make sense? I am using a modified version of the slicer case iterator module.</p>

---

## Post #4 by @lassoan (2018-11-06 02:43 UTC)

<p>You can use <code>slicer.vtkSlicerSegmentationsModuleLogic.ExportSegmentsToLabelmapNode</code> method if you want to export selected segments.</p>
<p>To export all segments, use <code>slicer.vtkSlicerSegmentationsModuleLogic.ExportAllSegmentsToLabelmapNode</code> method.</p>

---

## Post #5 by @Saima (2023-06-13 03:19 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="4" data-topic="4614">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p><code>sModuleLogic.ExportAllSegmentsToLabelmapNode</code> method.</p>
</blockquote>
</aside>
<p>Hi Andras,<br>
I am getting the following do not understand why?</p>
<p>[VTK] SetAndObserveColorToDisplayNode failed: invalid Colors module logic.</p>
<p>[VTK] SetAndObserveColorToDisplayNode failed: invalid Colors module logic.</p>
<p>[VTK] Generic Warning: In /work/Preview/Slicer-0/Libs/MRML/Core/vtkDataFileFormatHelper.cxx, line 237</p>
<p>[VTK] vtkDataFileFormatHelper::GetFileExtensionFromFormatString: please update deprecated extension-only format specifier to ‘File format name (.ext)’ format! Current format string: .nrrd</p>
<p>[VTK] Generic Warning: In /work/Preview/Slicer-0/Libs/MRML/Core/vtkDataFileFormatHelper.cxx, line 237</p>
<p>[VTK] vtkDataFileFormatHelper::GetFileExtensionFromFormatString: please update deprecated extension-only format specifier to ‘File format name (.ext)’ format! Current format string: .nrrd</p>
<p>[VTK] RequestInformation: No LookupTable was set but number of components in input doesn’t match OutputFormat, therefore input can’t be passed through!</p>
<p>regards,<br>
Saima</p>

---
