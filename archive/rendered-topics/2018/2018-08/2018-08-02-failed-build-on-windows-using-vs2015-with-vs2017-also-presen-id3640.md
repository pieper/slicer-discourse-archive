# Failed build on Windows using VS2015 (with VS2017 also present on system)

**Topic ID**: 3640
**Date**: 2018-08-02
**URL**: https://discourse.slicer.org/t/failed-build-on-windows-using-vs2015-with-vs2017-also-present-on-system/3640

---

## Post #1 by @KaburNaj (2018-08-02 21:28 UTC)

<p>Operating system: Windows 7 Enterprise, Service Pack 1<br>
Slicer version: 4.8.1 (r26813)<br>
Expected behavior: Build from Source<br>
Actual behavior: Build errors in CTK project</p>
<p>I am building the latest stable release of Slicer from source using Visual Studio 2015 under Windows 7. I also have Visual Studio 2017 on my system. All the projects build successfully for me with one exception (CTK), which I think then causes the Slicer project to also fail. The error codes I get are:</p>
<ul>
<li>Error	C4430	missing type specifier - int assumed. Note: C++ does not support default-int [C:\Slicer\Build\CTK-build\CTK-build\Libs\Widgets\CTKWidgets.vcxproj] [C:\Slicer\Build\CTK-build\CTK.vcxproj]	CTK	C:\Slicer\Build\CTK\Libs\Widgets\ctkPathListButtonsWidget_p.h	60</li>
<li>Error	C2143	syntax error: missing ‘,’ before ‘&amp;’ [C:\Slicer\Build\CTK-build\CTK-build\Libs\Widgets\CTKWidgets.vcxproj] [C:\Slicer\Build\CTK-build\CTK.vcxproj]	CTK	C:\Slicer\Build\CTK\Libs\Widgets\ctkPathListButtonsWidget_p.h	60</li>
<li>Error	C4430	missing type specifier - int assumed. Note: C++ does not support default-int [C:\Slicer\Build\CTK-build\CTK-build\Libs\Widgets\CTKWidgets.vcxproj] [C:\Slicer\Build\CTK-build\CTK.vcxproj]	CTK	C:\Slicer\Build\CTK-build\CTK-build\Libs\Widgets\moc_ctkPathListButtonsWidget_p.cpp	95</li>
<li>Error	C2146	syntax error: missing ‘&gt;’ before identifier ‘QItemSelection’ [C:\Slicer\Build\CTK-build\CTK-build\Libs\Widgets\CTKWidgets.vcxproj] [C:\Slicer\Build\CTK-build\CTK.vcxproj]	CTK	C:\Slicer\Build\CTK-build\CTK-build\Libs\Widgets\moc_ctkPathListButtonsWidget_p.cpp	95</li>
</ul>
<p>When Googling the error codes, the only seemingly related discussions I could find were these two: <a href="https://www.tt-forums.net/viewtopic.php?t=75394" rel="noopener nofollow ugc">OpenTTD</a> and <a href="https://github.com/maven-nar/nar-maven-plugin/issues/217" rel="noopener nofollow ugc">NAR for Maven</a></p>
<p>This made me guess that the Windows SDK 10 was the source of the issue. I uninstalled Windows SDK 10 from the computer (via the Control Panel Add/Remove programs), and installed SDK 8.1 from <a href="https://developer.microsoft.com/en-us/windows/downloads/sdk-archive" rel="noopener nofollow ugc">Microsoft</a>.</p>
<p>This doesn’t seem to resolve the issue. Snooping around I see that there are still some apparent remnants of SDK 10 (including the <a href="https://blogs.msdn.microsoft.com/vcblog/2015/03/03/introducing-the-universal-crt/" rel="noopener nofollow ugc">UCRT headers</a>) to be found under <code>C:\Program Files (x86)\Windows Kits\</code> and <code>C:\Program Files (x86)\Microsoft SDKs\Windows Kits\</code>. I have no idea if these are what’s causing the problem, but when I manually removed any links to these directories in the VC++ Directories for the CTK project, I still get the same errors.</p>
<p>Some VS macros (generated by CMake?) which seem relevant here are:</p>
<ul>
<li>
<code>$(DefaultWindowsSDKVersion)</code> : 8.1</li>
<li>
<code>$(FrameWorkSdkDir)</code> : <code>C:\Program Files (x86)\Windows Kits\8.1\</code>
</li>
<li>
<code>$(SDKVersion)</code> : 10.0</li>
<li>
<code>$(TargetPlatformVersion)</code> : 8.1</li>
<li>
<code>$(TargetUniversalCRTVersion)</code> : 10.0.10240.0</li>
<li>
<code>$(UCRTContentRoot)</code> : <code>C:\Program Files (x86)\Windows Kits\10\</code>
</li>
<li>
<code>$(WindowsSdkDir)</code> : <code>C:\Program Files (x86)\Windows Kits\8.1\</code>
</li>
</ul>
<p>I have tried without success to see where the logic occurs in the CMakeLists.txt and the *.cmake files which might be setting these VS macros, to track down why <code>$(SDKVersion)</code> is being set to 10.0.</p>
<p>Any guidance on how to proceed would be greatly appreciated. I’m loath to uninstall VS 2017 unless I absolutely have to. (I already feel like uninstalling the 10.0 windows kits was more aggressive than I’d prefer, but hoped it might resolve things and let me proceed.)</p>

---

## Post #2 by @lassoan (2018-08-02 21:35 UTC)

<p>You need to use the official build configuration (Visual Studio version, Qt version, etc). For building 4.8.1 you may need to use VS2013.</p>
<p>See build instructions for 4.8.1 <a href="https://www.slicer.org/wiki/Documentation/4.8/Developers/Build_Instructions">here</a>.</p>
<p>However, I would recommend to build latest version on master branch instead, Since 4.10 will be out very soon, which will be based on current master branch (4.9.x). See instructions <a href="https://www.slicer.org/wiki/Documentation/Nightly/Developers/Build_Instructions">here</a>.</p>

---

## Post #3 by @ihnorton (2018-08-03 03:22 UTC)

<p>VS2017 has been known to move files from existing installations of other versions:</p>
<aside class="onebox stackexchange" data-onebox-src="https://stackoverflow.com/questions/43847542/rc-exe-no-longer-found-in-vs-2015-command-prompt/45319119#45319119">
  <header class="source">

      <a href="https://stackoverflow.com/questions/43847542/rc-exe-no-longer-found-in-vs-2015-command-prompt/45319119#45319119" target="_blank" rel="noopener">stackoverflow.com</a>
  </header>

  <article class="onebox-body">
      <a href="https://stackoverflow.com/users/3285167/davecleland" target="_blank" rel="noopener">
    <img alt="DaveCleland" src="https://www.gravatar.com/avatar/cc135a8c25a5487e2222cbd85d14db00?s=256&amp;d=identicon&amp;r=PG&amp;f=1" class="thumbnail onebox-avatar" width="" height="">
  </a>

<h4>
  <a href="https://stackoverflow.com/questions/43847542/rc-exe-no-longer-found-in-vs-2015-command-prompt/45319119#45319119" target="_blank" rel="noopener">rc.exe no longer found in VS 2015 Command Prompt</a>
</h4>

<div class="tags">
  <strong>c++, windows, cmake, windows-10</strong>
</div>

<div class="date">
  
  answered by
  <a href="https://stackoverflow.com/users/3285167/davecleland" target="_blank" rel="noopener">
    DaveCleland
  </a>
  on <a href="https://stackoverflow.com/questions/43847542/rc-exe-no-longer-found-in-vs-2015-command-prompt/45319119#45319119" target="_blank" rel="noopener">06:31AM - 26 Jul 17 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>so try re-running the VS2015 setup if you encounter further problems (while building the recommended configuration mentioned by Andras).</p>

---

## Post #4 by @KaburNaj (2018-08-03 07:02 UTC)

<p>Andras:</p>
<p>Thank you for the heads up about the 4.8 build instructions. I had been following the nightly build instructions because that’s all I could find via the wiki (both from the <a href="https://download.slicer.org/" rel="nofollow noopener">download page</a> and the <a href="https://www.slicer.org/wiki/Documentation/Nightly/Developers" rel="nofollow noopener">developer manual page</a>). For what it’s worth, the instructions for downloading specific Slicer revisions using <code>svn co</code> in §2.3 seem to suggest that this page also applies to building 4.8.1.</p>
<p>As per your suggestion, I’m now trying to build 4.9.0 (r27331) using VS2015. If that doesn’t work, I’ll install VS2013 and follow the 4.8 build instructions.</p>

---

## Post #5 by @KaburNaj (2018-08-03 07:08 UTC)

<p>Isaiah:</p>
<p>Good to know, thanks! I don’t expect that’s my issue, since I had VS2017 installed before I installed VS2015. In fact, I had originally tried to build the then current master branch of Slicer from github under VS2017. This was spectacularly unsuccessful, which is what prompted me to install VS2015 and switch the source to the stable release 4.8.1 (hah!).</p>
<p>CMake seems to be working fine for me, whether I launch it from the developer command prompt or from just simply cmd.exe. I also cleaned up my system and user Path environment variables just in case they were pointing to the Windows Kit 10 instead of 8.1 (which one of them was).</p>
<p>For now, I will follow through on the guidance from Andras above; but if it that doesn’t work and it seems that this VS2017 competition might actually be a factor, I’ll look a bit closer into it.</p>

---

## Post #6 by @lassoan (2018-08-03 09:45 UTC)

<p>My experience is that you end up corrupting visual studio configuration of you install them out of order (install older version after installing a newer version). To fix that, uninstall all versions and reinstall them in the same order as they were released.</p>

---

## Post #7 by @KaburNaj (2018-08-03 16:54 UTC)

<p>Andras:</p>
<p>Yikes. Alright, I’ll keep that in mind if I continue to have build problems or if I end up needing to build the stable release and therefore have to install VS2013.</p>
<p>The build I initiated last night seems to have been successful, except for a Qt dependency issue in the Slicer project. Qt 5.11.1 only includes the WebEngine component for VS2017 and not VS2015, so I’m rolling it back to Qt 5.6.3, and trying again.</p>

---

## Post #8 by @lassoan (2018-08-03 17:36 UTC)

<p>I use Qt 5.10.0 msvc2015_64 with latest VisualStudio (2017 Community) using VS2015 toolset (-T v140).</p>

---

## Post #9 by @KaburNaj (2018-08-03 17:53 UTC)

<p>Very useful to know. Thank you! If my current efforts don’t work out, I’ll give that a go.</p>

---

## Post #10 by @KaburNaj (2018-08-04 08:13 UTC)

<p>Yes, it appears to have completed the build successfully. Many thanks for the guidance!</p>

---

## Post #11 by @lassoan (2018-08-04 12:37 UTC)

<p>Great! Which Visual Studio, toolset, and Qt version did you end up using?</p>

---

## Post #12 by @KaburNaj (2018-08-07 23:39 UTC)

<p>I used the default native compilers (x64) under VS2015 and Qt 5.6.3.</p>
<p>I will also try the combination you mentioned, as I would prefer to stick with just one flavour of Visual Studio if I can, and I’m already using the VS2017 IDE for other tasks.</p>

---

## Post #13 by @dzenanz (2018-09-27 14:24 UTC)

<aside class="quote no-group" data-username="KaburNaj" data-post="7" data-topic="3640">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/kaburnaj/48/1971_2.png" class="avatar"> KaburNaj:</div>
<blockquote>
<p>Qt 5.11.1 only includes the WebEngine component for VS2017 and not VS2015</p>
</blockquote>
</aside>
<p>I hit this problem recently, too. <a class="mention" href="/u/lassoan">@lassoan</a> <a class="mention" href="/u/jcfr">@jcfr</a> Are there plans to enable compiling with VS2017? Or we stick to Qt 5.10 and earlier for now? Do we know what are the blockers for compiling with VS2017?</p>

---

## Post #14 by @lassoan (2018-09-27 14:55 UTC)

<p>We plan to release Slicer-4.10 within days, with VS2015 as officially supported compiler.</p>
<p>After that, we’ll start migration to Python3. We’ll have to match Python’s VS compiler version to be ABI compatible (to be able to pip install any packages into Slicer’s embedded Python). Python 3.6 is built with VS2015, so most likely we’ll stick to it for a while.</p>
<p>We may remove QtWebEngine dependency in Slicer, so we may be able to upgrade Qt while keep using VS2015.</p>

---

## Post #15 by @Saima (2019-01-08 04:49 UTC)

<p>Hi Andras,<br>
Can I use vs 2017 community addition for building slicer 4.10 with qt.5.10.</p>
<p>Regards,<br>
Saima Safdar</p>

---

## Post #16 by @Saima (2019-01-08 04:51 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="8" data-topic="3640" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>I use Qt 5.10.0 msvc2015_64 with latest VisualStudio (2017 Community) using VS2015 toolset (-T v140).</p>
</blockquote>
</aside>
<p>for slicer version 4.10?</p>

---

## Post #17 by @jamesobutler (2019-01-08 05:34 UTC)

<p>Yes, the master branch at the time of earlier posts transitioned to become Slicer 4.10. You can use Visual Studio 2017, but <em>specifically</em> with the VS2015 toolset. <a href="https://www.slicer.org/wiki/Documentation/Nightly/Developers/Build_Instructions#Experimental.2Fdeprecated_build_environments" rel="nofollow noopener">https://www.slicer.org/wiki/Documentation/Nightly/Developers/Build_Instructions#Experimental.2Fdeprecated_build_environments</a></p>
<p>Other build notes for Windows can be found on that same Slicer wiki page.</p>

---
