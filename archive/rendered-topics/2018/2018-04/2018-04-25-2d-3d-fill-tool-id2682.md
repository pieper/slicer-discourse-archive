# 2D/3D fill tool

**Topic ID**: 2682
**Date**: 2018-04-25
**URL**: https://discourse.slicer.org/t/2d-3d-fill-tool/2682

---

## Post #1 by @Leon (2018-04-25 09:13 UTC)

<p>Hi,</p>
<p>Just a simple question for which I hope there is a simple answer.</p>
<p>I’m exploring 3DSlicer as a possible alternative to Mimics. To do this I’m segmenting a femur that I already segmented with Mimics to compare the outcome.<br>
I started by first thresholding for the cortical layer. Then I made sure that there are no more holes connecting the inside of the femur to the outside world by closing them manually with the paint tool (cortex layer is now completely closed).<br>
Now I want to fill the complete inside of the femur like I normally do in Mimics with their ‘Fill cavity’ tool which works in 3D as well as in 2D. Is there a Slicer- tool that can 2D/3D-fill the entire slice/bone (like in Mimics) and where can I find it?</p>
<p>Greeting Léon</p>

---

## Post #2 by @lassoan (2018-04-25 12:46 UTC)

<p>You can fill small holes using Smoothing effect / Closing (fill holes). If large cavities remain then you can fill them by following these steps:</p>
<ul>
<li>Logical operators effect, Invert operation =&gt; Apply</li>
<li>Islands effect, Keep largest island =&gt; Apply</li>
<li>Logical operators effect, Invert operation =&gt; Apply</li>
</ul>
<p>Let us know if you have any further questions. You should be able to do everything that you could to with Mimics, and much more.</p>

---

## Post #3 by @pieper (2018-04-25 13:02 UTC)

<p>I’m thinking we might want to starta specific guide like “Segment Editor for Mimics Users” (analogous to <a href="http://mathesaurus.sourceforge.net/matlab-numpy.html">numpy for matlab users)</a></p>

---

## Post #4 by @Leon (2018-04-25 14:02 UTC)

<p>Might be a good idea. But in the meantime it is a very usefull tool that I’m missing here.</p>

---

## Post #5 by @lassoan (2018-04-25 14:07 UTC)

<p>Do you get the cavity filling effect that you need by following the 3 steps that I described above (invert, keep largest island, invert)?</p>
<p>If it works well and the only problem is that it takes 8 mouse clicks then we may create a dedicated “Fill cavity” effect that does the same with a single mouse click.</p>

---

## Post #6 by @pstjohn (2018-04-25 18:37 UTC)

<p>Hi Andras,</p>
<p>That process worked for me (I happened to also be segmenting a femur).  If your steps are enclosed in margin effect ‘grow’ and ‘shrink’ operations the amount of manual editing to close the cortical bone gaps is reduced.  (Equivalent to using Mimics morphology operations ‘dilate’ and ‘erode’ to accomplish the same task around a cavity fill operation.)</p>
<p>Regards.</p>
<p>-Paul.</p>

---

## Post #7 by @lassoan (2018-04-25 19:22 UTC)

<aside class="quote no-group" data-username="pstjohn" data-post="6" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://avatars.discourse-cdn.com/v4/letter/p/a587f6/48.png" class="avatar"> pstjohn:</div>
<blockquote>
<p>If your steps are enclosed in margin effect ‘grow’ and ‘shrink’ operations the amount of manual editing to close the cortical bone gaps is reduced.</p>
</blockquote>
</aside>
<p>Have you tried using Does Smoothing effect / Closing (fill holes) before cavity fill instead? It is simpler to do then margin growing/shrinking (since it is just one step instead of two) and may provide very similar result.</p>

---

## Post #8 by @Leon (2018-04-26 07:25 UTC)

<p>That worked fine for me.<br>
I don’t know if it’s going to work in other situations too, but for now it’s ok.</p>
<p>But I still think that a simple 2D/3D-bucketfill tool like Mimics uses would be much nicer and more intuitive to work with, specially when you can also use it to easily fill a hole in a 2D plane/slice. Maybe something to consider?<br>
By the way,  Seg3D also has a fill tool (which only works in 3D mode).</p>
<p>For now it’s one point for the Mimics guys! <img src="https://emoji.discourse-cdn.com/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>

---

## Post #9 by @Leon (2018-04-26 07:55 UTC)

<p><span class="mention">@Paul</span>,</p>
<p>That only works well when you’re dealing with small gaps of maybe 2 to 3 voxels. Higher settings will eventually affect your morphology, because you loose the smaller details, so I think you should be very carefull with this option.</p>
<p>When I manually close the gaps in a cortical layer I always start with Mimics paint/lasso tool in threshold setting and I lower the lowest threshold value and start to paint over the gaps, so that  the software ‘finds’ the missing voxelcontour, which leads to a more smoother closing then by using a solid paintbrush. At the end I close the final gaps with a solid paintbrush.</p>

---

## Post #10 by @lassoan (2018-04-26 11:55 UTC)

<aside class="quote no-group" data-username="Leon" data-post="8" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/leon/48/1468_2.png" class="avatar"> Leon:</div>
<blockquote>
<p>For now it’s one point for the Mimics guys</p>
</blockquote>
</aside>
<p>I’m not so sure. There are two bucket fill features available in the Segment Editor (I admit, not easy to find).</p>
<ol>
<li>
<p>Islands effect / Add selected island</p>
</li>
<li>
<p>Flood fill effect (provided by SegmentEditorExtraEffects extension) - this one has some experimental features to limit leaking through small holes</p>
</li>
</ol>
<p>The main advantage of Slicer compared to proprietary packages is that we can move faster, make changes and improve things based on user feedbacks in a matter of days. So, if you find that anything is lacking or you have any suggestions then let us know.</p>

---

## Post #11 by @lassoan (2018-04-26 12:37 UTC)

<aside class="quote no-group" data-username="Leon" data-post="9" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/leon/48/1468_2.png" class="avatar"> Leon:</div>
<blockquote>
<p>When I manually close the gaps in a cortical layer I always start with Mimics paint/lasso tool in threshold setting and I lower the lowest threshold value and start to paint over the gaps</p>
</blockquote>
</aside>
<p>Note that you can enable thresholding for any effect, including in Paint and Draw (=lasso):</p>
<ul>
<li>select an effect</li>
<li>in Masking section, enable “Editable intensity range”</li>
</ul>
<p>To set editable intensity range with preview:</p>
<ul>
<li>select Threshold effect</li>
<li>adjust threshold slider, selected intensity range will be glowing in the image</li>
<li>click “Use for masking” to set selected range for “Editable intensity range”</li>
</ul>

---

## Post #12 by @Leon (2018-04-26 13:18 UTC)

<p>Thanks Andras,</p>
<p>I already discovered this threshold painting and lassoing. Works kinda similar as in Mimics.<br>
About the bucket fill; I must admit I didn’t know that. I have to play a little bit more, but things (for me as an experienced Mimics user) are hard to find in Slicer and the workflow is different. Needs some time.</p>
<p>I recently rediscovered Slicer after my first try about a year ago and I now experimenting to see if it can be used instead of Mimics (although this is a very power- and feature full application). We have a lot of students here who have to do segmentations and Mimics is very pricey, so we only have 3 licences. Maybe Slicer can help us in reducing that.</p>

---

## Post #13 by @pstjohn (2018-04-26 13:44 UTC)

<p>Andras:</p>
<p>I’ve ‘played’ with both.  Not sure yet which I prefer or the indicators for which to use and when.  I tend to be conservative with smoothing operations.  Have a couple of hip segmentations mid May and will try both approaches with each.</p>
<p>Cheers,</p>
<p>-P</p>

---

## Post #14 by @hherhold (2018-04-26 13:44 UTC)

<p>Just as an aside, I think a lot of things come down to getting used to the UI and workflow. I used to use Volume Graphics VG Studio Max 3 up until about a year ago, when I “cut the cord” and switched to Slicer. For my purposes, I’ve yet to find anything that I have missed from VG Studio Max that Slicer can’t do, and there are many things (for me) that Slicer does better (or VG just doesn’t do). And the active community of developers and users is simply fantastic.</p>
<p>Disclaimer - this could easily de-volve into a religious discussion regarding pros and cons of various applications, so I’ll just say whatever works for you is great.</p>

---

## Post #15 by @pstjohn (2018-04-26 13:48 UTC)

<p>Leon:</p>
<p>Absolutely true, care is required.  The tactic, used properly, reduces but does not eliminate manual editing to close mask (label) gaps.</p>

---

## Post #16 by @lassoan (2018-04-26 15:11 UTC)

<aside class="quote no-group" data-username="Leon" data-post="12" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/leon/48/1468_2.png" class="avatar"> Leon:</div>
<blockquote>
<p>Mimics is very pricey, so we only have 3 licences. Maybe Slicer can help us in reducing that.</p>
</blockquote>
</aside>
<p>Yes, cost may be an important factor, but it is not just that. Slicer and commercial clinical applications are playing in different fields.</p>
<p>For research, prototyping, and education purposes Slicer is much better, due to its openness, extensibility, comprehensive feature set, and large, very helpful and knowledgeable user/developer community.</p>
<p>For routine clinical tasks, you are required to use regulatory-approved software, with simpler, locked-down user interface and feature set. Mimics and other commercial software address this need directly. In contrast, clinical use of Slicer is the user’s own responsibility (we need obtain ethics/institutional review board approval for each study) and often user interface customization is needed for ease of use.</p>

---

## Post #17 by @timeanddoctor (2018-04-28 11:15 UTC)

<p>I think a boolean calculate( unite and subtract ) based on the 3D file( not the 2D, operation in 3d slicer) is very important as well as.<br>
The result in 3d slicer generated by the method calculate a segment  in segmentation for STL is very rough<br>
And now I must have a subtract boolean calculate in Blender or 3matic for STL.</p>

---

## Post #18 by @lassoan (2018-04-28 12:46 UTC)

<aside class="quote no-group" data-username="timeanddoctor" data-post="17" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/timeanddoctor/48/5839_2.png" class="avatar"> timeanddoctor:</div>
<blockquote>
<p>The result in 3d slicer generated by the method calculate a segment  in segmentation for STL is very rough</p>
</blockquote>
</aside>
<p>You can get very fine, smooth result in Slicer, you just need to use higher resolution labelmap representation in the segmentation. For example, for 3D printing set voxel spacing to 0.1 to 0.3 mm should work well. This may require lot of memory if you don’t crop the volume to a small region. Both cropping an resampling can be done using Crop volume module. When the high-resolution cropped volume is ready then you need to create a new segmentation node from scratch and select that as master volume.</p>

---

## Post #19 by @EisaAlyaqoub (2018-06-12 08:08 UTC)

<p>Thank you for showing the steps.</p>
<p>Can I do that when I import sol file ?</p>
<p>Thank you</p>

---

## Post #20 by @lassoan (2018-06-13 00:44 UTC)

<p>Can you describe what a sol file is? Maybe you mean STL?</p>

---

## Post #21 by @EisaAlyaqoub (2018-06-13 01:41 UTC)

<p>`yes I meant STL file.</p>

---

## Post #22 by @lassoan (2018-06-13 20:55 UTC)

<p>Yes, you can load an STL file into Slicer, import it into a segmentation node in Segmentations module, and edit it in Segment editor module. You need to select a reference volume that defines resolution and axis direction of the edited binary labelmap in the segmentation.</p>

---

## Post #23 by @evaherbst (2024-04-16 08:14 UTC)

<p>Hi <a class="mention" href="/u/lassoan">@lassoan</a> ,</p>
<p>I am reviving this topic because I found your suggested method of inverting, keeping largest island, then inverting again very helpful.</p>
<p>I have a case where I have several interior holes in the segmentation that I would like to fill.</p>
<p>I see I can make segments from islands, but then they show up as separate segments.</p>
<p>Is there an existing way to add all of the islands together or would I need to write my own code to loop through all of the segments and add each one using logical operators:add?</p>
<p>I tried surface wrap solidify but this shrink wraps over some concave regions on the surface so I prefer using the islands approach.</p>
<p>UPDATE: I notice if I add islands as segments with the setting  “overwrite all” they islands are not only created as new segments but also included in segment_1 (the original). This is unexpected behaviour to me, but works for my use case. But I am confused why it is happening</p>
<p>Thank you very much,<br>
Eva</p>

---

## Post #24 by @lassoan (2024-04-16 13:39 UTC)

<aside class="quote no-group" data-username="evaherbst" data-post="23" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/evaherbst/48/65595_2.png" class="avatar"> evaherbst:</div>
<blockquote>
<p>Is there an existing way to add all of the islands together or would I need to write my own code to loop through all of the segments and add each one using logical operators:add?</p>
</blockquote>
</aside>
<p>You can use Logical operations → Fill, with masking option to editable region within visible segments.</p>
<aside class="quote no-group" data-username="evaherbst" data-post="23" data-topic="2682">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/evaherbst/48/65595_2.png" class="avatar"> evaherbst:</div>
<blockquote>
<p>surface wrap solidify but this shrink wraps over some concave regions on the surface so I prefer using the islands approach</p>
</blockquote>
</aside>
<p>You can adjust effect parameters to carve out concave regions.</p>

---

## Post #25 by @evaherbst (2024-04-16 14:07 UTC)

<p>Thanks Andras for the quick reply!</p>
<blockquote>
<p>You can use Logical operations → Fill, with masking option to editable region within visible segments</p>
</blockquote>
<p>Thank you for the suggestion. I just realized that splitting into segments doesn’t add them all to the initial mask, just the first one, which would be expected with my settings:<br>
<img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/c/5c1d390690af0298fb41191658646e3cce40ecee.png" alt="image" data-base62-sha1="d8Sxhg7P6uMnn3LECCnPpa59Qrc" width="419" height="139"></p>
<p>I guess I will go with a loop of adding all of the separate islands back in in the case where there is more than 1 island.</p>
<blockquote>
<p>You can adjust effect parameters to carve out concave regions<br>
Thank you, but I worry the variation in bony anatomy will prevent automation for all patients.</p>
</blockquote>
<p>Thanks again!<br>
Eva</p>

---

## Post #26 by @evaherbst (2024-04-16 16:46 UTC)

<p>Hi <a class="mention" href="/u/andras13">@andras13</a></p>
<p>Just to update you, the code looping through all segments and adding them together with logical operations works well.<br>
Thanks again for the tip on using the inversion and island selection to fill the interior of a segmentation.</p>
<p>Best,<br>
Eva</p>

---
