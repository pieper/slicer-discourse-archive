---
topic_id: 4094
title: "Importing Of Position Tracked Ultrasound Sequence"
date: 2018-09-11
url: https://discourse.slicer.org/t/4094
---

# Importing of position-tracked ultrasound sequence

**Topic ID**: 4094
**Date**: 2018-09-11
**URL**: https://discourse.slicer.org/t/importing-of-position-tracked-ultrasound-sequence/4094

---

## Post #1 by @Sunny (2018-09-11 09:48 UTC)

<p>I have encountered another problem with importing “.seq.nrrd” sequence files. I have recorded a sequence file with the PLUS remote module via Slicer containing US and tracker data. When I try to import this directly into Slicer, it reads the volume voxel data but not the spacing / offset / tracking information stored with it.</p>
<p>Is there any way I can access the PLUS-stored data from the “.seq.nrrd” file directly from Slicer?</p>
<p>Many thanks for your help!</p>

---

## Post #2 by @lassoan (2018-09-11 13:16 UTC)

<p>Plus saves the raw data (original transforms and uncalibrated image data) to sequence files, so you need to apply calibration as explained in SlicerIGT tutorials.</p>

---

## Post #3 by @Sunny (2018-09-11 14:03 UTC)

<p>That is exactly what I was trying to do (import the PLUS raw data into Slicer to run the calibration). But for this it is necessary to read the volumes AND the original transforms from the .seq.nrrd file. I am not sure what I am doing wrong since only the volumes appear in the data module but not the corresponding transforms.</p>

---

## Post #4 by @lassoan (2018-09-13 02:26 UTC)

<p>Do you have transforms in the .seq.nrrd file?<br>
Have you installed Sequences extension?<br>
Can you replay the sequence using sequence browser toolbar (play/pause/prev/next buttons)?</p>

---

## Post #5 by @Sunny (2018-09-13 10:39 UTC)

<p>Yes to all of your questions. The .seq.nrrd file saved by PLUS contains a header like the example included below. In this case I have used the “FakeTracker” for simulation and as you can see the transforms are included in the PLUS file. When replaying this file via PLUS remote, the volumes and the transforms can be transferred to Slicer without problems. However, when I try to import the file directly into Slicer, only the volumes are imported with default spacing, zero offset and without the corresponding transforms. I can use the sequence browser to move through the volume sequence.</p>
<p>Any ideas what might be going wrong? Thanks for your help!</p>
<p>(Note that we have added a custom field for “ElementSpacing” according to what is sent from the US station but this should not have any effect on Slicer / PLUS).</p>
<p>NRRD0004</p>
<h1>Complete NRRD file format specification at:</h1>
<h1><a href="http://teem.sourceforge.net/nrrd/format.html" rel="nofollow noopener">http://teem.sourceforge.net/nrrd/format.html</a></h1>
<h1>File generated by PLUS version 2.7.0</h1>
<p>dimension: 4<br>
encoding: raw<br>
endian: little<br>
kinds: domain domain domain         list<br>
sizes: 112 48 112                     15<br>
space dimension: 3<br>
space directions: (1,0,0) (0,1,0) (0,0,1) none<br>
space origin: (0,0,0)<br>
type: uint8<br>
ultrasound image orientation:=MFA<br>
ultrasound image type:=BRIGHTNESS<br>
Seq_Frame0000_ElementSpacing:=0.7827 0.9403 0.9229 1<br>
Seq_Frame0000_ProbeToTrackerTransform:=0.9925461516413222 0 0.1218693434051475 0 0 1 0 300 -0.1218693434051475 0 0.9925461516413222 0 0 0 0 1<br>
Seq_Frame0000_ProbeToTrackerTransformStatus:=OK<br>
Seq_Frame0000_ReferenceToTrackerTransform:=1 0 0 0 0 1 0 150 0 0 1 200 0 0 0 1<br>
Seq_Frame0000_ReferenceToTrackerTransformStatus:=OK<br>
Seq_Frame0000_Stylus-2ToTrackerTransform:=1 0 0 0 0 0.9925461516413222 -0.1218693434051475 273.3899768113671 0 0.1218693434051475 0.9925461516413222 235.0700333498087 0 0 0 1<br>
Seq_Frame0000_Stylus-2ToTrackerTransformStatus:=OK<br>
Seq_Frame0000_Stylus-3ToTrackerTransform:=1 0 0 100 0 0.9925461516413222 -0.1218693434051475 300 0 0.1218693434051475 0.9925461516413222 0 0 0 0 1<br>
Seq_Frame0000_Stylus-3ToTrackerTransformStatus:=OK<br>
Seq_Frame0000_StylusToTrackerTransform:=0.9925461516413222 0 0.1218693434051475 0 0 1 0 300 -0.1218693434051475 0 0.9925461516413222 0 0 0 0 1<br>
Seq_Frame0000_StylusToTrackerTransformStatus:=OK<br>
Seq_Frame0000_Timestamp:=235.9266571427097<br>
Seq_Frame0000_Status:=OK<br>
Seq_Frame0001_ElementSpacing:=0.7827 0.9403 0.9229 1<br>
Seq_Frame0001_ProbeToTrackerTransform:=0.9925461516413222 0 0.1218693434051475 0 0 1 0 300 -0.1218693434051475 0 0.9925461516413222 0 0 0 0 1<br>
Seq_Frame0001_ProbeToTrackerTransformStatus:=OK<br>
Seq_Frame0001_ReferenceToTrackerTransform:=1 0 0 0 0 1 0 150 0 0 1 200 0 0 0 1<br>
Seq_Frame0001_ReferenceToTrackerTransformStatus:=OK<br>
Seq_Frame0001_Stylus-2ToTrackerTransform:=1 0 0 0 0 0.9925461516413222 -0.1218693434051475 273.3899768113671 0 0.1218693434051475 0.9925461516413222 235.0700333498087 0 0 0 1<br>
Seq_Frame0001_Stylus-2ToTrackerTransformStatus:=OK<br>
Seq_Frame0001_Stylus-3ToTrackerTransform:=1 0 0 100 0 0.9925461516413222 -0.1218693434051475 300 0 0.1218693434051475 0.9925461516413222 0 0 0 0 1<br>
Seq_Frame0001_Stylus-3ToTrackerTransformStatus:=OK<br>
Seq_Frame0001_StylusToTrackerTransform:=0.9925461516413222 0 0.1218693434051475 0 0 1 0 300 -0.1218693434051475 0 0.9925461516413222 0 0 0 0 1<br>
Seq_Frame0001_StylusToTrackerTransformStatus:=OK<br>
Seq_Frame0001_Timestamp:=236.0600285712696<br>
Seq_Frame0001_Status:=OK</p>

---

## Post #6 by @lassoan (2018-09-13 11:17 UTC)

<p>Can you upload the sequence file and application log (menu: Help/Report a bug) to Dropbox/OneDrive/Gdrive and post the link here?</p>

---

## Post #7 by @Sunny (2018-09-13 11:23 UTC)

<p>Sure, here are the sequence file, the config file I used for recording in PLUS and the Slicer log:<br>
<a href="https://www.dropbox.com/s/8ld1r30l0affqxc/4DUS-Sequence.zip?dl=0" class="onebox" target="_blank" rel="nofollow noopener">https://www.dropbox.com/s/8ld1r30l0affqxc/4DUS-Sequence.zip?dl=0</a></p>
<p>Thanks!</p>

---

## Post #8 by @lassoan (2018-09-13 13:21 UTC)

<p>Thanks for the data. It seems that Sequences can only import tracked image data from seq.mha or seq.mhd files (and not from seq.nrrd or seq.nhdr). If you save the data in Plus as seq.mha then you can load it as “Sequence Metafile” instead of “Volume Sequence”.</p>
<p>I’m not sure if Plus can save 4D tracked ultrasound in seq.mha file. If that’s the case then submit a feature request at <a href="https://github.com/PlusToolkit/PlusLib/issues/new">Plus library’s issue tracker</a>.</p>

---

## Post #9 by @Sunny (2018-09-13 14:15 UTC)

<p>I have tried to save the data in a .seq.mhd file via PLUS but when I try to import the file into Slicer as a Sequence Metafile it just crashes. Maybe you could have another look at the files?<br>
<a href="https://www.dropbox.com/s/32he9eb4w0rcm4r/4DUS-Sequence-MHD.zip?dl=0" class="onebox" target="_blank" rel="nofollow noopener">https://www.dropbox.com/s/32he9eb4w0rcm4r/4DUS-Sequence-MHD.zip?dl=0</a></p>
<p>Do you reckon this is a problem with PLUS’ saving or Slicer’s importing?</p>

---

## Post #10 by @lassoan (2018-09-13 14:29 UTC)

<p>Slicer should not crash when trying to import the sequence, so it is an issue in Sequences extension. Could you please <a href="https://github.com/SlicerRt/Sequences/issues">submit a bug report for Sequences extension</a>.</p>

---

## Post #11 by @Sunny (2018-09-14 06:26 UTC)

<p>I submitted an issue for the Sequences extension (<a href="https://github.com/SlicerRt/Sequences/issues/52" rel="nofollow noopener">https://github.com/SlicerRt/Sequences/issues/52</a>).<br>
Looking forward to your reply!</p>

---

## Post #12 by @lassoan (2020-06-02 19:06 UTC)

<p>2 posts were split to a new topic: <a href="/t/visualize-igs-mha-tracked-ultrasound-sequence-in-3d/11835">Visualize .igs.mha tracked ultrasound sequence in 3D</a></p>

---
