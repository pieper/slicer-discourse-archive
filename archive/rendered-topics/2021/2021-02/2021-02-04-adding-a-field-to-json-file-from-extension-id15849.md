# Adding a field to JSON file from extension

**Topic ID**: 15849
**Date**: 2021-02-04
**URL**: https://discourse.slicer.org/t/adding-a-field-to-json-file-from-extension/15849

---

## Post #1 by @smrolfe (2021-02-04 21:50 UTC)

<p>I would like to implement a way to distinguish anatomical landmarks from constructed landmarks such as semi-landmarks generated by curve resampling or from the modules in our SlicerMorph extension. Some methods we use outside of Slicer handle analysis of these two types of points differently so it’s helpful to have this property saved along with the points themselves.</p>
<p>What would be the best way to go about this? I don’t see a simple way to do this from the extension, so maybe an extra point property/JSON field would be required? It would be helpful for our extension, but may be more broadly useful since analyzing semi-landmarks is fairly common.</p>
<p><a class="mention" href="/u/muratmaga">@muratmaga</a> <a class="mention" href="/u/pieper">@pieper</a> <a class="mention" href="/u/lassoan">@lassoan</a></p>

---

## Post #2 by @lassoan (2021-02-05 01:18 UTC)

<p><a class="mention" href="/u/cpinter">@cpinter</a> has implemented this for SlicerHeart recently. You can store any number of additional properties as static “measurements”.</p>
<p>For example:</p>
<pre><code class="lang-python">markupsNode = getNode('F')

# Create a VTK array that contains the custom data
landmarkTypesArray = vtk.vtkDoubleArray()
for controlPointIndex in range(markupsNode.GetNumberOfControlPoints()):
    landmarkTypesArray.InsertNextValue(1 if controlPointIndex % 3 else 0)

# Add the landmark array as static measurement
landmarkTypes = slicer.vtkMRMLStaticMeasurement()
landmarkTypes.SetName('LandmarkType2')
landmarkTypes.SetUnits('')
landmarkTypes.SetPrintFormat("")
landmarkTypes.SetControlPointValues(landmarkTypesArray)
markupsNode.AddMeasurement(landmarkTypes)
</code></pre>
<p>These measurements can be used in other measurements and can be used for coloring curves. It could be used for coloring control points; and could be displayed in the control points table.</p>
<p>Measurement results are stored in the json file in <code>measurements</code> section like this:</p>
<pre><code class="lang-auto">{
...
    "markups": [
        {
            "type": "Fiducial",
            "coordinateSystem": "LPS",
            "locked": false,
            "labelFormat": "%N-%d",
            "controlPoints": [
                {
                    "id": "1",
                    "label": "F-1",
                    "description": "",
                    "associatedNodeID": "",
                    "position": [-72.46376811594203, 10.869565217391298, 0.0],
                    "orientation": [-1.0, -0.0, -0.0, -0.0, -1.0, -0.0, 0.0, 0.0, 1.0],
                    "selected": true,
                    "locked": false,
                    "visibility": true,
                    "positionStatus": "defined"
                },
                {
                    "id": "2",
                    "label": "F-2",
                    "description": "",
                    "associatedNodeID": "",
                    "position": [-29.89130434782608, -44.384057971014517, 0.0],
                    "orientation": [-1.0, -0.0, -0.0, -0.0, -1.0, -0.0, 0.0, 0.0, 1.0],
                    "selected": true,
                    "locked": false,
                    "visibility": true,
                    "positionStatus": "defined"
                },
...
            ],
            "measurements": [
                {
                    "name": "LandmarkType",
                    "enabled": true,
                    "value": 0.0,
                    "printFormat": "%.0f",
                    "controlPointValues": [
                        0.0,
                        1.0,
                        1.0,
                        0.0,
                        1.0,
                        1.0,
                        0.0,
                        1.0,
                        1.0
                    ]
                }
            ],
            "display": {
                ...
    ]
}
</code></pre>
<p>When this json file is manually edited then this data organization makes it easy to add/remove these additional properties, but it is difficult to add/remove points or find values of custom properties.</p>
<p>This is all very new, so we can still modify anything (change API, file format, add convenience functions, etc.) as needed.</p>

---

## Post #3 by @smrolfe (2021-02-05 17:50 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="2" data-topic="15849">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>When this json file is manually edited then this data organization makes it easy to add/remove these additional properties, but it is difficult to add/remove points or find values of custom properties.</p>
</blockquote>
</aside>
<p>Thanks <a class="mention" href="/u/lassoan">@lassoan</a>, I think this should work for what we need!</p>

---

## Post #4 by @lassoan (2021-02-05 17:54 UTC)

<p>The API might change in the near future, depending on how well it all works for us and what feedback we get from other developers. So, let us know if you have any feedback (either that you like it is or you would like some improvements).</p>

---
