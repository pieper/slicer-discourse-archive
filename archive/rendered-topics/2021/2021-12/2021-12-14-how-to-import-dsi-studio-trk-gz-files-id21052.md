---
topic_id: 21052
title: "How To Import Dsi Studio Trk Gz Files"
date: 2021-12-14
url: https://discourse.slicer.org/t/21052
---

# How to import DSI Studio trk.gz files

**Topic ID**: 21052
**Date**: 2021-12-14
**URL**: https://discourse.slicer.org/t/how-to-import-dsi-studio-trk-gz-files/21052

---

## Post #1 by @William_McCuddy (2021-12-14 12:53 UTC)

<p>Hello,</p>
<p>Just checking in to see if anyone is working on a way to import tracts generated in DSI studio (.trk.gz) into 3d Slicer. I’ve tried converting to vtk via TrackVis, but the orientation was off and I could not figure out how to fix it. If there is not a way to get .trk files into slicer, does anyone have a straight forward way to make this conversion that allow for adjusting the orientation?</p>
<p>Thanks in advance for your help.</p>
<p>Will</p>

---

## Post #2 by @lassoan (2021-12-14 14:12 UTC)

<aside class="quote no-group" data-username="William_McCuddy" data-post="1" data-topic="21052">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/william_mccuddy/48/13501_2.png" class="avatar"> William_McCuddy:</div>
<blockquote>
<p>I’ve tried converting to vtk via TrackVis, but the orientation was off and I could not figure out how to fix it.</p>
</blockquote>
</aside>
<p>Usually when meshes appear with unexpected orientation it is due to difference in coordinate system (LPS/RAS). If you are loading a mesh file (.vtk, .ply, .stl, … file ) and the coordinate system is not specified in the file header then Slicer assumes DICOM convention (LPS), but you can choose RAS after you select the file (in “Add data” window click on “Show options” in the top-right corner).</p>
<p>These topics may also help:</p>
<aside class="quote quote-modified" data-post="1" data-topic="1356">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/jcfr/48/17825_2.png" class="avatar">
    <a href="https://discourse.slicer.org/t/load-dsi-studio-trk-gz-or-trackvis-trk-tracks-in-slicer/1356">Load DSI Studio (*.trk.gz) or TrackVis (*.trk) tracks in Slicer</a> <a class="badge-category__wrapper " href="/c/community/slicerdmri/16"><span data-category-id="16" style="--category-badge-color: #AB9364; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #F7941D;" data-parent-category-id="12" data-drop-close="true" class="badge-category --has-parent" title="The SlicerDMRI extension provides diffusion MRI tools including tensor estimation, tractography, and quantification."><span class="badge-category__name">SlicerDMRI</span></span></a>
  </div>
  <blockquote>
    Does anyone have experience converting and then loading fibertrack generated by these software into 3D Slicer ? 
Is there any recommended pathway to export tracts and import them into Slicer ? 
We are thinking of  these approaches: 

improve export to vtk (fiberbundle)  in software like DSI Studio.
add IO support for .trk.gz, .trk …

Thanks for your input 
References: 

format .trk.gz: <a href="http://dsi-studio.labsolver.org/">http://dsi-studio.labsolver.org/</a> / <a href="http://dsi-studio.labsolver.org/system/app/pages/subPages?path=/Manual" class="inline-onebox">Subpages - DSI Studio—A Tractography Software Tool</a>

format .trk:  <a href="http://www.trackvis.org/">http://www…</a>
  </blockquote>
</aside>

<aside class="quote quote-modified" data-post="1" data-topic="19896">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/slicer365/48/67549_2.png" class="avatar">
    <a href="https://discourse.slicer.org/t/diffusion-module-in-4-13-version-cannot-complete-the-reconstruction-of-fiber-bundle/19896">Diffusion module in 4.13 version cannot complete the reconstruction of fiber bundle</a> <a class="badge-category__wrapper " href="/c/community/slicerdmri/16"><span data-category-id="16" style="--category-badge-color: #AB9364; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #F7941D;" data-parent-category-id="12" data-drop-close="true" class="badge-category --has-parent" title="The SlicerDMRI extension provides diffusion MRI tools including tensor estimation, tractography, and quantification."><span class="badge-category__name">SlicerDMRI</span></span></a>
  </div>
  <blockquote>
    Win10 64 
I don’t know if this is a mistake 
My friend and I have tried multiple versions of 4.13 Slicer 
But in the last step, when setting the seed to display the fiber bundle, it can’t be displayed. 
The same data, the same steps, the fiber bundle can be displayed normally in version 4.11. 
Can the developer test whether the fiber bundle can be rebuilt in the latest 4.13 version？ 
 <a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/0/406c0f226d4a90f8732cf1ca6cd246c98f4a0637.jpeg" data-download-href="/uploads/short-url/9bU4zjD3VUV5ukVx951OVAK49PV.jpeg?dl=1" title="捕获.PNG" rel="noopener nofollow ugc">[捕获.PNG]</a> 
This is the same mrb file in 4.11 Version[捕获]
  </blockquote>
</aside>

<p>Let us know how it works.</p>

---

## Post #3 by @pieper (2021-12-14 18:19 UTC)

<aside class="quote no-group" data-username="William_McCuddy" data-post="1" data-topic="21052">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/william_mccuddy/48/13501_2.png" class="avatar"> William_McCuddy:</div>
<blockquote>
<p>I’ve tried converting to vtk via TrackVis, but the orientation was off and I could not figure out how to fix it.</p>
</blockquote>
</aside>
<p>Be sure to install SlicerDMRI and open your vtk files as FiberBundles nodes.  VTK files do not declare their space, so Slicer reads them in LPS, FiberBundles are always RAS (since they may contain tensors-per-vertex that are in RAS we didn’t change the convention when Slicer changed to LPS).</p>

---

## Post #4 by @William_McCuddy (2021-12-15 00:21 UTC)

<p>Thank you all for your response. Unfortunately, still no luck.</p>
<p>I have the DMRI module installed and tried opening as a model (RAS and LPS) and fiber bundle (which defaults to LPS).</p>
<p>I think I have figured out a few things though. It doesn’t look like an orientation problem but a spacing problem. In the attached picture you can see the same track in 3 different locations. All tracts came from dsi studio then were converted to .vtk in TrackVis. The green tract on the left is LPC and the yellow on the right is RAS. For both the yellow tracts I added a FLAIR series to dsi studio and exported tracts “in slice (FLAIR) space”. Of note the FLAIR and DTI were acquired in the same session (so implicitly co-regesistered). Although that clearly didn’t help.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/3/c/3c661aa3b7cb92948172843a371e6aec49de77c0.jpeg" data-download-href="/uploads/short-url/8Cjp7sRXxXEdo3VHgjqlttmTMC4.jpeg?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/3/3c661aa3b7cb92948172843a371e6aec49de77c0_2_666x500.jpeg" alt="image" data-base62-sha1="8Cjp7sRXxXEdo3VHgjqlttmTMC4" width="666" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/3/3c661aa3b7cb92948172843a371e6aec49de77c0_2_666x500.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/3/3c661aa3b7cb92948172843a371e6aec49de77c0_2_999x750.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/3/3c661aa3b7cb92948172843a371e6aec49de77c0_2_1332x1000.jpeg 2x" data-dominant-color="6F6B66"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1440 421 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>I have reviewed all the dsi studio threads and the closest thing I have have been able to find is some code from the guys at nibable <a href="https://nipy.org/nibabel/devel/biaps/biap_0005.html" rel="noopener nofollow ugc">https://nipy.org/nibabel/devel/biaps/biap_0005.html</a></p>
<p>However, my coding skills are modest at best and I can’t figure out how to implement what they’re proposing.</p>
<p>Here is the same tract (created in dsi studio) being displayed in TrackVis:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/a/d/ad99f7835f544ddaa9ae5f4b09ff0d29ecf04001.jpeg" data-download-href="/uploads/short-url/oLKtrhoUz0mNxiUKix389rDN0hr.jpeg?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/a/ad99f7835f544ddaa9ae5f4b09ff0d29ecf04001_2_443x500.jpeg" alt="image" data-base62-sha1="oLKtrhoUz0mNxiUKix389rDN0hr" width="443" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/a/ad99f7835f544ddaa9ae5f4b09ff0d29ecf04001_2_443x500.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/a/ad99f7835f544ddaa9ae5f4b09ff0d29ecf04001_2_664x750.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/a/ad99f7835f544ddaa9ae5f4b09ff0d29ecf04001_2_886x1000.jpeg 2x" data-dominant-color="686255"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×2164 561 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>So, it seems there is a problem with saving as vtk file. Perhaps, as was mentioned, the lack of header information in vtk files is the problem. I’m just not sure what to do about it.</p>
<p>Any additional thoughts are greatly appreciated. I really want to get the tracts into 3dslicer because, for all other image modalities, I really appreciate the flexibility and rendering options. The ability to integrate tracts from dsi studio is last piece of the “puzzle” I’ve been working on <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>

---

## Post #5 by @pieper (2021-12-16 15:57 UTC)

<p>It’s a good question and one we would like to see solved.  Like most groups the SlicerDMRI effort has focused mostly on making sure we save/reload our own data correctly and I think the vtk format and our coordinate systems are pretty well documented.  Perhaps you can get similar documentation about what DSI Studio assumptions are then the link would be clear.</p>
<p>Alternatively there are very good tractography solutions in SlicerDMRI (e.g. UKF Tractography) and if you have the seeds you could try that.  Is there something special about the DSI Studio tracts that SlicerDMRI doesn’t support?</p>

---

## Post #6 by @William_McCuddy (2021-12-16 18:39 UTC)

<p>Thanks for your response. Here is what DSI studio says about saving tracts:<br>
“DSI Studio saves tracks in the native diffusion voxel space rotated to “LPS”. The coordinates are voxel coordinates started from (0,0,0) at the most left/anterior/bottom point of the image volume. The orientation is (+right,+posterior, +top). For example, (1,2,3) = [the left most 1st voxel, the most anterior second voxel, the bottom 3rd voxel].” <a href="http://dsi-studio.labsolver.org/Manual/Fiber-Tracking" rel="noopener nofollow ugc">http://dsi-studio.labsolver.org/Manual/Fiber-Tracking</a></p>
<p>However this is all saved a trk file. Specifics regarding trk file are spelled out here: <a href="http://www.trackvis.org/docs/?subsect=fileformat" rel="noopener nofollow ugc">http://www.trackvis.org/docs/?subsect=fileformat</a> . Maybe TrackVis is doing something weird to the data when it converts from trk to vtk.</p>
<p>I guess it would be nice if 3dslicer could import trk files. Are there any plans for this in the future?</p>
<p>After some more digging I found this tutorial (<a href="https://dipy.org/documentation/1.4.1./examples_built/streamline_formats/#example-streamline-formats" rel="noopener nofollow ugc">https://dipy.org/documentation/1.4.1./examples_built/streamline_formats/#example-streamline-formats</a>) on Nipy, which may be helpful for others with similar issue. It looks like they might have some code to transform vtk to trk in whatever anatomical scan space you add. I haven’t had time yet to test but will report back if it works.</p>
<p>I like DSI studio because of the option for generalized Q sampling reconstruction, which seems to produce good results even with noisy clinical data and seems to track pretty well through edematous tissue, built in features for eddy distortion correction, template-based seeding approach (that warps the template to patients native space so all tracking occurs in native space), and ability to export trk file. Also, it has pretty good documentation and discussion board. I’m also just more familiar with it than other software. However, maybe I will give the tracking analysis in slicer a try.</p>

---

## Post #7 by @pieper (2021-12-16 19:18 UTC)

<aside class="quote no-group" data-username="William_McCuddy" data-post="6" data-topic="21052">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/william_mccuddy/48/13501_2.png" class="avatar"> William_McCuddy:</div>
<blockquote>
<p>I guess it would be nice if 3dslicer could import trk files. Are there any plans for this in the future?</p>
</blockquote>
</aside>
<p>It’s probably not in our critical path, so no.  There have been some <a href="https://github.com/nipy/nibabel/issues/942">discussions recently</a> among various groups about a new standard for tractography and if that takes off I could imaging that would be a good target for integration.</p>

---

## Post #8 by @jhlegarreta (2023-07-12 18:52 UTC)

<p>Sorry to chime in here. I would be interested in Slicer being able to read TRK, and potentially TCK, files. I may be willing to invest some time into this if maintainers could provide some initial pointers and thoughts, and maybe an estimate of how hard they consider this would be, to start having a look at how this could be made available. Thanks.</p>

---

## Post #9 by @pieper (2023-07-12 21:14 UTC)

<p>If there are packages that can read these files it should be feasible to follow the same approach used in this code:</p>
<aside class="onebox githubfolder" data-onebox-src="https://github.com/pieper/SlicerDMRI/tree/trakoio/Modules/Scripted/TRAKOFile">
  <header class="source">

      <a href="https://github.com/pieper/SlicerDMRI/tree/trakoio/Modules/Scripted/TRAKOFile" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <h3><a href="https://github.com/pieper/SlicerDMRI/tree/trakoio/Modules/Scripted/TRAKOFile" target="_blank" rel="noopener"></a></h3>

  <p><a href="https://github.com/pieper/SlicerDMRI/tree/trakoio/Modules/Scripted/TRAKOFile" target="_blank" rel="noopener">//github.com/pieper/SlicerDMRI/tree/trakoio/Modules/Scripted/TRAKOFile</a></p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>


---

## Post #10 by @jhlegarreta (2023-07-13 12:32 UTC)

<aside class="quote no-group" data-username="pieper" data-post="9" data-topic="21052">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>If there are packages that can read these files</p>
</blockquote>
</aside>
<p>For sure there are, easiest would be DIPY for me.</p>
<aside class="quote no-group" data-username="pieper" data-post="9" data-topic="21052">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>it should be feasible to follow the same approach used in this code:</p>
</blockquote>
</aside>
<p>Thanks Steve. Will have a look as time permits. As far as I understand we can do an <code>import dipy</code> in Slicer without issues.</p>

---

## Post #11 by @pieper (2023-07-13 12:47 UTC)

<aside class="quote no-group" data-username="jhlegarreta" data-post="10" data-topic="21052">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/jhlegarreta/48/66542_2.png" class="avatar"> jhlegarreta:</div>
<blockquote>
<p>As far as I understand we can do an <code>import dipy</code> in Slicer without issues.</p>
</blockquote>
</aside>
<p>I haven’t tried recently, but I think so, yes, unless there are some dependency conflicts.  There is great potential synergy so it’s good that you are investigating this.</p>

---

## Post #12 by @William_McCuddy (2024-01-31 00:44 UTC)

<p>Glad to see I wasn’t the only one who thought this might be useful <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>jhlegarreta, any luck getting trk files into 3Dslicer easily?</p>

---

## Post #13 by @jhlegarreta (2024-02-03 22:17 UTC)

<blockquote>
<p>jhlegarreta, any luck getting trk files into 3Dslicer easily?</p>
</blockquote>
<p>Although I do believe that supporting <code>.trk</code> and <code>.tck</code> files is a much needed feature, I have not been able to have a look at how this could be supported seamlessly. I am really sorry.</p>

---

## Post #14 by @egemen4552 (2024-07-18 20:41 UTC)

<p>I have to visualize my tracts in Slicer,</p>
<p>Is there anything about it? Can I import .tck files or .trk files?</p>

---

## Post #15 by @ljod (2024-10-19 18:42 UTC)

<p>I’ve asked my postdoc who knows how to do this to respond.</p>

---
