---
topic_id: 18314
title: "Understanding Image Registration Process"
date: 2021-06-24
url: https://discourse.slicer.org/t/18314
---

# Understanding image registration process

**Topic ID**: 18314
**Date**: 2021-06-24
**URL**: https://discourse.slicer.org/t/understanding-image-registration-process/18314

---

## Post #1 by @marianaslicer (2021-06-24 08:37 UTC)

<p>Hi,</p>
<p>I’m getting an unexpected behavior in the image registration process. I’m using Elastix registration to register two 4DCT frames of the popi-model data <a href="https://www.creatis.insa-lyon.fr/rio/dir_validation_data" rel="noopener nofollow ugc">dir_validation_data - Rayonnement, Images, Oncologie (insa-lyon.fr)</a></p>
<p>In the registration process, I’m saving the warped volume and the DVF. The DVF is saved in a .txt file with the b-spline parameters.</p>
<p>The output of the registration (warped volume) is correct since the moving phase matches the original 4D CT frame. The image size, spacing, origin and directions are also the same as the original 4D CT frames.</p>
<p>Then, I imported the DVF generated by registration to the 3D slicer and tried to apply the DVF to the moving phase just to see if the output of the registration is exactly the same as when the DVF is manually applied to the original image. The DVF was applied by was right-clicking on the “Transform” column and hardening the transform.</p>
<p>After that, I used the Subtract Scalar Volume module to subtract both images and I got big differences and edges:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/a/2ade5a2cb700103a1b6e1a252b3958ede94a6a13.png" data-download-href="/uploads/short-url/67erm9kWJBJsvRYWxSKHd5bBB3t.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/a/2ade5a2cb700103a1b6e1a252b3958ede94a6a13_2_690x440.png" alt="image" data-base62-sha1="67erm9kWJBJsvRYWxSKHd5bBB3t" width="690" height="440" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/a/2ade5a2cb700103a1b6e1a252b3958ede94a6a13_2_690x440.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/a/2ade5a2cb700103a1b6e1a252b3958ede94a6a13_2_1035x660.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/a/2ade5a2cb700103a1b6e1a252b3958ede94a6a13_2_1380x880.png 2x" data-dominant-color="5BC1A6"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1588×1014 817 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Also, I noticed that the origin and size of the image changed after manually applying the DVF, which is, in my opinion, a strange behavior. And a different behaviour from Elastix registration.</p>
<p>Volume information for the warped volume generated by Elastix:<br>
<img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/4/c4ba157fb2c0108f156ea7e723e4a83a7e81ace0.png" alt="image" data-base62-sha1="s4kgzu70pBrT8HDK9wMxBsW3Ki4" width="623" height="466"></p>
<p>Volume information for the warped volume generated by manually apply the DVF:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/b/4b8c091841de05d9182fb367125ae6e19688b066.png" data-download-href="/uploads/short-url/aMjPLNw6lAwRcH14YEg1Af7yRiS.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/b/4b8c091841de05d9182fb367125ae6e19688b066.png" alt="image" data-base62-sha1="aMjPLNw6lAwRcH14YEg1Af7yRiS" width="690" height="406" data-dominant-color="F6F6F6"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">779×459 8.78 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Information about the tranform:<br>
<img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/8/9/89dce8b8f09a8fb4401cc13d366da625a0dea372.png" alt="image" data-base62-sha1="jFAHXdUPRo6wdAfTyWx06ojIUds" width="308" height="291"></p>
<p>I would really appreciate it if anyone could explain this behavior and how to solve it, please. Thank you in advance.</p>

---

## Post #2 by @lassoan (2021-06-25 18:29 UTC)

<p>This all looks good and the subtraction result shows that registration is almost perfect.</p>
<p>Image geometry (origin, size, axis directions, and extents) are expected to change if you harden a non-linear transform. If you have a specific target geometry that you want to resample to then you can use one of the image resampling modules, such as “Resample Scalar/Vector/DWI volume” module.</p>

---
