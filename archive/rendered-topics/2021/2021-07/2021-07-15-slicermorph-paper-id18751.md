# SlicerMorph paper

**Topic ID**: 18751
**Date**: 2021-07-15
**URL**: https://discourse.slicer.org/t/slicermorph-paper/18751

---

## Post #1 by @pieper (2021-07-15 14:39 UTC)

<p>Congrats to <a class="mention" href="/u/smrolfe">@smrolfe</a> and <a class="mention" href="/u/muratmaga">@muratmaga</a> for getting the <a href="https://slicermorph.github.io/">SlicerMorph</a> paper published! <img src="https://emoji.discourse-cdn.com/twitter/+1.png?v=12" title=":+1:" class="emoji" alt=":+1:" loading="lazy" width="20" height="20"> <img src="https://emoji.discourse-cdn.com/twitter/+1.png?v=12" title=":+1:" class="emoji" alt=":+1:" loading="lazy" width="20" height="20"> <img src="https://emoji.discourse-cdn.com/twitter/+1.png?v=12" title=":+1:" class="emoji" alt=":+1:" loading="lazy" width="20" height="20"></p>
<p>Rolfe, S., Pieper, S., Porto, A., Diamond, K., Winchester, J., Shan, S., Kirveslahti, H., Boyer, D., Summers, A. and Maga, A.M. (2021), SlicerMorph: An open and extensible platform to retrieve, visualize and analyze 3D morphology. Methods in Ecology and Evolution. Accepted Author Manuscript. <a href="https://doi.org/10.1111/2041-210X.13669">https://doi.org/10.1111/2041-210X.13669</a></p>
<p><a href="https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/2041-210X.13669" class="onebox" target="_blank" rel="noopener">https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/2041-210X.13669</a></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/7/c7ae5ab61a23055b64e9dab9289db97320e28e1d.jpeg" data-download-href="/uploads/short-url/suszhvUgdnUNxo0ohjxBYmIVh8N.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/c/c7ae5ab61a23055b64e9dab9289db97320e28e1d_2_690x227.jpeg" alt="image" data-base62-sha1="suszhvUgdnUNxo0ohjxBYmIVh8N" width="690" height="227" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/c/c7ae5ab61a23055b64e9dab9289db97320e28e1d_2_690x227.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/c/c7ae5ab61a23055b64e9dab9289db97320e28e1d_2_1035x340.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/7/c7ae5ab61a23055b64e9dab9289db97320e28e1d.jpeg 2x" data-dominant-color="BFBDA9"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1221×402 143 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #2 by @lassoan (2021-07-15 16:22 UTC)

<p>Very nice! I would recommend to explicitly designate this paper as the paper to cite when somebody uses SlicerMorph (add “How to cite” to SlicerMorph website). This makes it much easier to follow who uses SlicerMorph and for what, and it is also much more impressive to have one paper with 500 citations than 10 papers with 50 citations each. Users of course can cite additional papers, more specific to certain SlicerMorph features (e.g, if they use ALPACA then they should cite the SlicerMorph paper and the ALPACA paper).</p>

---

## Post #3 by @DRYAHYA (2021-07-15 16:44 UTC)

<p>Congratulations for the great work</p>

---

## Post #4 by @muratmaga (2021-07-15 17:22 UTC)

<p>Thank you all for our help. This wouldn’t be possible without the support of this wonderful group of people around the Slicer platform.</p>
<p><a class="mention" href="/u/lassoan">@lassoan</a> We do have <a href="https://github.com/SlicerMorph/SlicerMorph/#citations" rel="noopener nofollow ugc">how to cite SlicerMorph on the github repo</a>. These were pointing out to the more detailed preprint versions of the paper, but will update with the new DOIs. ALLPACA paper is is also accepted to MEE and should appear shortly.</p>

---

## Post #5 by @lassoan (2021-07-15 19:49 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="4" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>We do have <a href="https://github.com/SlicerMorph/SlicerMorph/#citations">how to cite SlicerMorph on the github repo </a></p>
</blockquote>
</aside>
<p>I’ve opened the <a href="https://slicermorph.github.io/">SlicerMorph website</a> and searched for “cite” and nothing was found on the page. I have not thought about checking it in the repository’s readme file, and probably I’m not alone. It could be better to duplicate the “How to cite” instructions at both places. I would also recommend considering renaming “Citations” to “How to cite” (because citations may also mean a list of papers that cite SlicerMorph), highlight one single paper to be cited (to accumulate instead of disperse citations), and describe why it is important that they cite (makes it easier to demonstrate impact for securing further funding for development and maintenance).</p>

---

## Post #6 by @muratmaga (2021-07-15 22:49 UTC)

<p>Yeah, I think we will actually forward the <a href="http://slicermorph.org" rel="noopener nofollow ugc">slicermorph.org</a> to the repo as oppose to the old <a href="http://github.io" rel="noopener nofollow ugc">github.io</a> pages.</p>
<p>Good suggestion for the Citations, I will rename that to how to cite.</p>

---

## Post #7 by @lassoan (2021-07-16 13:13 UTC)

<p>When I searched for SlicerMorph then I got <a href="https://slicermorph.github.io/">https://slicermorph.github.io/</a> as the first hit. If you don’t want people to use this landing page then it might be better to remove it.</p>

---

## Post #8 by @stevenagl12 (2021-10-11 21:04 UTC)

<p>Can SlicerMorph also use the PCA results with a continuous variable such as age for the samples to perform a regression analysis such as that which can be performed in MorphJ?</p>

---

## Post #9 by @muratmaga (2021-10-11 21:12 UTC)

<p>SlicerMorph and MorphoJ serve different functions. SlicerMorph is a digitization and shape variance visualization tool, whereas MorphoJ is an analytical tool with some function specific to analysis of coordinate data.</p>
<p>At this point SlicerMorph does not feature any analysis features built on latent variables like PC scores. You have two options.</p>
<ol>
<li>You can explore the available linear model tools in Python, and use them within Slicer/SlicerMorph. We can possibly work with you, if you want to go down that route. <a href="https://pypi.org/project/linearmodels/" rel="noopener nofollow ugc">These are some examples of packages that offer linear modeling and regression in Python.</a>
</li>
<li>You can take the PCA output from SlicerMorph and use R/geomorph package to do your analysis. <a href="https://github.com/SlicerMorph/Tutorials/tree/main/GPA_3" rel="noopener nofollow ugc">This tutorial shows the necessary steps</a>
</li>
</ol>

---

## Post #10 by @stevenagl12 (2021-10-13 15:01 UTC)

<p>More general question then, as I would prefer to use the functionality of MorphoJ than reinventing the wheel myself with Python tools or with having to format the PCA outputs in R (which in and of itself is slow and cumbersome when doing GMM with landmarks). Does anyone know which files in 3D Slicer or SlicerMorph are responsible for defining the saving system for fiducial files? If so I can modify said file to save in the format necessary for MorphoJ for our purposes to be able to directly import them without all the rigmarole of altering each .fcsv file and then combining them for analysis.</p>

---

## Post #11 by @muratmaga (2021-10-13 15:15 UTC)

<p>İ (and probably an order of more magnitude more publications that use R based gmm tools for shape analysis instead of morphoj) respectfully disagree with your assessment of functionality of R gmm ecosystem. But if course you are free to do what you want to do.</p>
<p>i don’t think you want to modify the fcsv  write functions and rebuild Slicer from scratch, as those would be undoubtedly more work. Fcsvs are simple csv files that you can open in excel and append each other if that’s what you want.</p>
<p>İ do not know what format morphoj expects.</p>

---

## Post #12 by @stevenagl12 (2021-10-21 16:48 UTC)

<p>My apologies, I didn’t explain very well. My task is trying to teach medical school students and biologists the process of shape analysis, particularly through GMM. The majority of these students neither have programming experience, nor any interest in learning programming. That is why using R would be slow and cumbersome. I am also not interested in modifying the 3D Slicer process of saving fcsv files, only looking at the architecture, and the process that 3D Slicer uses to save said files so I can replicate it with my own function/script to generate something like a json file, text file, etc, with all of the landmark points listed one after the other, without uncertainty values and such.</p>

---

## Post #13 by @muratmaga (2021-10-21 16:59 UTC)

<aside class="quote no-group" data-username="stevenagl12" data-post="12" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/stevenagl12/48/3391_2.png" class="avatar"> stevenagl12:</div>
<blockquote>
<p>he majority of these students neither have programming experience, nor any interest in learning programming. That is why using R would be slow and cumbersome. I</p>
</blockquote>
</aside>
<p>Yes, learning GUI driven analysis programs like MorphoJ is somewhat easier to use initially. Particularly if all you ever need is the functionality offered in the package. The main catch is, the moment you need something else you are stuck. It is also much more challenging to export data from those kinds of tools, if you need to generate publication quality images. reformat tables etc… So there are drawbacks to both approach.</p>
<p>You don’t necessarily learn to program in R, if all you all you do is to use a package like geomorph. You replace teaching keyboard shortcuts and menu selections with function names and parameters to pass them, which the student can learn to program if they choose to so in future. But you dont necessarily need to learn to program anything in R. Just learn function names and be able to write things in a script. It is a bit more upfront investment, but in the long run it pays off, particularly for students.</p>
<p>Going back to your original inquiry, I see <a href="https://morphometrics.uk/MorphoJ_guide/frameset.htm?fundamentals/variables.htm">morphoJ takes a text input (but they provide no description of what fields are necessary)</a>. Probably that would be your simplest option. If you get an example of what that looks like, we can help you to reformat the fcsv into that.</p>

---

## Post #14 by @muratmaga (2021-10-21 19:38 UTC)

<aside class="quote no-group" data-username="stevenagl12" data-post="10" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/stevenagl12/48/3391_2.png" class="avatar"> stevenagl12:</div>
<blockquote>
<p>If so I can modify said file to save in the format necessary for MorphoJ for our purposes to be able to directly import them without all the rigmarole of altering each .fcsv file and then combining them for analysis.</p>
</blockquote>
</aside>
<p>This piece of R code seem to convert the fcsv to the basic text format MorphoJ expects as far as I can tell. You can test with the sample data in SlicerMorph. First download the gorilla skulls data, then run them via SlicerMorph’s GPA function (only to create the analysis.log file) that we use the pull the data. Then in R, run this script.</p>
<pre><code class="lang-auto">if (!require(devtools)) install.packages('devtools')
if (!require(SlicerMorphR)) devtools::install_github('SlicerMorph/SlicerMorphR')

#navigate to the analysis.log file saved into the output folder.
dat=parser(file.choose())

#function to convert 2D matrix of coordinates to a row of coordinate 
vectorize = function(X){
  return(as.vector(t(X)))
}

lms = NULL
for (i in 1:length(dat$files)) lms = rbind(lms, vectorize(dat$LM[,,i]))
#append the subject IDs
rownames(lms) = dat$ID
#write to disk
write.table(lms, file="c:/users/amaga/Desktop/test.txt", quote=FALSE, sep=",", row.names = TRUE, col.names = FALSE)
</code></pre>

---

## Post #15 by @stevenagl12 (2021-10-21 19:52 UTC)

<p>So the text document really just has the each line with the sample name, followed by each x, y, and z coordinate of those landmarks relating to said sample. I just want a way to automatically save this easily so that the students don’t have to save each file and pull that info out individually and save them. It also can be any forma of text document including csv, fcsv, text, or tsv. It just can’t contain the uncertainty values of the landmark and all the extra fields that are in fcsv files.</p>

---

## Post #16 by @muratmaga (2021-10-21 20:08 UTC)

<p>This conversion needs to be done separately. I am not inclined to support any format that is not native to Slicer within SlicerMorph, as if people start using those formats to keep their data in, that will break our functionality (or formats don’t have things that we care or need, like units or coordinate systems).</p>
<p>Did you try the code example above? If you are more comfortable with excel, I am sure a short visualbasic script would do that too.</p>

---

## Post #17 by @lassoan (2021-10-21 21:57 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="16" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>If you are more comfortable with excel, I am sure a short visualbasic script would do that too.</p>
</blockquote>
</aside>
<p>Since the markups json file is practically a database. You can use that as a data source in Excel, you can read the markups json file into a spreadsheet directly, just using the GUI. It is not a one-time import, but it is a live query, which allows refreshing of the spreadsheet from the json file.</p>
<div class="youtube-onebox lazy-video-container" data-video-id="vZb4v6vBXVo" data-video-title="Import 3D Slicer markup json files into Excel" data-video-start-time="" data-provider-name="youtube">
  <a href="https://www.youtube.com/watch?v=vZb4v6vBXVo" target="_blank" rel="noopener">
    <img class="youtube-thumbnail" src="https://img.youtube.com/vi/vZb4v6vBXVo/maxresdefault.jpg" title="Import 3D Slicer markup json files into Excel" width="" height="">
  </a>
</div>


---

## Post #18 by @stevenagl12 (2021-10-22 03:49 UTC)

<p>So, I get the feeling that I am not communicating what I am looking for properly. I am not trying to get an official change to the slicerMorph software, only create a new module that I can then add to either slicer or slicerMorph that will enable me to save a single file with the said format. The R code would be useful if I wanted to have the students run the code, but I have dealt with students who want absolutely nothing to do with any type of programming in this course, even if it is a single instance of pulling up the program and just running the script. Plus the said script would convert the fcsv to a text file and not pull out just the intended data for the purpose of using morphoJ. The excel file system would also require saving individual fcsv files, and pulling them into Excel, then editing it which is just time consuming. That is why I would like to look at the code for slicer or slicerMorph on how it saves fcsv files and maybe even the markups module to be able to access the list of fiducials to print out the text, json, csv, etc file for access in morphoJ. I realize this is an irregular use case but people make new modules for slicer all the time and I am just trying to do that.</p>
<p>In addition, I also realize that it would be better to just work in R, but as said I have dealt with medical, dental, anthropology, and biology students who refuse to learn coding of any kind and who will not use coding softwares. They have left very negative reviews about courses instructing them on how to use said softwares, and/or been unable to produce results because they fail to understand the directions. Even adding too many softwares is a problem which is why I was originally looking at slicerMorph in the beginning because it calculates the PCs for future analysis.</p>

---

## Post #19 by @muratmaga (2021-10-22 04:00 UTC)

<aside class="quote no-group" data-username="stevenagl12" data-post="18" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/stevenagl12/48/3391_2.png" class="avatar"> stevenagl12:</div>
<blockquote>
<p>only create a new module that I can then add to either slicer or slicerMorph that will enable me to save a single file with the said format.</p>
</blockquote>
</aside>
<p>You can develop a simple python module that will essentially replicate the R code I posted. There is nothing in SlicerMorph, that writes these landmarks files (neither for FCSV, nor in JSON). We are simply using the built-in functionality in Slicer to save them.</p>
<p>More important in Slice/SlicerMorph, we keep the landmarks per subject. Whereas the format you want to keep them essentially compiles all the subjects together in a single file. So after your students are done in Slicer/SlicerMorph landmarking their specimens, they can copy all fcsv/json files in a folder, and your module can read all of them, do the flattening and save a single text file out of them.</p>
<p>The closest piece of code I can show from SlicerMorph, is a module that does the reverse of what you ask, read an obscure format and import them as fcsv. <a href="https://github.com/SlicerMorph/SlicerMorph/blob/master/IDAVLMConverter/IDAVLMConverter.py" class="inline-onebox">SlicerMorph/IDAVLMConverter/IDAVLMConverter.py at master · SlicerMorph/SlicerMorph · GitHub</a>.</p>

---

## Post #20 by @smrolfe (2021-10-22 04:17 UTC)

<p>I can provide some sample python code to do this if that would be helpful. If possible can you share an example file?</p>

---

## Post #21 by @lassoan (2021-10-22 05:32 UTC)

<p><a class="mention" href="/u/stevenagl12">@stevenagl12</a> a couple of questions:</p>
<p>We are adding file export directly from the subject hierarchy tree (for example in Data module). The first iteration will probably only export a single file at a time, but soon we will add multiple item (and/or entire folder) export, which will write content of all the selected markup nodes into a single json file. From that file you can use a few lines of Python code, R code, or the Excel GUI to create a spreadsheet. <strong>Would that fulfill your needs?</strong></p>
<p>We also have standard csv export in Markups module (Export/import table), which creates tsv/csv files like this:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/9/e97bd612a79b1fc82267c8c8a6ab9079b12d31f8.png" data-download-href="/uploads/short-url/xjuzfiJVXFqs8ziNoFRQtcnokWI.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/9/e97bd612a79b1fc82267c8c8a6ab9079b12d31f8.png" alt="image" data-base62-sha1="xjuzfiJVXFqs8ziNoFRQtcnokWI" width="690" height="312" data-dominant-color="DEE4E0"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1080×489 30 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>We could easily implement multiple node export. <strong>Could this be improved/customized to fit your needs?</strong></p>
<aside class="quote no-group" data-username="muratmaga" data-post="16" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>I am not inclined to support any format that is not native to Slicer within SlicerMorph, as if people start using those formats to keep their data in, that will break our functionality (or formats don’t have things that we care or need, like units or coordinate systems).</p>
</blockquote>
</aside>
<p>I agree that supporting multiple file formats for data storage is a huge liability and we ideally we would use a single format. However, supporting multiple file formats for data <em>export</em> would be probably fine, it should be just clear for the users that it is not for data storage, only for interoperability. These export options would not need to be added to the “Save data” window, they could be in separate module(s) or subject hierarchy right-click menu actions.</p>
<hr>
<p>Among all discussed options however, this one sounds by far the most promising to me:</p>
<blockquote>
<p>You can explore the available linear model tools in Python, and use them within Slicer/SlicerMorph. We can possibly work with you, if you want to go down that route</p>
</blockquote>
<p>MorphoJ looks like a closed-source project, with no development community around it, based on 15-20 year old technologies and with a look and feel of about the same era. It still has about 500 mentions on Google Scholar per year, so there are users. This indicates that there is a huge opportunity here for an alternative software, which is similarly easy to use, but based on current technology, and it is open and reproducible. Maybe SlicerMorph could fulfill this need.</p>
<p>Probably all the algorithms that MorphoJ offers are available in various Python packages and Slicer/SlicerMorph has all the GUI components you may need, so what is missing is really just putting together convenient modules for specific analysis tasks that you are interested in. <a class="mention" href="/u/muratmaga">@muratmaga</a> even offered to help you with this, so you would probably not need to invest a lot effort. <strong>Would you consider this option?</strong></p>

---

## Post #22 by @muratmaga (2021-10-22 05:56 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="21" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>I agree that supporting multiple file formats for data storage is a huge liability and we ideally we would use a single format. However, supporting multiple file formats for data <em>export</em> would be probably fine, it should be just clear for the users that it is not for data storage, only for interoperability. These export options would not need to be added to the “Save data” window, they could be in separate module(s) or subject hierarchy right-click menu actions.</p>
</blockquote>
</aside>
<p>My specific concern is that people will do the landmarking, then they will export the data in a non-Slicer format. And because they exported it, they will think they are done (and implicitly assume they can import what they exported), and close their session without ever saving the markups in appropriate format, causing a data loss or a major headache to re-convert those back. I would rather avoid that. Most of those formats people need to do geometric morphometric analysis are very simple flat files, and can be easily compiled via scripts, so I don’t really see a value in direct export options for those.</p>
<aside class="quote no-group" data-username="lassoan" data-post="21" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>Probably all the algorithms that MorphoJ offers are available in various Python packages and Slicer/SlicerMorph has all the GUI components you may need, so what is missing is really just putting together convenient modules for specific analysis</p>
</blockquote>
</aside>
<p>For whatever reason, python is not very popular among evolutionary biologists (as far as I can tell), and there is a very well developed  toolkits for statistical analysis on coordinate data in R (geomorph is the most popular one, but not the only one). So we always suggested people to continue doing their inferential statistics in R. At the moment, we have no bandwidth to recreate all those specific functions (nor have any dedicated funding for it). But if someone wants to take a crack at developing a commonly used subset of those (e.g., allometric regression, analysis of variance on procrustes distances, etc), we will be happy to help and potentially turn them into individual modules.</p>

---

## Post #23 by @hherhold (2021-10-22 11:06 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="22" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>For whatever reason, python is not very popular among evolutionary biologists (as far as I can tell)</p>
</blockquote>
</aside>
<p>This is somewhat off-topic, but I have to agree with this, and I don’t understand it. Python is very powerful and continues to grow in the number of packages for bio, including packages where you can run R from Python in Jupyter notebooks. You get all the benefits of Python but can still use R analyses that may not yet be implemented in Python.</p>
<p>Anyway, sorry to derail the conversation a bit but this is a specific topic we’ve discussed here at AMNH several times.</p>

---

## Post #24 by @muratmaga (2021-10-22 15:14 UTC)

<aside class="quote no-group" data-username="hherhold" data-post="23" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/hherhold/48/12199_2.png" class="avatar"> hherhold:</div>
<blockquote>
<p>This is somewhat off-topic, but I have to agree with this, and I don’t understand it.</p>
</blockquote>
</aside>
<p>It is a cultural thing. Biologists exposure to computational things is mostly through biostat courses, which utilize R often. To be frank, while Python is powerful, R is way more straighforward statistical analyses and modeling then Python as it is designed for that. You can use python in R (there are now multiple ways of bridging them). Most straighforward one is reticulate.</p>

---

## Post #25 by @smrolfe (2021-10-22 21:03 UTC)

<p>Here’s an example python function that you could use in a simple Python module to run the conversion on a folder of .mrk.json files. It can be modified to work with .json or .fcsv. also, since it’s using the Slicer readers instead of parsing the text. Note that it also applies an LPS transform to the output, as by default the coordinates within Slicer are RAS and output as LPS.</p>
<p>The function requires that the landmarks be saved to a folder first, which is probably a good idea if you need to go back to the landmarks in Slicer.</p>
<pre><code class="lang-auto">import os, glob, numpy

def convertMorphoJLM(inputFileDirectory, outputLandmarkFile)
  extensionInput = ".mrk.json"
  fileList = glob.glob(inputDirectory+"*.json")
  success, currentLMNode = slicer.util.loadMarkupsFiducialList(fileList[0])
  subjectNumber = len(fileList)
  landmarkNumber = currentLMNode.GetNumberOfFiducials()
  LMArray=numpy.zeros(shape=(subjectNumber,landmarkNumber,3))
  fileIndex=0
  fileStems=[];
  headerLM = ["Subject"]
  for pointIndex in range(currentLMNode.GetNumberOfMarkups()):     
    headerLM.append(currentLMNode.GetNthControlPointLabel(pointIndex)+'_X')
    headerLM.append(currentLMNode.GetNthControlPointLabel(pointIndex)+'_Y')
    headerLM.append(currentLMNode.GetNthControlPointLabel(pointIndex)+'_Z')

  LPS = [-1,-1,1]
  point = [0,0,0]
  for file in fileList:
    if fileIndex&gt;0:
      success, currentLMNode = slicer.util.loadMarkupsFiducialList(file)     
    fileStems.append(os.path.basename(file.split(extensionInput)[0]))
    for pointIndex in range(currentLMNode.GetNumberOfMarkups()):
      point=currentLMNode.GetNthControlPointPositionVector(pointIndex)
      point.Set(point[0]*LPS[0],point[1]*LPS[1],point[2]*LPS[2])
      LMArray[fileIndex, pointIndex,:]=point
    slicer.mrmlScene.RemoveNode(currentLMNode)
    fileIndex+=1

  temp = numpy.column_stack((numpy.array(fileStems), LMArray.reshape(subjectNumber, int(3 * landmarkNumber))))
  temp = numpy.vstack((numpy.array(headerLM), temp))
  numpy.savetxt(outputLandmarkFile, temp, fmt="%s", delimiter=",")
</code></pre>

---

## Post #26 by @stevenagl12 (2021-11-02 21:50 UTC)

<p>I apologize for taking so long to respond.</p>
<blockquote>
<p>We are adding file export directly from the subject hierarchy tree (for example in Data module). The first iteration will probably only export a single file at a time, but soon we will add multiple item (and/or entire folder) export, which will write content of all the selected markup nodes into a single json file. From that file you can use a few lines of Python code, R code, or the Excel GUI to create a spreadsheet. <strong>Would that fulfill your needs?</strong></p>
</blockquote>
<p>This might be a good option, however, if it’s possible for said code to be available, I can modify it so that I can make it only save the json with the title of the sample, x, y, and z coordinates of each point in the same line on the sheet. Ultimately, I cannot use Python code or R code as the students would need to use said code for their assignment, which again they are neither accepting nor willing to do. The Excel GUI just adds extra steps/complexity to the assignment (admittedly not much), but I would rather just create a module myself that makes it simplified and does the process for them with extrememly limited input from the students to be able to do the saving.</p>
<blockquote>
<p>We could easily implement multiple node export. <strong>Could this be improved/customized to fit your needs?</strong></p>
</blockquote>
<p>The multiple node export again suffers from the same problem as the Excel problem in that it would add extra steps. Currently, the fcsv files are obviously saved like this:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/f/4f4cbbef123ee90e11bc5674164dcc4416d3dfb9.png" data-download-href="/uploads/short-url/bjw7zW8xURzIAOzY6OhZcWnqVsJ.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/f/4f4cbbef123ee90e11bc5674164dcc4416d3dfb9.png" alt="image" data-base62-sha1="bjw7zW8xURzIAOzY6OhZcWnqVsJ" width="690" height="132" data-dominant-color="EAEAEC"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">826×159 7.09 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>MorphoJ requires files like this:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/a/4/a474519c9f841b369d2004bac195a8d9312b56e2.png" data-download-href="/uploads/short-url/nsPw3rx5Psf0epuQ7lOYAJ4wjRw.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/a/4/a474519c9f841b369d2004bac195a8d9312b56e2.png" alt="image" data-base62-sha1="nsPw3rx5Psf0epuQ7lOYAJ4wjRw" width="690" height="27" data-dominant-color="E4E4E9"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1847×73 8.22 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Where the first column just has the sample name, followed by each point pithout identifiers as x,y,z. In order to get this form with the methods described, I either need to modify the way that they are being saved (which would require access to the script used to save fiducials, giving students unnecessary instructions for loading up each file and creating a new file with said format, using a multi-fiducial saving option, but it would still require students to go in and edit the files for the extraneous information, or doing a post-processing step for creating the format necessary (this could be a module where I could direct it to a folder that contains a series of .fcsv files and run an extraction to get the sample name from the file name, and each coordinate from the list of the fiducials saved, which I can code out no problem if I have an example of a module that creates a button to select said directory (the only part I am missing)).</p>
<blockquote>
<p>Probably all the algorithms that MorphoJ offers are available in various Python packages and Slicer/SlicerMorph has all the GUI components you may need, so what is missing is really just putting together convenient modules for specific analysis tasks that you are interested in. <a class="mention" href="/u/muratmaga">@muratmaga</a> even offered to help you with this, so you would probably not need to invest a lot effort. <strong>Would you consider this option?</strong></p>
</blockquote>
<p>I would love to actually be able to edit MorphoJ to be more amenable to landmark file formats as the file format necessary was based on outdated softwares, some of which aren’t even available anymore. In addition, I would love for MorphoJ to be able to import ids for the landmarks as it makes sense to be able to tag the plots with the landmark names and such. Finally, it would be awesome to use landmarked files created from scalismo that saves a bunch of extra information such as point uncertainty values (something that isn’t saved in slicer, which I think also should be) from the models, and be able to factor that in to the GMM analysis as wel, but alas as you mentioned MorphoJ is a closed off software, so all I can do is work with modifying things to import into it. I would love for us to be able to expand the capabilities of SlicerMorph with extra modules to encompass all of these tasks, but that would be a long-term goal as I am sure <a class="mention" href="/u/muratmaga">@muratmaga</a> has enough on his plate already without me adding things like this to his to do list. I could do most of this myself if I had access to some examples of creating modules, pulling the PC data from slicerMorph without exporting it to separate files, and how to display results from analysis to slicer. I am just not familiar enough with building my own modules for data analysis. However, this is in general a longer-term project anyways as I need to have the protocol for the students ready by next semester, so for now I am trying to make do with using MorphoJ.</p>

---

## Post #27 by @stevenagl12 (2021-11-02 21:52 UTC)

<p>The RAS transformation to LPS is unnecessary as long as the coordinates are consistent between samples, and the coordinates are reasonable for calculating things like euclidean or procrustes distances. The code you have available requires the students to run a python script. I am trying to create a module for either saving the fiducials immediately as one batch csv/tsv/txt file, or as pulling a folder of fcsv files in and saving the batch file.</p>

---

## Post #28 by @smrolfe (2021-11-02 22:04 UTC)

<p>Yes, the Python function I provided could be wrapped in a very simple Slicer module with the input/output directories selected in the UI and sent to this function to run the batch conversion.</p>

---

## Post #29 by @muratmaga (2021-11-02 23:35 UTC)

<aside class="quote no-group" data-username="stevenagl12" data-post="26" data-topic="18751">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/stevenagl12/48/3391_2.png" class="avatar"> stevenagl12:</div>
<blockquote>
<p>I could do most of this myself if I had access to some examples of creating modules, pulling the PC data from slicerMorph without exporting it to separate files, and how to display results from analysis to slicer. I am just not familiar enough with building my own modules for data analysis.</p>
</blockquote>
</aside>
<p>I think you can build onto the script <a class="mention" href="/u/smrolfe">@smrolfe</a> provided to make it a self-sufficient module to read a directory of markups and turn them into a format MorphoJ understands. You may find developer’s tutorial useful to get started, and we can answer your questions.</p>
<p><a href="https://github.com/PerkLab/PerkLabBootcamp/blob/master/Doc/day3_2_SlicerProgramming.pptx?raw=true" class="onebox" target="_blank" rel="noopener">https://github.com/PerkLab/PerkLabBootcamp/blob/master/Doc/day3_2_SlicerProgramming.pptx?raw=true</a></p>

---

## Post #30 by @smrolfe (2021-11-03 00:42 UTC)

<p>As an example of this sort of conversion tool, you can see the <a href="https://github.com/SlicerMorph/SlicerMorph/tree/master/MorphologikaLMConverter" rel="noopener nofollow ugc">MorphologikaLMConverter</a> in SlicerMorph. You can replace the input file selector with the input directory selector, and the run function with the <code>convertMorphoJLM</code> function I posted in this thread.</p>

---

## Post #31 by @stevenagl12 (2021-11-08 16:38 UTC)

<p>Ok, so thank you <a class="mention" href="/u/smrolfe">@smrolfe</a> for all your help thus far. I have tried to use the MorphologikaLMConverter script and your previous script as templates for creating the new module. However, when I open 3D Slicer, while the module exists in the list of modules, when I click on it, the module does not display any of the parameter tools I have put into the script such as the input Directory selector, and such. Here is a screen shot:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/4/d45b83b9d988a5de4755365ee55d1dc995b71228.png" data-download-href="/uploads/short-url/uiBi9nTtB1yRUo3bdkQuZyTDq2c.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d45b83b9d988a5de4755365ee55d1dc995b71228_2_536x500.png" alt="image" data-base62-sha1="uiBi9nTtB1yRUo3bdkQuZyTDq2c" width="536" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d45b83b9d988a5de4755365ee55d1dc995b71228_2_536x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/4/d45b83b9d988a5de4755365ee55d1dc995b71228.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/4/d45b83b9d988a5de4755365ee55d1dc995b71228.png 2x" data-dominant-color="454547"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">712×664 4.46 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>The script is supposed to have an input directory selection, output directory selection, and output file name selection to run the conversion. Here is the code:</p>
<pre><code class="lang-auto">import os, glob
import unittest
import vtk, qt, ctk, slicer
from slicer.ScriptedLoadableModule import *
import logging

#
# ConvertMorphologikaLandmarks
#

class ExportMorphoJLandmarkFile(ScriptedLoadableModule):
  """Uses ScriptedLoadableModule base class, available at:
  https://github.com/Slicer/Slicer/blob/master/Base/Python/slicer/ScriptedLoadableModule.py
  """

  def __init__(self, parent):
    ScriptedLoadableModule.__init__(self, parent)
    self.parent.title = "ExportMorphoJLandmarkFile"
    self.parent.categories = ["User_Specifications"]
    self.parent.dependencies = []
    self.parent.contributors = ["Steven Lewis (UB), Sara Rolfe (UW)"] # replace with "Firstname Lastname (Organization)"
    self.parent.helpText = """
This module parses fcsv landmark files for landmark coordinates and compiles them into a new csv file where each sample name is followed by the x,y or x,y,&amp; z coordinates
for all landmarks tied to the file.
"""
    self.parent.helpText += self.getDefaultModuleDocumentationLink()
    self.parent.acknowledgementText = """
This module was developed by Steven Lewis with the assistance of Sara Rolfe.
""" # replace with organization, grant and thanks.

class ExportMorphoJLandmarkFileWidget(ScriptedLoadableModuleWidget):
  """Uses ScriptedLoadableModuleWidget base class, available at:
  https://github.com/Slicer/Slicer/blob/master/Base/Python/slicer/ScriptedLoadableModule.py
  """

  def setup(self):
    ScriptedLoadableModuleWidget.setup(self)

    # Instantiate and connect widgets ...

    #
    # Parameters Area
    #
    parametersCollapsibleButton = ctk.ctkCollapsibleButton()
    parametersCollapsibleButton.text = "Parameters"
    self.layout.addWidget(parametersCollapsibleButton)

    # Layout within the dummy collapsible button
    parametersFormLayout = qt.QFormLayout(parametersCollapsibleButton)

    #
    # Select landmark folder to import
    #
    
    self.inputDirectorySelector = ctk.ctkDirectoryButton()
    self.inputDirectory.directory = gt.GDir.homePath()
    self.inputDirectory.setToolTip('Select Directory with fcsv lanmark files')
    parametersFormLayout.addRow("Input Directory:", self.inputDirectory)
       
    #
    # output directory selector
    #
    self.outputDirectorySelector = ctk.ctkDirectoryButton()
    self.outputDirectory.directory = qt.QDir.homePath()
    parametersFormLayout.addRow("Output Directory:", self.outputDirectory)
    self.outputFileName = ctk.ctkPathLineEdit()
    parametersFormLayout.addRow("Name of output file:", self.outputFileName)

    #
    # Apply Button
    #
    self.applyButton = qt.QPushButton("Apply")
    self.applyButton.toolTip = "Run the compiling."
    self.applyButton.enabled = False
    parametersFormLayout.addRow(self.applyButton)

    # connections
    self.applyButton.connect('clicked(bool)', self.onApplyButton)
    self.inputDirectory.connect('validInputChanged(bool)', self.onSelectInput)
    self.outputDirectory.connect('validOutputChanged(bool)', self.onSelectOutput)
 
    # Add vertical spacer
    self.layout.addStretch(1)

    # Refresh Apply button state
    self.onSelectInput()
    #self.onSelectOutput()

  def cleanup(self):
    pass

  def onSelectInput(self):
    self.applyButton.enabled = bool(self.inputDirectory.directory) 


  def onApplyButton(self):
    logic = ExportMorphoJLandmarkFileLogic()
    logic.run(self.inputDirectory.directory, self.outputDirectory.directory, self. outputFileName)

#
# ExportMorphoJLandmarkFileLogic
#

class ExportMorphoJLandmarkFileLogic(ScriptedLoadableModuleLogic):
  """This class should implement all the actual
  computation done by your module.  The interface
  should be such that other python code can import
  this class and make use of the functionality without
  requiring an instance of the Widget.
  Uses ScriptedLoadableModuleLogic base class, available at:
  https://github.com/Slicer/Slicer/blob/master/Base/Python/slicer/ScriptedLoadableModule.py
  """

  def run(self, LandmarkfolderName, outputDirectory, outputFileName):
    """
    Run the actual conversion
    """
    assert os.path.isfile(LandmarkfolderName), 'Path specified is file not folder'
        
    directory = glob.glob(LandmarkfolderName+'/.*.fcsv')
    
    samples = []
    LMMatrix = directory
    
    for i,file in enumerate(directory):
        success, currentLMNode = slicer.util.loadMarkupsFiducialList(file)
        print('{}/{}'.format(i, i/(len(directory)+1)))
        print(file)
        for i,s in enumerate(directory):
            s = s.split('\\')
            s = s[-1].split('.')[0]
            samples[i] = s
        landmarkNumber = currentLMNode.GetNumberOfFiducials()
        LMArray = np.zeros(len(directory), landmarkNumber*3)
        for pointIndex in range(currentLMNode.GetNumberOfMarkups()):
            point=currentLMNode.GetNthControlPointPositionVector(pointIndex)
            point.Set(point[0],point[1],point[2])
            LMArray[i, pointIndex:pointIndex+2]=point
            
        LMMatrix = np.hstack(LMMatrix, LMArray)
            
    slicer.mrmlScene.RemoveNode(currentLMNode)
    np.savetxt(os.path.join(outputDirectory, outputFieName), LMArray, fmt="%s", delimiter=",")
    
    assert os.path.isfile(os.path.join(outputDirectory, outputFileName)), 'File Not Created'
    logging.info('Processing Completed')
        
    return True
</code></pre>

---

## Post #32 by @smrolfe (2021-11-08 17:29 UTC)

<p>There is an unrecognized package “gt” being used that’s not imported. You can see this is in the Slicer error output:</p>
<pre><code class="lang-auto">Traceback (most recent call last):
  File "/Users/sararolfe/SlicerTemp/ExportMorphoJLandmarkFile/ExportMorphoJLandmarkFile.py", line 56, in setup
    self.inputDirectory.directory = gt.GDir.homePath()
NameError: name 'gt' is not defined
</code></pre>

---

## Post #33 by @smrolfe (2021-11-08 18:26 UTC)

<p>I tried this replacing <code>gt.GDir.homePath()</code> with <code>qt.QDir.homePath()</code>. I have also added fixes to correct some I/O errors below:</p>
<pre><code class="lang-auto">import os, glob
import unittest
import vtk, qt, ctk, slicer
from slicer.ScriptedLoadableModule import *
import logging

#
# ConvertMorphologikaLandmarks
#

class ExportMorphoJLandmarkFile(ScriptedLoadableModule):
  """Uses ScriptedLoadableModule base class, available at:
  https://github.com/Slicer/Slicer/blob/master/Base/Python/slicer/ScriptedLoadableModule.py
  """

  def __init__(self, parent):
    ScriptedLoadableModule.__init__(self, parent)
    self.parent.title = "ExportMorphoJLandmarkFile"
    self.parent.categories = ["User_Specifications"]
    self.parent.dependencies = []
    self.parent.contributors = ["Steven Lewis (UB), Sara Rolfe (UW)"] # replace with "Firstname Lastname (Organization)"
    self.parent.helpText = """
This module parses fcsv landmark files for landmark coordinates and compiles them into a new csv file where each sample name is followed by the x,y or x,y,&amp; z coordinates
for all landmarks tied to the file.
"""
    self.parent.helpText += self.getDefaultModuleDocumentationLink()
    self.parent.acknowledgementText = """
This module was developed by Steven Lewis with the assistance of Sara Rolfe.
""" # replace with organization, grant and thanks.

class ExportMorphoJLandmarkFileWidget(ScriptedLoadableModuleWidget):
  """Uses ScriptedLoadableModuleWidget base class, available at:
  https://github.com/Slicer/Slicer/blob/master/Base/Python/slicer/ScriptedLoadableModule.py
  """

  def setup(self):
    ScriptedLoadableModuleWidget.setup(self)

    # Instantiate and connect widgets ...

    #
    # Parameters Area
    #
    parametersCollapsibleButton = ctk.ctkCollapsibleButton()
    parametersCollapsibleButton.text = "Parameters"
    self.layout.addWidget(parametersCollapsibleButton)

    # Layout within the dummy collapsible button
    parametersFormLayout = qt.QFormLayout(parametersCollapsibleButton)

    #
    # Select landmark folder to import
    #
    
    self.inputDirectory = ctk.ctkDirectoryButton()
    self.inputDirectory.directory = qt.QDir.homePath()
    self.inputDirectory.setToolTip('Select Directory with fcsv lanmark files')
    parametersFormLayout.addRow("Input Directory:", self.inputDirectory)
       
    #
    # output directory selector
    #
    self.outputDirectory = ctk.ctkDirectoryButton()
    self.outputDirectory.directory = qt.QDir.homePath()
    parametersFormLayout.addRow("Output Directory:", self.outputDirectory)
    
    #
    # enter filename for output
    #
    self.outputFileName = qt.QLineEdit()
    self.outputFileName.text = "morphoJOutput"
    parametersFormLayout.addRow("Name of output file:", self.outputFileName)

    #
    # Apply Button
    #
    self.applyButton = qt.QPushButton("Apply")
    self.applyButton.toolTip = "Run the compiling."
    self.applyButton.enabled = False
    parametersFormLayout.addRow(self.applyButton)

    # connections
    self.applyButton.connect('clicked(bool)', self.onApplyButton)
    self.inputDirectory.connect('validInputChanged(bool)', self.onSelectInput)
 
    # Add vertical spacer
    self.layout.addStretch(1)

    # Refresh Apply button state
    self.onSelectInput()
    #self.onSelectOutput()

  def cleanup(self):
    pass

  def onSelectInput(self):
    self.applyButton.enabled = bool(self.inputDirectory.directory) 


  def onApplyButton(self):
    logic = ExportMorphoJLandmarkFileLogic()
    outputFile = self.outputFileName.text + ".csv"
    logic.run(self.inputDirectory.directory, self.outputDirectory.directory, outputFile)

#
# ExportMorphoJLandmarkFileLogic
#

class ExportMorphoJLandmarkFileLogic(ScriptedLoadableModuleLogic):
  """This class should implement all the actual
  computation done by your module.  The interface
  should be such that other python code can import
  this class and make use of the functionality without
  requiring an instance of the Widget.
  Uses ScriptedLoadableModuleLogic base class, available at:
  https://github.com/Slicer/Slicer/blob/master/Base/Python/slicer/ScriptedLoadableModule.py
  """

  def run(self, LandmarkfolderName, outputDirectory, outputFileName):
    """
    Run the actual conversion
    """
    assert os.path.isdir(LandmarkfolderName), 'Path specified is file not folder'      
    directory = glob.glob(LandmarkfolderName+'/.*.fcsv')   
    samples = []
    LMMatrix = directory
    if(directory==[]):
      logging.info('No FCSV files found in input directory.')
      return False
    for i,file in enumerate(directory):
      success, currentLMNode = slicer.util.loadMarkupsFiducialList(file)
      print('{}/{}'.format(i, i/(len(directory)+1)))
      print(file)
      for i,s in enumerate(directory):
        s = s.split('\\')
        s = s[-1].split('.')[0]
        samples[i] = s
      landmarkNumber = currentLMNode.GetNumberOfFiducials()
      LMArray = np.zeros(len(directory), landmarkNumber*3)
      for pointIndex in range(currentLMNode.GetNumberOfMarkups()):
        point=currentLMNode.GetNthControlPointPositionVector(pointIndex)
        point.Set(point[0],point[1],point[2])
        LMArray[i, pointIndex:pointIndex+2]=point
            
      LMMatrix = np.hstack(LMMatrix, LMArray)
      slicer.mrmlScene.RemoveNode(currentLMNode)
      np.savetxt(os.path.join(outputDirectory, outputFileName), LMArray, fmt="%s", delimiter=",")
    
    assert os.path.isfile(os.path.join(outputDirectory, outputFileName)), 'File Not Created'
    logging.info('Processing Completed')
        
    return True
</code></pre>

---

## Post #34 by @lassoan (2021-11-08 18:51 UTC)

<p>Side note: Whenever you are sharing/updating more than 10-20 lines of source code, you could consider uploading it to a <a href="https://gist.github.com/">gist</a>. It is easier to view copy, and edit the code and the change history is stored, so you can see what fixes/improvements were made over time.</p>

---

## Post #35 by @smrolfe (2021-11-08 18:58 UTC)

<p>Thanks <a class="mention" href="/u/lassoan">@lassoan</a> this is a great tool!</p>
<p>I’ve created a gist with my changes tracked <a href="https://gist.github.com/smrolfe/f6ea90d9ff59bb306b8127b7342b4f6e/revisions" rel="noopener nofollow ugc">here</a></p>

---

## Post #36 by @stevenagl12 (2021-11-09 18:25 UTC)

<p>So I reviewed the gist you created and edited my own copy, as well as tried just downloading your python file, but Slicer is still not creating any of the parameter fields just like before.</p>

---

## Post #37 by @smrolfe (2021-11-09 18:28 UTC)

<p><a class="mention" href="/u/stevenagl12">@stevenagl12</a> Have you checked the Slicer error log? Could you post the output here?</p>

---

## Post #38 by @stevenagl12 (2021-11-09 23:19 UTC)

<p>It was a stupid mistake. Both when I downloaded the file from your account and when I went to adit my own script I accidentally entered an extra letter, albeit at different points, but it is fixed. The only problem I have now is when I actually run the script it says:</p>
<p>File “C:/Users/Steven Lewis/AppData/Roaming/NA-MIC/Extensions-28438/user_specifications/lib/Slicer-4.11/qt-scripted-modules/ExportMorphoJLandmarkFile.py”, line 133, in run<br>
success, currentLMNode = slicer.util.loadMarkupsFiducialList(file)<br>
TypeError: ‘vtkSlicerMarkupsModuleMRMLPython.vtkMRMLMarkupsFiducialNode’ object is not iterable</p>
<p>as the error in the log.</p>

---

## Post #39 by @smrolfe (2021-11-10 20:05 UTC)

<p><a class="mention" href="/u/stevenagl12">@stevenagl12</a> I replaced your run function with the one I shared previously it’s working for me. I’ve made that change to the <a href="https://gist.github.com/smrolfe/f6ea90d9ff59bb306b8127b7342b4f6e" rel="noopener nofollow ugc">gist</a>. If you need to change the formatting of the output, you might want to start from here.</p>

---

## Post #40 by @stevenagl12 (2021-11-10 22:04 UTC)

<p>So, I copied and pasted your script from github directly into a new Slicer module and only changed the module name, filename, and names of the classes to make sure that I wasn’t choosing the wrong module (ExportMorphoJFile instead of ExportMorphoJLandmarkFile). As you can see: this is the run function where nothing was changed: <div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/f/4/f44fe2c02a0e2f7977df4dfa501e6a8b057aa4c1.png" data-download-href="/uploads/short-url/yRhEKj7ugF9NkuD1HtismJi3Ltn.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/f/4/f44fe2c02a0e2f7977df4dfa501e6a8b057aa4c1.png" alt="image" data-base62-sha1="yRhEKj7ugF9NkuD1HtismJi3Ltn" width="690" height="463" data-dominant-color="F4F4F5"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1087×730 26.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
However, when I run this function it still gives me:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/d/cdd2dd39547fa49069239b402ff075244c229914.png" data-download-href="/uploads/short-url/tmNEEWympnuyjXbbTMav6kMR2Sw.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/d/cdd2dd39547fa49069239b402ff075244c229914.png" alt="image" data-base62-sha1="tmNEEWympnuyjXbbTMav6kMR2Sw" width="690" height="48" data-dominant-color="FFEEEF"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1411×99 6.76 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #41 by @lassoan (2021-11-10 22:35 UTC)

<p><a class="mention" href="/u/stevenagl12">@stevenagl12</a> Please never upload any source code as an image! Sometimes an editor may decide put the code on your clipboard as an image, but you can detect that by seeing an image link in your post instead of test. Source code images are completely unusable - we cannot copy-paste them to try them or compare to previous revisions.</p>
<p>If you are discussing code snippet longer than 10-20 lines of code then upload to a <a href="https://gist.github.com/">gist</a>. If you are discussing a module, create a repository on github and upload the file there (it allows other developers to clone your repository and easily propose changes via pull requests).</p>

---

## Post #42 by @stevenagl12 (2021-11-11 09:32 UTC)

<p>Ok, here is the code again. As mentioned it is the same code <a class="mention" href="/u/smrolfe">@smrolfe</a> had except with ExportMorphoJFile instead of ExportMorphoJLandmarkFile for the different classes, name of the file and name of the module <a href="https://gist.github.com/stevenagl12/a50d036fe0ae402d17545fd36221e9a7" rel="noopener nofollow ugc">ExportMorphoJFile</a></p>

---

## Post #43 by @muratmaga (2021-11-11 15:23 UTC)

<p>Your gist works perfectly fine for me with the latest stable, producing the morphoj output. Please try with stable version.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/0/6/064a6379630964ea0db4207da616c88fea0a3ab3.png" data-download-href="/uploads/short-url/TEeYIgQCSBdrvTqfyoTor5aEAX.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/6/064a6379630964ea0db4207da616c88fea0a3ab3_2_690x355.png" alt="image" data-base62-sha1="TEeYIgQCSBdrvTqfyoTor5aEAX" width="690" height="355" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/6/064a6379630964ea0db4207da616c88fea0a3ab3_2_690x355.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/6/064a6379630964ea0db4207da616c88fea0a3ab3_2_1035x532.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/6/064a6379630964ea0db4207da616c88fea0a3ab3_2_1380x710.png 2x" data-dominant-color="B5B9C2"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1924×990 66 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #44 by @muratmaga (2021-11-11 17:45 UTC)

<p>And after you confirm this works as intended, if you like we can include as part of the utility modules of SlicerMorph (if it is easier for you to distribute, you don’t need to have the individual students to install this as an additional module).</p>

---

## Post #45 by @smrolfe (2021-11-11 18:54 UTC)

<p>I’ve also tested on a recent preview version (10/28) and it’s working with that as well.</p>

---

## Post #46 by @stevenagl12 (2021-11-12 00:46 UTC)

<p>Ok, so I have now been able to get it to work. Not sure why it wasn’t working, but I had to download the latest preview release of Slicer. The release I had before was: 4.11.0-2019-08-13 r28438 that was giving me the iterable error. I have also double checked to make sure that the exported file works in morphoJ. If you want to package it into MorphoJ that would be nice.</p>

---

## Post #47 by @smrolfe (2021-11-12 04:39 UTC)

<p>That’s great news. Your previous Slicer installation was much older than the current stable. There have been many bug fixes and new features added since then, so is a good idea to update (either the preview or stable). Thanks for the feedback, we will plan to add this as a utility to the SlicerMorph extension.</p>

---

## Post #48 by @stevenagl12 (2021-11-19 04:20 UTC)

<p>For slicerMorph, within the GPA process is there a way you can do a rigid registration of the landmarks instead of the typical general Procrustes alignment before running the PCA?</p>

---

## Post #49 by @muratmaga (2021-11-19 04:23 UTC)

<p>Currently no. At some point we will add an option to align the procrustes coordinates with principal axes of data.</p>

---

## Post #50 by @lassoan (2022-01-28 23:18 UTC)

<p>18 posts were split to a new topic: <a href="/t/principal-components-analysis-in-slicermorph/21683">Principal components analysis in SlicerMorph</a></p>

---

## Post #51 by @stevenagl12 (2022-02-10 17:40 UTC)

<p>By any chance have you had the time to look at my utility for the slicermorph package for approval?</p>

---

## Post #52 by @smrolfe (2022-02-10 17:45 UTC)

<p><a class="mention" href="/u/stevenagl12">@stevenagl12</a> Thanks for your contribution,  I’ll review it shortly!</p>

---
