---
topic_id: 15335
title: "2021 01 05 Hangout"
date: 2021-01-04
url: https://discourse.slicer.org/t/15335
---

# 2021.01.05 Hangout

**Topic ID**: 15335
**Date**: 2021-01-04
**URL**: https://discourse.slicer.org/t/2021-01-05-hangout/15335

---

## Post #1 by @jcfr (2021-01-04 16:14 UTC)

<p>Tomorrow, we will be having our next weekly hangout at 10:00 AM ET until 11 AM ET.</p>
<p>Anyone is welcome to join to ask questions at <a href="https://bit.ly/slicer-googlemeet-hosted-by-kitware">https://bit.ly/slicer-googlemeet-hosted-by-kitware </a></p>
<p>Agenda:</p>
<ul>
<li>Discuss release a new version before integrating updated logo. See <a href="https://github.com/Slicer/Slicer/pull/5366#issuecomment-754065839">https://github.com/Slicer/Slicer/pull/5366#issuecomment-754065839</a>
</li>
<li>Volume rendering of segmentations</li>
<li>Test results not appearing on CDash</li>
<li>VTK9 update</li>
<li>New Slicer Stable Release</li>
<li>
<a href="https://github.com/commontk/AppLauncher/pull/114">Update of AppLauncher</a> - it is the last step for fully portable Slicer, including DICOM database (<a href="https://github.com/Slicer/Slicer/pull/5029">PR</a>)</li>
</ul>
<p>Feel free to post to this thread to request/suggest a topic!</p>
<p>Thanks<br>
Sam and J-Christophe</p>

---

## Post #2 by @pieper (2021-01-04 16:23 UTC)

<p>I’d like to touch base on volume rendering of segmentations too if we have time (rendering vector volumes with independent components off).</p>

---

## Post #3 by @jcfr (2021-01-04 19:57 UTC)

<aside class="quote no-group" data-username="pieper" data-post="2" data-topic="15335">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>volume rendering of segmentations too if we have time (rendering vector volumes with independent components off)</p>
</blockquote>
</aside>
<p><a class="mention" href="/u/sankhesh_jhaveri">@Sankhesh_Jhaveri</a> will join us at 10.30am to participate to this discussion</p>

---

## Post #4 by @pll_llq (2021-01-04 20:17 UTC)

<p>I would like to ask a question regarding the code style for python modules. The samples and the source code differ from the <a href="https://www.slicer.org/wiki/Documentation/Nightly/Developers/Style_Guide/Python" rel="noopener nofollow ugc">style guide in the wiki</a>. Is there some sort of a linter config for developing python modules for Slicer? If not, should there be one?</p>

---

## Post #5 by @pieper (2021-01-04 20:30 UTC)

<aside class="quote no-group quote-modified" data-username="jcfr" data-post="3" data-topic="15335" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/jcfr/48/17825_2.png" class="avatar"> jcfr:</div>
<blockquote>
<aside class="quote no-group" data-username="pieper" data-post="2" data-topic="15335">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>volume rendering of segmentations too if we have time (rendering vector volumes with independent components off)</p>
</blockquote>
</aside>
<p><a class="mention" href="/u/sankhesh_jhaveri">@Sankhesh_Jhaveri</a> will join us at 10.30am to participate to this discussion</p>
</blockquote>
</aside>
<p>That’s great!  Let me give a bit of background in case anyone wants to look in advance.  The basic idea is to render segmentations using a technique like <a href="https://discourse.slicer.org/t/merge-colored-images-and-show-them-as-1-volume/6472/7">the one described here</a> but with the reference volume as the alpha channel.</p>
<p>It works pretty well, and the SlicerMorph team really wants this mode, so one thing I want to do is speed up calculation of these.  I’m sure it can be made to work in real time for feedback while segmenting, with per-segment visibility controls, etc.</p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/d/4de7393d8e93c0d0d7e4199a712a3e5229b7372a.jpeg" data-download-href="/uploads/short-url/b7a9T5IejBSeAl8J5oht8F5EshI.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/4/4de7393d8e93c0d0d7e4199a712a3e5229b7372a_2_345x163.jpeg" alt="image" data-base62-sha1="b7a9T5IejBSeAl8J5oht8F5EshI" width="345" height="163" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/4/4de7393d8e93c0d0d7e4199a712a3e5229b7372a_2_345x163.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/4/4de7393d8e93c0d0d7e4199a712a3e5229b7372a_2_517x244.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/4/4de7393d8e93c0d0d7e4199a712a3e5229b7372a_2_690x326.jpeg 2x" data-dominant-color="3B4536"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">766×362 47.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><p></p>
<p>The problem I’m hitting is that the ray caster seems to use the alpha channel for opacity integration, but for some reason uses the red channel to calculate the gradient for lighting, leading to pixelation artifacts and incorrect normals (e.g. no normals in blue areas).</p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/8/d85e9472c3d67c3de63814e9e6991dafc91bafb6.jpeg" data-download-href="/uploads/short-url/uS5LK8yXy13P3JloZ6jp5u7fwpM.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d85e9472c3d67c3de63814e9e6991dafc91bafb6_2_278x250.jpeg" alt="image" data-base62-sha1="uS5LK8yXy13P3JloZ6jp5u7fwpM" width="278" height="250" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d85e9472c3d67c3de63814e9e6991dafc91bafb6_2_278x250.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d85e9472c3d67c3de63814e9e6991dafc91bafb6_2_417x375.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/d/d85e9472c3d67c3de63814e9e6991dafc91bafb6_2_556x500.jpeg 2x" data-dominant-color="33372D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">573×515 51.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><p></p>
<p>I’ve started working on a <a href="https://github.com/pieper/SlicerMorph/blob/SegmentRendering/SegmentationRendering/Experiments/independentComponetns.py">pure vtk script to reproduce the issue</a> but wanted to discuss with this group before filing a bug report.  Maybe I’m using it wrong or it’s already fixed in VTK master or someone’s branch.</p>
<p>The bottom ellipsoid is a single component volume and the top is rgba with the same alpha as the single component and red, green, blue slabs</p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/e/de1e317c681802f792702608720daf5180fabe01.png" data-download-href="/uploads/short-url/vGWGBXXz0BefyBjVucKZ7iRX5D3.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/e/de1e317c681802f792702608720daf5180fabe01_2_240x250.png" alt="image" data-base62-sha1="vGWGBXXz0BefyBjVucKZ7iRX5D3" width="240" height="250" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/e/de1e317c681802f792702608720daf5180fabe01_2_240x250.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/e/de1e317c681802f792702608720daf5180fabe01_2_360x375.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/e/de1e317c681802f792702608720daf5180fabe01_2_480x500.png 2x" data-dominant-color="968C8C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">604×629 59.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><p></p>
<p>I suspect this issue is <a href="https://github.com/Kitware/VTK/blob/master/Rendering/VolumeOpenGL2/vtkVolumeShaderComposer.h#L1239">on this line</a> but changing the 0 to a 3 does not work as I expected (color becomes black everywhere).</p>

---

## Post #6 by @lassoan (2021-01-04 22:07 UTC)

<p>I’ve tried to use this for segmentations, but the problem is that you need to blur the alpha channel if you want to see surfaces (otherwise you would not see the surface normal directions but the flat voxel side directions). However, if you blur the alpha channel then at the boundary you get voxels that have non-zero opacity but background color. This would add something like a dark haze around the segments. You could remove this by expanding the labelmap values a bit, but then it would mean that you need to maintain a separate labelmap (extra memory, extra expand step each time the input labelmap changed). This could be solved by using multi-volume rendering, but that would only work if you have a handful of segments, and definitely not work if you have hundreds of segments.</p>
<p>The ideal solution could be something like a custom volume rendering shader, which would compute the smoothed normal from a labelmap volume (for example by Gaussian smoothing; so that you would not need to update the smoothed alpha channel after each segment editing operation) and would find out the voxel color from the nearest (or median) label value.</p>

---

## Post #7 by @pieper (2021-01-04 23:43 UTC)

<p>I agree, a custom shader could solve the more general problem of rendering segmentations and that’s not out of the question if there were a motivating need.  I do have a prototype of such a shader in webgl.  There are many other nice features that could be added like handling nonlinear transforms in the ray caster.  But VTK’s gpu code is pretty complex and so solving the general problem is nontrivial.</p>
<p>But for the SlicerMorph use case it’s almost always bones in microCT, so the alpha channel can come from the CT and not from the segments.  The segments only provide color.  An example use case would be to independently color each of the bones in a fish or regions of the skull, like in the mouse example.  So in the end it’s just scalar opacity / gradient opacity rendering but colored by the segments.</p>
<p>And yes, in the mouse example I grew the margin around the segments so that the non-zero alpha around the segments blends with the correct color to avoid the halo.  Calculating that margin operation shouldn’t be a problem.  Updating such an rgba volume should be way faster than building a surface model and would have basically constant time even as the complexity of the segmentation grows.  Multivolume rendering is not needed for this.</p>
<p>The dependent components volume rendering in vtk is already very close, other than the bug I described above which prevents nice rendering with shading enabled.</p>

---

## Post #8 by @RafaelPalomar (2021-01-06 15:48 UTC)

<p>For the curious, <a class="mention" href="/u/jcfr">@jcfr</a> mentioned about the possibility to add a git local repo as a remote repo to have like two working branches and push/pull from one to another. There is the concept of git worktrees (<a href="https://git-scm.com/docs/git-worktree" rel="noopener nofollow ugc">https://git-scm.com/docs/git-worktree</a>), which pivots around a similar idea (<a href="https://levelup.gitconnected.com/git-worktrees-the-best-git-feature-youve-never-heard-of-9cd21df67baf" rel="noopener nofollow ugc">https://levelup.gitconnected.com/git-worktrees-the-best-git-feature-youve-never-heard-of-9cd21df67baf</a>). Cheers.</p>

---
