---
topic_id: 24911
title: "Error Loading Nifti File"
date: 2022-08-24
url: https://discourse.slicer.org/t/24911
---

# Error loading nifti file

**Topic ID**: 24911
**Date**: 2022-08-24
**URL**: https://discourse.slicer.org/t/error-loading-nifti-file/24911

---

## Post #1 by @DeepaKrishnaswamy (2022-08-24 19:06 UTC)

<p>Hi,</p>
<p>I’m trying to load a nifti file in the Slicer 5.1.0-2022-05-24 version as a segmentation, and the following error occurs:</p>
<p><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/f/4f0f9aa75453d34dceecd967356222b1f4b252fb.png" alt="image" data-base62-sha1="bhp9pDakExVKEsx3im0fAyMnaOL" width="503" height="227"></p>
<p>The nifti file is uploaded <a href="https://www.dropbox.com/s/v8hplu6vjdxqk11/totalsegmentor_output.nii.gz?dl=0" rel="noopener nofollow ugc">here</a></p>
<p>Thank you!</p>
<p>Deepa</p>

---

## Post #2 by @pieper (2022-08-24 19:44 UTC)

<p>Hi Deepa -</p>
<p>Yes, this has been happening with the latest Slicer due to tightening of the ITK file loader in terms of what it considers valid nifti format.  (See <a href="https://discourse.slicer.org/t/open-nifti-in-3d-slicer/24495">here</a> and <a href="https://github.com/InsightSoftwareConsortium/ITK/issues/3514">here</a> for some discussions).</p>
<p>What software generated this file?  Arguably the file is ambiguous (non-conforming to the standard) and the software that generated it needs to be fixed.</p>
<p>As a workaround you could use the older 4.11 version to convert to nrrd if you don’t have any other options.  Or perhaps you can use a different file format from the beginning.</p>
<p>-Steve</p>

---

## Post #3 by @DeepaKrishnaswamy (2022-08-24 20:32 UTC)

<p>Hi Steve,</p>
<p>Thanks for your response! I’ll take a look at those discussions.</p>
<p>The nifti file was generated by the package TotalSegmenter (<a href="https://github.com/wasserth/TotalSegmentator" class="inline-onebox" rel="noopener nofollow ugc">GitHub - wasserth/TotalSegmentator: Tool for robust segmentation of 104 important anatomical structures in CT images</a>). Converting to nrrd would be fine for my case I think.</p>
<p>Thanks!</p>
<p>Deepa</p>

---

## Post #4 by @pieper (2022-08-24 20:58 UTC)

<p>Hi Deepa -</p>
<p>I guessed that was the case!  I have been testing out TotalSegmentator too and ran into exactly the same issue.</p>
<p>I’m applying the tool to a directory full of CT scans and oddly the error only shows up in a few of them.  And for the cases where the output of TotalSegmentator fails to load the original data set loads fine, so somehow the header is not being preserved correctly.  There must be something about the geometry of some cases that leads to this issue, possibly when the images are resized to fit the network…</p>
<p>From what I can tell TotalSegmentator uses nnUNET code to write the files and that uses SimpleITK.  So it’s ironic that ITK now can’t read a file written by SimpleITK.</p>
<p>So the workaround of using the old Slicer is still valid, but this gives another argument for investigating if the current version of ITK is being overly strict.  Or if the files are really wrong we help them fix TotalSegmentator/nnUNET/SimpleITK.</p>
<p>BTW, TotalSegmentator itself is quite nice and seems robust.  I ran it on the CTACardio scan from the Slicer SampleData and the results are impressive to my eye.  (The segmentation below took 8 minutes on a K80 GPU).</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/3/d32c12fc0aaed6610554665bc6e9c4b98683a0b6.jpeg" data-download-href="/uploads/short-url/u87aPB7F3Hix8C3wd4mgUFim4KO.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/3/d32c12fc0aaed6610554665bc6e9c4b98683a0b6_2_424x500.jpeg" alt="image" data-base62-sha1="u87aPB7F3Hix8C3wd4mgUFim4KO" width="424" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/3/d32c12fc0aaed6610554665bc6e9c4b98683a0b6_2_424x500.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/d/3/d32c12fc0aaed6610554665bc6e9c4b98683a0b6_2_636x750.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/3/d32c12fc0aaed6610554665bc6e9c4b98683a0b6.jpeg 2x" data-dominant-color="726E70"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">811×955 74.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #5 by @issakomi (2022-08-25 03:02 UTC)

<aside class="quote no-group" data-username="pieper" data-post="2" data-topic="24911">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/pieper/48/8_2.png" class="avatar"> pieper:</div>
<blockquote>
<p>(See <a href="https://discourse.slicer.org/t/open-nifti-in-3d-slicer/24495">here</a> and <a href="https://github.com/InsightSoftwareConsortium/ITK/issues/3514" rel="noopener nofollow ugc">here</a> for some discussions).</p>
</blockquote>
</aside>
<p>I can open the file with current ITK master, the error message is the same, but it is (or was) another issue, highly likely fixed with the <a href="https://github.com/InsightSoftwareConsortium/ITK/pull/3339" rel="noopener nofollow ugc">https://github.com/InsightSoftwareConsortium/ITK/pull/3339</a></p>

---

## Post #6 by @dzenanz (2022-09-15 00:08 UTC)

<p><a href="https://github.com/InsightSoftwareConsortium/ITK/pull/3339" rel="noopener nofollow ugc">ITK PR 3339</a> fixes it for me. It should come with <a href="https://github.com/Slicer/Slicer/pull/6454" rel="noopener nofollow ugc">Slicer PR 6454</a>. The problem was most likely introduced by <a href="https://github.com/InsightSoftwareConsortium/ITK/pull/1868" rel="noopener nofollow ugc">ITK PR 1868</a>.</p>
<p>I was reading posts about nifti issues, but I somehow managed to miss <a class="mention" href="/u/issakomi">@issakomi</a>’s post.</p>
<p><a class="mention" href="/u/sam_horvath">@Sam_Horvath</a> and <a class="mention" href="/u/jamesobutler">@jamesobutler</a> can we merge 6454 now?</p>
<p>Also CC: <a class="mention" href="/u/hjmjohnson">@hjmjohnson</a> <a class="mention" href="/u/pieper">@pieper</a> <a class="mention" href="/u/lassoan">@lassoan</a>.</p>

---
