# LungCTAnalyzer and fibrosis quantification

**Topic ID**: 24109
**Date**: 2022-06-29
**URL**: https://discourse.slicer.org/t/lungctanalyzer-and-fibrosis-quantification/24109

---

## Post #1 by @ashipde (2022-06-29 20:51 UTC)

<p>May be I am wrong but it seems LungCTAnalyzer cannot be used to quantify lung fibrosis. Perhaps this feature will be added to the extension in the future.  Fibrosis quantification will be very useful for many. I have read about some software for this purpose but either they are old or unavailable or not deployable on todays computers, like LUFIT and YACTA, or commercial and pricey, like IMBIO.</p>

---

## Post #2 by @rbumm (2022-06-29 21:34 UTC)

<p>What do you want to see, which patterns are of special interest for you , what would you want to quantify in ml. Please make an anonymized dataset available so we could have a look at it in Slicer. You could also post some screenshots here where you think LCTA fails.</p>

---

## Post #3 by @ashipde (2022-06-30 20:01 UTC)

<p><a class="mention" href="/u/rbumm">@rbumm</a></p>
<aside class="quote no-group quote-modified" data-username="rbumm" data-post="2" data-topic="24109" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/rbumm/48/9404_2.png" class="avatar"> rbumm:</div>
<blockquote>
<p>What do you want to see…</p>
</blockquote>
</aside>
<p>Dr. Bumm, thanks for responding. I am a novice and actually don’t know myself but was wondering if some expert had assessed LungCTAnalyzer for the purpose of quantifying fibrosis in ILD, IPF, etc. by measuring GGO, honeycombing, reticular density, etc. (CT pattern or texture analysis). E.g., is ‘infiltration’ identified by LungCTAnalyzer a good measure of GGO?</p>
<p>Below, I have copied some <a href="https://link.springer.com/article/10.1007/s00408-017-0035-0" rel="noopener nofollow ugc">text</a> about the method used by the CALIPER CT pattern analysis software that purports to quantify fibrosis.</p>
<blockquote>
<p>Following anatomic segmentation, the parenchymal detection and classification is performed by using a similarity metric to match parenchymal histogram features within 15x15x15 pixel volumes of interest to validated histogram signatures of characteristic voxels and morphological assessment of classified voxels in order to label each pixel in the dataset with the radiographic characteristics. These labels specify a pixel as belonging to normal lung parenchyma or to features of ILD such as ground glass opacity, reticular densities, honeycombing, or low attenuation areas (with sub-classes of mild, moderate and severe). The technique involves a sliding window supervised classification scheme described by Maldonado et al. [<a href="https://link.springer.com/article/10.1007/s00408-017-0035-0#ref-CR7" rel="noopener nofollow ugc">7</a>] The total volume, measured in liters, and the percentage of normal parenchyma, low attenuation areas (mild, moderate, and severe sub-classes), and interstitial abnormalities (GGO, RD, and HC) were automatically generated by the CALIPER software. The total volume was comprised of low attenuation areas (mild, moderate, severe), ground glass opacities, honeycombing, reticular densities, normal areas, and vessel volumes. Total interstitial abnormalities were defined as the summation of GGO, RD, and HC. The remainder of the lung volume (vessel volume, normal and low attenuation areas) was summed as non-involved lung areas.</p>
</blockquote>

---

## Post #4 by @rbumm (2022-06-30 20:43 UTC)

<p>I have no experience with CALIPER, nor have I analyzed ILD patients yet.<br>
Pattern recognition is something you can not do with Lung CT Segmenter, which was made to determine thresholded areas of special lung density. i.e. pre-setting a threshold value of Hounsfield Units and obtaining a segmentation of both lungs and a quantitative evaluation of emphysema,  healthy residual lung parenchyma, GGO, and consolidation (<a href="https://link.springer.com/article/10.1007/s11547-020-01293-w">like in this paper</a>)</p>

---

## Post #5 by @rbumm (2022-07-13 18:50 UTC)

<p>Here is a Lung CT Analyzer result in a patient with lung fibrosis and a good visual correlation of the fibrotic lung changes and their detected volumes. I do not see why you could not use LCTA this way in IPF - if you need more threshold ranges please let us know.</p>
<p></p><div class="video-container">
    <video width="100%" height="100%" preload="metadata" controls="">
      <source src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/6/661d6d022cd0280379c54116f94d6034cce2a762.mp4">
      <a href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/6/661d6d022cd0280379c54116f94d6034cce2a762.mp4">https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/6/661d6d022cd0280379c54116f94d6034cce2a762.mp4</a>
    </source></video>
  </div><p></p>

---

## Post #6 by @mariopal8 (2022-10-07 09:05 UTC)

<p>Hi, i´m using “Lung CT Analyzer” on mices with fibrosis. First, i do a manual segmentation; treshold+paint+grow form seed+smoothing, and once i got the segmented lungs, when i try to run the CT Analyzer, at 85% of running it, appears the following error: Failed to compute results: expects 0 &lt;= id &amp;&amp; id &lt; GetNumberOfValues().<br>
What could i do?</p>

---

## Post #7 by @rbumm (2022-10-07 09:34 UTC)

<p>Hi, which version of 3D Slicer and Lung CT Analyzer do you use?<br>
Could you post a screenshot of your 3D Slicer screen before you press the “Compute results” button?</p>

---

## Post #8 by @mariopal8 (2022-10-07 09:39 UTC)

<p>Hi, i´m using 3D Slicer 5.1.0-2022-10-03 and Lung CT Analyzer 20da0bc.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/3/e/3e8deb3acbac3f92b5e68c5c72e9493fdcfe918a.png" data-download-href="/uploads/short-url/8VnF6k8YYDBoHD2A8hDOxNcELpw.png?dl=1" title="Captura de pantalla 2022-10-07 113842" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/3/e/3e8deb3acbac3f92b5e68c5c72e9493fdcfe918a_2_681x500.png" alt="Captura de pantalla 2022-10-07 113842" data-base62-sha1="8VnF6k8YYDBoHD2A8hDOxNcELpw" width="681" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/3/e/3e8deb3acbac3f92b5e68c5c72e9493fdcfe918a_2_681x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/3/e/3e8deb3acbac3f92b5e68c5c72e9493fdcfe918a_2_1021x750.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/3/e/3e8deb3acbac3f92b5e68c5c72e9493fdcfe918a.png 2x" data-dominant-color="8A8B91"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Captura de pantalla 2022-10-07 113842</span><span class="informations">1279×938 209 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #9 by @rbumm (2022-10-07 10:05 UTC)

<p>Would it be possible to provide a link to one of your datasets (preferably a mrb bundle)? Would be helpful to provide a fast solution or to identify a bug.<br>
Only if the mouse agrees and we do not get into anonymization problems here <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>

---

## Post #11 by @mariopal8 (2022-10-07 10:42 UTC)

<p>jajaj yes, there you got the nrrd<br>
<a href="https://drive.google.com/file/d/13GslsiCGR_4FmTRt3aw5eWqZRkwjdwQa/view?usp=drive_web" rel="noopener nofollow ugc"><img src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png" width="16" height="16">05oct2022_MMR617.nrrd</a><img src="//ssl.gstatic.com/ui/v1/icons/common/x_8px.png" width="21" height="21"></p>

---

## Post #12 by @mariopal8 (2022-10-07 10:44 UTC)

<p>also, i’m sending you the dicom<br>
<a href="https://drive.google.com/file/d/1AE_NCZERI9fj7vHiYZ4ikxT9l9wc3CRx/view?usp=drive_web" rel="noopener nofollow ugc"><img src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png" width="16" height="16">2022-10-05_12-56-03.zip</a><img src="//ssl.gstatic.com/ui/v1/icons/common/x_8px.png" width="21" height="21"></p>

---

## Post #14 by @mariopal8 (2022-10-07 11:09 UTC)

<p>i’ve already created a folder</p>

---

## Post #15 by @rbumm (2022-10-07 13:49 UTC)

<p>The problems arise because Lung CT Analyzer has been developed for human CT data and the mouse data has different dimensions and thresholds. I removed some bugs in LCTA and got this running, but we will see how meaningful the analysis will turn out. Please expect an update on the extension within the next few days (to version 2.56)  which will no longer have the error messages.</p>
<p>Mouse test:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/8/d/8d78bd15d3b33aeeb9fb237fe4a4a4d95fcda019.png" data-download-href="/uploads/short-url/kbw0hLpSp8EJjvYIQDT58lguXpL.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/8/d/8d78bd15d3b33aeeb9fb237fe4a4a4d95fcda019_2_690x324.png" alt="image" data-base62-sha1="kbw0hLpSp8EJjvYIQDT58lguXpL" width="690" height="324" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/8/d/8d78bd15d3b33aeeb9fb237fe4a4a4d95fcda019_2_690x324.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/8/d/8d78bd15d3b33aeeb9fb237fe4a4a4d95fcda019_2_1035x486.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/8/d/8d78bd15d3b33aeeb9fb237fe4a4a4d95fcda019_2_1380x648.png 2x" data-dominant-color="B6B5B7"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1911×898 194 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #16 by @mariopal8 (2022-10-10 07:44 UTC)

<p>wow, thank you, that’s amazing, so grateful <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
I’ll be checking for the update.</p>

---

## Post #17 by @mariopal8 (2022-10-17 10:53 UTC)

<p>Hi,<br>
sorry to disturb you again, but I was wondering how you do the segmentation, so I can see the threshold values you used and that stuff.<br>
Thank you,</p>

---

## Post #18 by @rbumm (2022-10-17 11:50 UTC)

<p>Press “Hide mask segments in 2D” and “Show preview in 2D” and move the sliders.</p>
<p>Here are some settings which should work for your mouse.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/6/46cdcceaca94d1cddd4848e952c0be84efa51ba5.jpeg" data-download-href="/uploads/short-url/a6mlBak2lCxWogpdfVx80HXICS9.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46cdcceaca94d1cddd4848e952c0be84efa51ba5_2_690x281.jpeg" alt="image" data-base62-sha1="a6mlBak2lCxWogpdfVx80HXICS9" width="690" height="281" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46cdcceaca94d1cddd4848e952c0be84efa51ba5_2_690x281.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46cdcceaca94d1cddd4848e952c0be84efa51ba5_2_1035x421.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46cdcceaca94d1cddd4848e952c0be84efa51ba5_2_1380x562.jpeg 2x" data-dominant-color="78767D"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1919×784 119 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>If ok press “Compute results”.</p>

---

## Post #19 by @mariopal8 (2022-10-19 10:47 UTC)

<p>that’s useful, but I wanted to know how you do to get the lung segmentation from the image, if you use tresholds and grow from seeds, a segmentation extension…</p>

---

## Post #20 by @rbumm (2022-10-19 12:43 UTC)

<p>In the image above I used the dataset you sent to me, it included your lung segmentations.</p>
<p>You could also use the Lung CT Segmenter to easily generate the lung segments.</p>
<p><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/d/9/d90886511cbe796ca26bc57f798af52fe2197f2b.png" alt="image" data-base62-sha1="uXXSfXxPmdQYobOwGlb6Ldlg1dh" width="387" height="42"></p>
<p>To prevent preview blurring, you just need to set the “Image Spacing” of your microCT in “Volumes” to 1 mm.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/5/c546a0798d8eae02ea76e17620bcf05ff41d1d2f.png" data-download-href="/uploads/short-url/s9bnuWl3hPfqnpatUbqqOzqzO7d.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/5/c546a0798d8eae02ea76e17620bcf05ff41d1d2f_2_690x285.png" alt="image" data-base62-sha1="s9bnuWl3hPfqnpatUbqqOzqzO7d" width="690" height="285" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/5/c546a0798d8eae02ea76e17620bcf05ff41d1d2f_2_690x285.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/5/c546a0798d8eae02ea76e17620bcf05ff41d1d2f_2_1035x427.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/5/c546a0798d8eae02ea76e17620bcf05ff41d1d2f.png 2x" data-dominant-color="9C9A99"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1161×480 93.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #21 by @mariopal8 (2022-11-10 12:13 UTC)

<p>Hi,<br>
using the Lung CT Segmenter on mices with tumors, I get the following results in ‘Data’, but when I try to see the tumor, nothing appears, what could i do?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/0/603aec830182fae581eeecdfdbe6589980b0f8c8.jpeg" data-download-href="/uploads/short-url/dJi51i14lm2jpm8vgZR0NV2GToI.jpeg?dl=1" title="imagen" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/0/603aec830182fae581eeecdfdbe6589980b0f8c8_2_690x469.jpeg" alt="imagen" data-base62-sha1="dJi51i14lm2jpm8vgZR0NV2GToI" width="690" height="469" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/0/603aec830182fae581eeecdfdbe6589980b0f8c8_2_690x469.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/0/603aec830182fae581eeecdfdbe6589980b0f8c8_2_1035x703.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/0/603aec830182fae581eeecdfdbe6589980b0f8c8.jpeg 2x" data-dominant-color="AAABB0"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">imagen</span><span class="informations">1280×871 176 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #22 by @rbumm (2022-11-10 13:12 UTC)

<p>Hi,</p>
<p>The segments “PA”, “PV” and “tumor” are empty by default and only provided for the convenience of users who need to segment these structures manually.</p>
<p>“vesselmask” gets segmented as soon as you select</p>
<p><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/6/e625a1ff66c4ffb1ce6790e8f943a811526ac7fa.png" alt="image" data-base62-sha1="wPYrER8jtChFeOo8tvrm84jTnHY" width="144" height="35"></p>
<p>It is in the plan to populate all of those segments (especially tumor) with AI or 3D Slicer segmentation techniques.</p>

---
