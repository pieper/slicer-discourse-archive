# How to release an extension

**Topic ID**: 26289
**Date**: 2022-11-17
**URL**: https://discourse.slicer.org/t/how-to-release-an-extension/26289

---

## Post #1 by @ebrahim (2022-11-17 18:13 UTC)

<p>When creating a purely scripted (i.e. python only) Slicer extension, what is a good release “object” to create and how do I create it?</p>
<p>Ideally I want something that I can use with the extension manager’s <em>Install from file</em> button</p>
<p><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/3/5353a2dd81293e647e00711d228bab1270dc30e0.png" alt="image" data-base62-sha1="bT8OPaul7t4ui9ipU7pCDQ9yZOg" width="154" height="33"></p>
<p>I see it’s looking for some kind of zip or tarball, but IDK what exactly</p>

---

## Post #2 by @jcfr (2022-11-17 19:45 UTC)

<blockquote>
<p>what is a good release “object” to create and how do I create it?<br>
for some kind of zip or tarball, but IDK what exactly</p>
</blockquote>
<p>These <code>.tar.gz</code> or <code>.zip</code> files correspond to the extension package generated by building the extension. See <a href="https://slicer.readthedocs.io/en/latest/developer_guide/extensions.html#build-an-extension">Developer Guide/ Extensions Build an extension</a></p>
<p>Usually, the official Slicer build machine take care of generting the “package” and uploading it to <a href="https://slicer-packages.kitware.com/">https://slicer-packages.kitware.com/</a></p>
<blockquote>
<p>start Slicer with your python module</p>
</blockquote>
<p>This can be done specifying an additional module path. See <a href="https://slicer.readthedocs.io/en/latest/user_guide/settings.html#additional-module-paths" class="inline-onebox">Application settings — 3D Slicer documentation</a></p>

---

## Post #3 by @ebrahim (2022-11-17 20:05 UTC)

<p>Thanks. So the extension manager’s <em>Install from file</em> button cannot be used to install a purely scripted module? It has to be done by specifying an additional module path?</p>

---

## Post #4 by @Sam_Horvath (2022-11-17 20:14 UTC)

<p>The install from file button is intended to install extension packages, which are as <a class="mention" href="/u/jcfr">@jcfr</a> says are the tar/zip files. When we distribute extensions on the factory machines, pure python extensions are still “built” i.e. cmake and the build system are used to copy and zip the files into the appropriate structure.</p>
<p>The best and most repeatable way to generate the release object is to build and package the extension so that it is compatible with the Slicer extension ecosystem.</p>

---

## Post #5 by @Sam_Horvath (2022-11-17 20:26 UTC)

<p>Here is an example of a “pure python” extension that is built on the factory: <a href="https://github.com/acetylsalicyl/SlicerRawImageGuess" class="inline-onebox">GitHub - acetylsalicyl/SlicerRawImageGuess</a></p>
<p>The important thing is that it must be an extension (and have the appropriate CMake files), not just a module file.</p>

---

## Post #6 by @lassoan (2022-11-17 21:25 UTC)

<p>And here is the extension package created from the RawImageGuess extension by building the PACKAGE target: <a href="https://slicer-packages.kitware.com/api/v1/item/62871f65e8408647b39feaba/download">https://slicer-packages.kitware.com/api/v1/item/62871f65e8408647b39feaba/download</a></p>
<p>As you can see, the files are mostly just copied from the source tree, but <a href="https://github.com/acetylsalicyl/SlicerRawImageGuess/blob/500aff32eeb3515e20508354e6bccd5bde787a48/RawImageGuess/CMakeLists.txt#L5-L12">exactly which files are included in the package and where they are placed</a> and <a href="https://github.com/acetylsalicyl/SlicerRawImageGuess/blob/500aff32eeb3515e20508354e6bccd5bde787a48/CMakeLists.txt#L7-L13">extension metadata</a> (that is saved in the s4ext file in the package) are specified in CMakeLists.txt files, and the package structure is slightly different on macOS than on Linux and Windows.</p>
<p>It would be nice to build extension package from Python-only extensions without having to build Slicer. There could be several options:</p>
<ul>
<li>Option A: Use the build tree in <a href="https://github.com/slicer/SlicerDocker">slicer/slicer-base docker image</a>. It may be just a single-line command that you need to write to build a package from your extension’s source tree. Unfortunately, it would only create Linux package.</li>
<li>Option B: Create some sham CMake files that would provide an empty <code>Slicer</code> package for <code>find_package</code> and various CMake macros and functions that are used for building an extension. Then CMake could be pip-installed and used for building the package, without a real Slicer build tree and without the need for any additional build tools.</li>
<li>Option C: Create an alternative packaging method for Python-only packages. It could be based on a manifest file that would specify extension metadata and list of files to include in the package. We would then need 1. some Python scripts that could create an extension package based on this manifest, and 2. CMake functions, which would allow building and testing the extension based on information in the manifest file.</li>
</ul>

---

## Post #7 by @ebrahim (2022-11-18 15:38 UTC)

<p>Thank you everyone for the responses. So in the end it <em>is</em> possible to install a purely scripted extension using the “Install from file” button. Piecing it together from the replies above, here is what finally worked for me:</p>
<pre data-code-wrap="sh"><code class="lang-nohighlight">mkdir build
cd build
cmake .. -DSlicer_DIR=path/to/my/slicer/inner/build -DCMAKE_BUILD_TYPE:STRING=Release
make package
</code></pre>
<p>This created a tar.gz file that I was then able to use with the “Install from file” button.</p>
<p>(This is sort of explained in a scattered way in the <a href="https://slicer.readthedocs.io/en/latest/developer_guide/extensions.html" rel="noopener nofollow ugc">extension guide</a>, but was not very straight forward to tease out for me, partly because I have a poor understanding of build systems <img src="https://emoji.discourse-cdn.com/twitter/sweat_smile.png?v=12" title=":sweat_smile:" class="emoji" alt=":sweat_smile:" loading="lazy" width="20" height="20"> , so ty for the help)</p>

---

## Post #8 by @Joshua_Jacobs1 (2023-05-11 19:22 UTC)

<p>Ebrahim,</p>
<p>I used the following script to create installation packages for Windows, Mac, and Linux from the created package for a linux machine.</p>
<pre><code class="lang-auto">#!/bin/bash
build_dir=../Code/slicerflywheelcaseiterator/build
cp $build_dir/*git*tar.gz ./

# 30822: Slicer-5.0.2
# 30893: Slicer-5.0.3
# 31122: Slicer-5.1.0 (draft)
# 31314: Slicer-5.2.0
# 31317: Slicer-5.2.1
# 31382: Slicer-5.2.2
# 31734: Slicer-5.3.0

declare -A slicer_versions=(
    [5.0.2]="30822"
    [5.0.3]="30893"
    [5.1.0]="31122" # draft
    [5.2.0]="31314"
    [5.2.1]="31317"
    [5.2.2]="31382"
    [5.3.0]="31734"
)

linux_build_tar=*git*.tar.gz
linux_build=`basename --suffix=.tar.gz ${linux_build_tar%%.*}`
ext_num=`echo $linux_build | awk -F'-' '{print $1}'`
ext_name=`echo $linux_build | awk -F'64-' '{print $2}'| awk -F'-git' '{print $1}'`
slicer_base_version=5.3


echo $linux_build_tar
echo $linux_build
echo $ext_num
echo $ext_name

tar xzvf $linux_build_tar

for i in 0 1 2;do
    cp -rf $linux_build/lib/Slicer-$slicer_base_version $linux_build/lib/Slicer-5.$i;
    cp -rf $linux_build/share/Slicer-$slicer_base_version $linux_build/share/Slicer-5.$i;
done

tar czvf $linux_build_tar $linux_build

# create windows build
windows_build=${linux_build/linux/win}
cp -rf $linux_build $windows_build

tar czvf $windows_build.tar.gz $windows_build

## create mac build
mac_build=${linux_build/linux/mac}
for key in "${!slicer_versions[@]}"; do
    slicer_dest_version=${key:0:3}
    dest_ext_num=${slicer_versions[$key]}
    mac_dir=$mac_build/Slicer.app/Contents/Extensions-$dest_ext_num/$ext_name
    echo $mac_dir
    mkdir -p $mac_dir/{lib,share}
    cp -rf $linux_build/lib/Slicer-$slicer_base_version \
           $mac_dir/lib/Slicer-$slicer_dest_version
    cp -rf $linux_build/share/Slicer-$slicer_base_version \
           $mac_dir/share/Slicer-$slicer_dest_version       
done

zip -r $mac_build.zip $mac_build

# # clean up
rm -rf $linux_build
rm -rf $windows_build
rm -rf $mac_build
</code></pre>

---
