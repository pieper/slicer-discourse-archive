# Composite transform from ANTsR is read incorrectly into Slicer

**Topic ID**: 26498
**Date**: 2022-11-29
**URL**: https://discourse.slicer.org/t/composite-transform-from-antsr-is-read-incorrectly-into-slicer/26498

---

## Post #1 by @muratmaga (2022-11-29 19:25 UTC)

<p>I have registered a mouse image to a template in ANTsR (R version of ANTs). We have saved the resultant affine and deformable transforms and when these are loaded into Slicer and correctly nested, the resultant image is correct (i.e. consistent with what I obtain in ANTsR).</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/0/50057fb64f07eb6622cdc05beec07d3ac3d2eac3.jpeg" data-download-href="/uploads/short-url/bpTYGYDrqykceM3dU73PRq5LWHp.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/5/0/50057fb64f07eb6622cdc05beec07d3ac3d2eac3_2_690x319.jpeg" alt="image" data-base62-sha1="bpTYGYDrqykceM3dU73PRq5LWHp" width="690" height="319" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/5/0/50057fb64f07eb6622cdc05beec07d3ac3d2eac3_2_690x319.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/5/0/50057fb64f07eb6622cdc05beec07d3ac3d2eac3_2_1035x478.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/0/50057fb64f07eb6622cdc05beec07d3ac3d2eac3.jpeg 2x" data-dominant-color="B4B4B5"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1320×611 86.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>From the affine and warp field, I can also a create a single composite transform in ANTsR. I know this transform is correctly written to disk, because I if I directly apply (read from disk) it to the image I get the same image in screenshot. Thus the issue is not on ANTsR end.</p>
<p>However, if I load the composite transform and apply it to the image, this is what I get in Slicer:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/4/6/46120b9cfdf60ab58725d740e4c5bd237d7ba44a.jpeg" data-download-href="/uploads/short-url/9ZS5gx1nhPz1UlyMl6DGk8ut8pA.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46120b9cfdf60ab58725d740e4c5bd237d7ba44a_2_690x305.jpeg" alt="image" data-base62-sha1="9ZS5gx1nhPz1UlyMl6DGk8ut8pA" width="690" height="305" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46120b9cfdf60ab58725d740e4c5bd237d7ba44a_2_690x305.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46120b9cfdf60ab58725d740e4c5bd237d7ba44a_2_1035x457.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/4/6/46120b9cfdf60ab58725d740e4c5bd237d7ba44a_2_1380x610.jpeg 2x" data-dominant-color="9E9E9F"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1423×631 81 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>Any ideas why this might be the case?</p>

---

## Post #2 by @muratmaga (2022-11-29 19:42 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="1" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>Any ideas why this might be the case?</p>
</blockquote>
</aside>
<p>If it is helpful, there is this warning generated by Slicer specific to the composite transform:</p>
<blockquote>
<p>Warning: In /work/Stable/Slicer-0-build/vtkAddon/vtkOrientedGridTransform.cxx, line 335<br>
vtkOrientedGridTransform (0xbad5f80): InverseTransformPoint: no convergence (0, 34.7143, 224.571) error = 0.491319 after 500 iterations.  Further convergence warnings suppressed until transform is modified.</p>
</blockquote>

---

## Post #3 by @muratmaga (2022-11-30 16:24 UTC)

<p><a class="mention" href="/u/simonoxen">@simonoxen</a> do you have any experience with getting composite transforms from ANTs/ANTsX loaded into Slicer? Or have you encountered an issue like this?</p>

---

## Post #4 by @lassoan (2022-12-01 05:49 UTC)

<p>If you load the composite transform and click “Split” in the transforms module then do you see the same transform components as the ones you loaded separately? (maybe it is easier to compare them if you save to file)<br>
What ITK version is used in your ANTsR?<br>
Does thing work well if you use SlicerANTs?</p>
<aside class="quote no-group quote-modified" data-username="muratmaga" data-post="2" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>If it is helpful, there is this warning generated by Slicer specific to the composite transform:</p>
<blockquote>
<p>Warning: In /work/Stable/Slicer-0-build/vtkAddon/vtkOrientedGridTransform.cxx, line 335<br>
vtkOrientedGridTransform (0xbad5f80): InverseTransformPoint: no convergence (0, 34.7143, 224.571) error = 0.491319 after 500 iterations. Further convergence warnings suppressed until transform is modified.</p>
</blockquote>
</blockquote>
</aside>
<p>If you don’t see major issues when you visualize the transform (e.g., using Grid mode) then probably you can ignore this message.</p>
<p>Can you upload somewhere the separate transforms, the composite transform, the fixed and moving image and the image resampled with ANTs?</p>

---

## Post #5 by @muratmaga (2022-12-01 07:43 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="4" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>If you load the composite transform and click “Split” in the transforms module then do you see the same transform components as the ones you loaded separately? (maybe it is easier to compare them if you save to file)</p>
</blockquote>
</aside>
<p>I don’t see this button.</p>
<aside class="quote no-group" data-username="lassoan" data-post="4" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>What ITK version is used in your ANTsR?</p>
</blockquote>
</aside>
<pre><code class="lang-auto">&gt; itkVersion()
[1] "5.3"
&gt; itkTag()
[1] "v5.3rc04"
</code></pre>
<aside class="quote no-group" data-username="lassoan" data-post="4" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>If you don’t see major issues when you visualize the transform (e.g., using Grid mode) then probably you can ignore this message.</p>
</blockquote>
</aside>
<p>It is completely wrong. it somehow made into four images as shown in the screenshot.</p>
<aside class="quote no-group" data-username="lassoan" data-post="4" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>Can you upload somewhere the separate transforms, the composite transform, the fixed and moving image and the image resampled with ANTs?</p>
</blockquote>
</aside>
<p><a href="https://app.box.com/shared/static/re8czcysnryxoqkufwdlfxzz1x4yq4cw.mrb">here it is as an mrb file</a></p>

---

## Post #6 by @muratmaga (2022-12-01 07:52 UTC)

<p>I forgot to include the ANTsR resampled image. here is the link for that. <a href="https://app.box.com/shared/static/yk7vvhlaagcmkwlbl37s8y0hzjiqthss.nrrd" rel="noopener nofollow ugc">https://app.box.com/shared/static/yk7vvhlaagcmkwlbl37s8y0hzjiqthss.nrrd</a></p>

---

## Post #7 by @lassoan (2022-12-01 13:39 UTC)

<p>Thanks for the data sets. I don’t see any issue on my computer (Windows10, Slicer-5.2.1). The Composite transform and the Warp+Affine transform result in the exact same transformation (which is the same as the Ants-resampled image):</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/6/8/68daa28fa7f0bfbbe4642fca7a363b0c06d9ffc3.jpeg" data-download-href="/uploads/short-url/eXA4Yx2Wnlz3YSqjGpFgp7P5EQz.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/8/68daa28fa7f0bfbbe4642fca7a363b0c06d9ffc3_2_690x364.jpeg" alt="image" data-base62-sha1="eXA4Yx2Wnlz3YSqjGpFgp7P5EQz" width="690" height="364" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/8/68daa28fa7f0bfbbe4642fca7a363b0c06d9ffc3_2_690x364.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/8/68daa28fa7f0bfbbe4642fca7a363b0c06d9ffc3_2_1035x546.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/6/8/68daa28fa7f0bfbbe4642fca7a363b0c06d9ffc3_2_1380x728.jpeg 2x" data-dominant-color="7D7668"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1015 127 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>Check it on a few different computers to see if you see anything common between those that don’t work correctly.</p>

---

## Post #8 by @muratmaga (2022-12-01 16:02 UTC)

<p>Interesting that’s not what I am seeing on my end on windows 5.2.1</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/a/baa941a195adf32333bc2e4a77e68bfd59f73502.jpeg" data-download-href="/uploads/short-url/qDhrfQPQyrul8fD32CdQwNETsVs.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/a/baa941a195adf32333bc2e4a77e68bfd59f73502_2_690x305.jpeg" alt="image" data-base62-sha1="qDhrfQPQyrul8fD32CdQwNETsVs" width="690" height="305" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/a/baa941a195adf32333bc2e4a77e68bfd59f73502_2_690x305.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/a/baa941a195adf32333bc2e4a77e68bfd59f73502_2_1035x457.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/a/baa941a195adf32333bc2e4a77e68bfd59f73502_2_1380x610.jpeg 2x" data-dominant-color="787874"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1817×805 115 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #9 by @lassoan (2022-12-01 20:18 UTC)

<p>Try unzipping the scene files into a folder and load the .mrml file. Many things can go wrong when you open a 6GB zip file. Or it might be some rendering issue? Have you tried this on different computers/operating systems?</p>

---

## Post #10 by @muratmaga (2022-12-01 23:53 UTC)

<p>This happens to me both on Ubuntu 20.04 and windows 11 with 5.2.1</p>
<p>Can you make sure you zoom in, because if it simply centered on the reference image, you may not notice the deformations in the image. Better yet simply have only the moving image displayed, zoom in and slide across the stack. This is what I see:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/b/6/b6a631157fd327d3e26d6b38b7d76b66d894351a.jpeg" data-download-href="/uploads/short-url/q3MXKJs77Ey5lVpZumVpbst051U.jpeg?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/6/b6a631157fd327d3e26d6b38b7d76b66d894351a_2_690x181.jpeg" alt="image" data-base62-sha1="q3MXKJs77Ey5lVpZumVpbst051U" width="690" height="181" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/6/b6a631157fd327d3e26d6b38b7d76b66d894351a_2_690x181.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/6/b6a631157fd327d3e26d6b38b7d76b66d894351a_2_1035x271.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/b/6/b6a631157fd327d3e26d6b38b7d76b66d894351a_2_1380x362.jpeg 2x" data-dominant-color="6D6D72"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">2763×727 207 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---

## Post #11 by @lassoan (2022-12-02 01:29 UTC)

<p>I see what you mean now. If you zoom out then then you can some artifacts far, far away from the transform’s domain. The artifacts are due to that it is a grid transform with very large displacement vectors at the edge of the domain. Such artifacts are completely normal and you can safely ignore them.</p>
<div class="youtube-onebox lazy-video-container" data-video-id="0YI9U5LCi4w" data-video-title="Murat combined transform test 2" data-provider-name="youtube">
  <a href="https://www.youtube.com/watch?v=0YI9U5LCi4w" target="_blank" rel="noopener">
    <img class="youtube-thumbnail" src="https://img.youtube.com/vi/0YI9U5LCi4w/maxresdefault.jpg" title="Murat combined transform test 2" width="" height="">
  </a>
</div>

<p>Why are there artifacts?</p>
<p>The displacement is extrapolated outside the transform’s domain in a way that:</p>
<ol>
<li>The displacement vectors change changing at the edges of the transform domain (otherwise the transform would not be invertible, which is essential if you want to transform both images and meshes), and</li>
<li>At infinite distance from the transform’s domain the displacement converges to zero.</li>
</ol>
<p>If a transform has very large displacement at the edge of its domain then the extrapolation may have some large waves before the displacements converge to zero. When you zoom out then you see those large displacement waves far away from the transform’s domain.</p>
<p>How to avoid such displacement extrapolation artifacts?</p>
<p>If you want to avoid such extrapolation artifacts outside the image domain then the best is to keep the large linear rigid bulk transform and the remaining warping grid transform separate. Then the displacement vectors in the grid transform will be small and if there is any extrapolation, the displacements converge to zero very quickly, without any waves.</p>
<p>ITK can save these two transforms into a single transform file (that is a composite transform), but maybe this option is not made available in ANTs. If ANTs cannot save composite transforms then you need to educate users about ignoring extrapolation artifacts or teach them how to load and apply multiple transforms.</p>

---

## Post #12 by @muratmaga (2022-12-02 02:42 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="11" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>If you want to avoid such extrapolation artifacts outside the image domain then the best is to keep the large linear rigid bulk transform and the remaining warping grid transform separate.</p>
</blockquote>
</aside>
<p>Yes, that part is fine. When I apply the separate affine + warp transform as nested, I do not see those artifacts at all.</p>
<aside class="quote no-group" data-username="lassoan" data-post="11" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>ITK can save these two transforms into a single transform file (that is a composite transform), but maybe this option is not made available in ANTs</p>
</blockquote>
</aside>
<p>It is available, and that’s what the composite_transform is. That’s the one showing the artifacts when loaded into the Slicer.</p>

---

## Post #13 by @lassoan (2022-12-02 02:54 UTC)

<p>A composite transform file contains multiple transforms. The transform that is named as “moving-Forward-compositetx” is a simple grid transform that contains the total displacement for each point of the fixed image. You can see this in the “Information” section in Transforms module:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/e/ce816e72c1fabe5fac9fc874808d77383be2c733.png" data-download-href="/uploads/short-url/tsPFciJYOPb1DDenrZ7ltIoyxB9.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/e/ce816e72c1fabe5fac9fc874808d77383be2c733_2_539x500.png" alt="image" data-base62-sha1="tsPFciJYOPb1DDenrZ7ltIoyxB9" width="539" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/e/ce816e72c1fabe5fac9fc874808d77383be2c733_2_539x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/e/ce816e72c1fabe5fac9fc874808d77383be2c733.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/e/ce816e72c1fabe5fac9fc874808d77383be2c733.png 2x" data-dominant-color="F5F6F5"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">599×555 63.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>You can create a composite transform by hardening the warping transform on the bulk affine transform. The information section will look like this and the “Split” button will appear that allows the user to split the transform to its components:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/c/cce3811f0871b3a31e14c99f2a89de76df0afb1c.png" data-download-href="/uploads/short-url/tewPrYebmvS9DWI1TP2M8jcdCmU.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/c/cce3811f0871b3a31e14c99f2a89de76df0afb1c_2_460x500.png" alt="image" data-base62-sha1="tewPrYebmvS9DWI1TP2M8jcdCmU" width="460" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/c/c/cce3811f0871b3a31e14c99f2a89de76df0afb1c_2_460x500.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/c/cce3811f0871b3a31e14c99f2a89de76df0afb1c.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/c/c/cce3811f0871b3a31e14c99f2a89de76df0afb1c.png 2x" data-dominant-color="F3F2F2"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">634×688 110 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>

---

## Post #14 by @muratmaga (2022-12-02 17:13 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="13" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>You can create a composite transform by hardening the warping transform on the bulk affine transform. The information section will look like this and the “Split” button will appear that allows the user to split the transform to its components:</p>
</blockquote>
</aside>
<p>This is the command in ANTsR (and ANTs proper as well) to concatenate transforms into a single transforms. that’s what I used to generate the composite transform.</p>
<p><code>antsApplyTransforms(ref, moving, transformlist = c("moving-Warp.nii.gz", "moving-Affine.mat"), compose='./moving-Forward-compositetx')</code></p>
<p>Your method of hardening separate transforms in Slicer should be equivalent to this at the end. But the fact that I am seeing deformation artifacts in composite from ANTsR but not from the composite transform by hardening in Slicer tells me that something is going wrong when the original composite transform is applied to the image. I am not going to chase this any further, but I wanted to bring this up in case someone encounters this.</p>

---

## Post #15 by @lassoan (2022-12-02 18:27 UTC)

<aside class="quote no-group" data-username="muratmaga" data-post="14" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>This is the command in ANTsR (and ANTs proper as well) to concatenate transforms into a single transforms. that’s what I used to generate the composite transform.</p>
</blockquote>
</aside>
<p>Composite transform refers to a very specific thing in ITK: a transform that contains multiple transforms inside. Let’s use it only for this meaning to avoid misunderstandings. The <code>antsApplyTransforms</code> command does not create a composite transform.</p>
<p>The <code>antsApplyTransform</code> simply crates a grid transform by modifying a transform by another one. It is an irreversible, lossy operation, which fundamentally changes the properties of the transform (it may not be feasible to robustly invert or extrapolate it anymore), and may hugely increase the storage size (if the input contained warping transform, such as bspline or tps). There are some meaningful uses of this transform (it allows resampling an image in the transform’s domain without requiring someone to implement ITK transforms; or get a displacement field for statistical analysis), but in general, the <code>antsApplyTransform</code> command should be avoided for grid transforms.</p>
<aside class="quote no-group" data-username="muratmaga" data-post="14" data-topic="26498">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/muratmaga/48/3622_2.png" class="avatar"> muratmaga:</div>
<blockquote>
<p>But the fact that I am seeing deformation artifacts in composite from ANTsR but not from the composite transform by hardening in Slicer tells me that something is going wrong when the original composite transform is applied to the image.</p>
</blockquote>
</aside>
<p>It seems that in your workflow ANTs is not used properly. “General registration (ANTs)” in Slicer (provided by SlicerANTs extension) provides a composite transform as a result. You can have a look at <a href="https://github.com/netstim/SlicerANTs">SlicerANTs source code</a> to see how to achieve this.</p>

---
