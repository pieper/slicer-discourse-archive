# Amygdala Parametrization Issue

**Topic ID**: 24287
**Date**: 2022-07-12
**URL**: https://discourse.slicer.org/t/amygdala-parametrization-issue/24287

---

## Post #1 by @Khalid_Saifullah (2022-07-12 15:40 UTC)

<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/6/26d9a5fc8d1404cec42a0384b0fa6b209ef7903f.jpeg" data-download-href="/uploads/short-url/5xGs6PMDtdZkvvDDwnKK0o9f9oP.jpeg?dl=1" title="Screen Shot 2022-07-12 at 4.50.45 AM" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/2/26d9a5fc8d1404cec42a0384b0fa6b209ef7903f_2_690x447.jpeg" alt="Screen Shot 2022-07-12 at 4.50.45 AM" data-base62-sha1="5xGs6PMDtdZkvvDDwnKK0o9f9oP" width="690" height="447" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/2/26d9a5fc8d1404cec42a0384b0fa6b209ef7903f_2_690x447.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/2/26d9a5fc8d1404cec42a0384b0fa6b209ef7903f_2_1035x670.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/2/26d9a5fc8d1404cec42a0384b0fa6b209ef7903f_2_1380x894.jpeg 2x" data-dominant-color="574939"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screen Shot 2022-07-12 at 4.50.45 AM</span><span class="informations">1920×1246 150 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div><br>
Hi,</p>
<p>I am generating the spharm-pdm output of amygdala shapes for my shape analysis. Previously, I did it for hippocampus on around 400 subjects. Thank you <a class="mention" href="/u/styner">@styner</a>  for your support throughout.</p>
<p>For generating the spharm-pdm output files, in the “Advanced Parameters to SPHARM Mesh”, I am using “template_pp_surf_SPHARM.vtk” as my “Reg Template” file and “template_pp_surf_SPHARM.coef” as my “Flip Template” file. I have selected “No Flip” in the “Flip Options”. Let me know if there is a correction in this step, please.</p>
<p>Now, when I look at the output files from SPHARM-PDM, I can see the mismatch in the _paraphi color coded visualization (See the figure attached). Only subject 2, 4 &amp; 5 match with the template’s parametrization. I think this is due to the issue with object symmetry. Correct me if I am wrong. Now, in order to correct for this parametrization step, what should I do? After the parametrization correction on the “Subject_pp_surf_SPHARM.vtk” file, I am looking for the “Subject_pp_surf_SPHARM_procalign.vtk” file as the final output with the correct parametrization and procrustes alignment.</p>
<p>Regards,<br>
Khalid</p>

---

## Post #2 by @Khalid_Saifullah (2022-07-16 18:41 UTC)

<p>Hi <a class="mention" href="/u/styner">@styner</a>, could you direct me to the right person for the above issue, please?</p>

---

## Post #3 by @Khalid_Saifullah (2022-07-19 00:08 UTC)

<p>Hi <a class="mention" href="/u/bpaniagua">@bpaniagua</a>, do you have the answer to the above questions, please?</p>

---

## Post #4 by @styner (2022-08-17 13:57 UTC)

<p>Sorry I was out while you posted it and did not see it until now.</p>
<p>Indeed this is an issue of rotational symmetry and the correspondence generated by SPHARM-PDM (via the axes of it’s first order ellipsoid representation) is not sufficient to deal with this (and the amygdala is probably the most obvious brain structure to generate head aches in that regard as it is quite oblong or even spherical in shape).</p>
<p>The flip options only help when simple flips of the ellipsoid axes identification help with improving the correspondence, i.e. if right vs left, or anterior vs posterior, or inferior vs superior, are a problem, but not if you want to rotate the correspondence e.g. by 90 degrees of X degrees (as needs to be done for your amygdalae). So, for the issue present here, flipping won’t be enough.</p>
<p>SlicerSALT has a way to improve the correspondence using the spharm-pdm correspondence improvement: this needs fiducials (surface landmarks) on every surface (minimally three) to optimally rotate the spherical parametrization. This can be run as a separate module or as part of the main SPHARM-PDM generator module.</p>
<p>hope this helps<br>
Martin</p>

---

## Post #5 by @Khalid_Saifullah (2022-08-24 17:55 UTC)

<p>Hi <a class="mention" href="/u/styner">@styner</a>,</p>
<p>Thank you for the explaining the matter in details.</p>
<p>I am currently using the CLI modules which can be found within the contents of SLICERSALT software. Using “-NoParaAlign” option in Step 3 kind of takes care of the problem (given that my subjects are somewhat pre aligned from whole brain registration). And afterwards, the final procalign output files come out just fine from the SPHARM-PDM module (which I am using for my case). However, looking closely at the SPHARM.vtk files in shape population viewer with paraPhi and paraTheta vizualisation, I see that the correspondence are not that great for many of the subjects. I am wondering if using “spharm-pdm correspondence improvement” would help. Can you please let me know how to generate the fiducials for my 800 subjects? Also what would be the common unit sphere which needs to be given as an input?</p>
<p>Regards,<br>
Khalid Saifullah</p>

---

## Post #6 by @styner (2022-08-25 18:05 UTC)

<p>There is a tutorial. The Correspondence Improvement module uses the RigidAlignment tool from  GROUPS. Look at this tutorial - Step 1:</p><aside class="onebox pdf" data-onebox-src="https://github.com/jcfr/slicer-salt/blob/master/docs/GROUPS-Tutorial-July16_2018.pdf">
  <header class="source">

      <a href="https://github.com/jcfr/slicer-salt/blob/master/docs/GROUPS-Tutorial-July16_2018.pdf" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <a href="https://github.com/jcfr/slicer-salt/blob/master/docs/GROUPS-Tutorial-July16_2018.pdf" target="_blank" rel="noopener nofollow ugc"><span class="pdf-onebox-logo"></span></a>

<h3><a href="https://github.com/jcfr/slicer-salt/blob/master/docs/GROUPS-Tutorial-July16_2018.pdf" target="_blank" rel="noopener nofollow ugc">GROUPS-Tutorial-July16_2018.pdf</a></h3>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>The main thing is that you need landmarks/fiducials (in fcsv format) on each surfaces, which are then realigned in a groupwise rigid alignment. Commonly these fiducials would be placed by hand using Slicer or SlicerSALT, which is quite time consuming.  For your amygdalae, which do not really have easily identifiable landmarks (which makes shape analysis of the amygdala really difficult to compute and validate), you could use the try to use semi-landmarks that you automatically compute, e.g. by deforming a template amygdala (with a few manually placed landmarks) to each of your amygdalae and apply the deformation to the template landmarks, or simply an anterior-most point, posterior-most point etc (assuming the data is well aligned).<br>
The resulting correspondence from these semi-landmarks won’t be wonderful, but then no correspondence on the amygdala will look great (as it is really difficult to see/know when a given correspondence is great on a blob-like structure as the amygdala).<br>
Martin</p>

---
