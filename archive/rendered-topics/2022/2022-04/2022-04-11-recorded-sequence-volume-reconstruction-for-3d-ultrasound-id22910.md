# Recorded sequence volume reconstruction for 3D ultrasound

**Topic ID**: 22910
**Date**: 2022-04-11
**URL**: https://discourse.slicer.org/t/recorded-sequence-volume-reconstruction-for-3d-ultrasound/22910

---

## Post #1 by @Karl-Philippe (2022-04-11 16:41 UTC)

<p>Hi,</p>
<p>I work with tracked ultrasound and I am using the SlicerIGSIO Volume Reconstruction module to reconstruct a volume and then segment the liver using slicer.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/5/f/5f2c2e3ab2d4911b710006121ed2280c57cfe698.jpeg" data-download-href="/uploads/short-url/dzW106jOl5hZeSTTJsDmeevxJSE.jpeg?dl=1" title="Capture d’écran 2022-04-08 160857" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/5f2c2e3ab2d4911b710006121ed2280c57cfe698_2_690x374.jpeg" alt="Capture d’écran 2022-04-08 160857" data-base62-sha1="dzW106jOl5hZeSTTJsDmeevxJSE" width="690" height="374" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/5f2c2e3ab2d4911b710006121ed2280c57cfe698_2_690x374.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/5f2c2e3ab2d4911b710006121ed2280c57cfe698_2_1035x561.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/5/5f2c2e3ab2d4911b710006121ed2280c57cfe698_2_1380x748.jpeg 2x" data-dominant-color="666475"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Capture d’écran 2022-04-08 160857</span><span class="informations">1920×1041 144 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>I was able to correctly reconstruct a volume using the live reconstruction. However, I have some problems with the segmentation because the segmentation is interpolated in the orientation of the ultrasound slides and not in the orientation of the volume. Is this related to the frame of the volume? If not how can I fix this problem?</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/0/e/0e151bb7ffe9321cf0fe7e0f89210c20492001ad.png" data-download-href="/uploads/short-url/20zUlEK4K7Z45QVhswlhpgmRfB3.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/e/0e151bb7ffe9321cf0fe7e0f89210c20492001ad_2_690x372.png" alt="image" data-base62-sha1="20zUlEK4K7Z45QVhswlhpgmRfB3" width="690" height="372" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/e/0e151bb7ffe9321cf0fe7e0f89210c20492001ad_2_690x372.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/e/0e151bb7ffe9321cf0fe7e0f89210c20492001ad_2_1035x558.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/e/0e151bb7ffe9321cf0fe7e0f89210c20492001ad_2_1380x744.png 2x" data-dominant-color="4F5262"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1037 238 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>But also, I was looking forward to use the “Recorded sequence reconstruction” mode in order to obtain the volume to not have to use Plus and increase the volume reconstruction workflow. So, my question is, what exactly are the input files I need for the “Recorded sequence reconstruction” (input sequence browser and Input volume node). From the recording with Plus I obtained a igt.mha file that contains the image and tracking sequence (see attached to this post) but I don’t know how to succesfully sepate this file into sequence browser and Input volume node.</p>
<p>Thank you,</p>
<p>Scene files (Wetransfer link): <a href="https://we.tl/t-hkfXOULHsp" class="inline-onebox" rel="noopener nofollow ugc">WeTransfer - Send Large Files &amp; Share Photos Online - Up to 2GB Free</a></p>

---

## Post #2 by @lassoan (2022-04-11 19:00 UTC)

<p>You can click on the slice orientation warning button to align the slice views with the volume axes:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/0/9/09a237f8ca9837c17382a8482658322f31e349bd.png" data-download-href="/uploads/short-url/1ndQDOwBUa1kXpiu1hVnXw58kcR.png?dl=1" title="image"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/9/09a237f8ca9837c17382a8482658322f31e349bd_2_690x199.png" alt="image" data-base62-sha1="1ndQDOwBUa1kXpiu1hVnXw58kcR" width="690" height="199" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/9/09a237f8ca9837c17382a8482658322f31e349bd_2_690x199.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/0/9/09a237f8ca9837c17382a8482658322f31e349bd_2_1035x298.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/0/9/09a237f8ca9837c17382a8482658322f31e349bd.png 2x" data-dominant-color="DFE7EB"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1039×301 21.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Alternatively, if you want to segment on oblique slices then read the <a href="https://lassoan.github.io/SlicerSegmentationRecipes/ObliqueSliceSegmentation/">oblique slice segmentation recipe</a>.</p>

---

## Post #3 by @Karl-Philippe (2022-04-12 08:28 UTC)

<p>Thanks <a class="mention" href="/u/lassoan">@lassoan</a>, this is very helpful, I didn’t know about this feature and oblique slice sementation.</p>
<p>Otherwise what are the files to pass as parameters for the “Recorded sequence reconstruction” in the volume reconstruction module? And is it possible to get thoses files from a tracked image sequence (igt.mha) ?</p>

---

## Post #4 by @Sunderlandkyl (2022-04-12 13:05 UTC)

<p>If you drag and drop the recorded igs.mha into Slicer, it should create a sequence browser + sequence for the images/transforms.</p>
<p>After setting up the transform hierarchy to put the image in the correct reference frame, you can select the sequence browser and image for volume reconstruction.</p>

---

## Post #5 by @Karl-Philippe (2022-04-12 15:48 UTC)

<p>Thanks <a class="mention" href="/u/sunderlandkyl">@Sunderlandkyl</a>, I was already able to do this with the example data provided in the IGT slicer tutorial, however I have some problems with my own data (obtained with the remote recording plus function, see the configuration files below). First of all, the images extracted from the igt.mha file are not in the right format (see below, images of the imported sequence in volume):<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/0/7059c748c70e2e4c8c4c9437cd12f1282b96f442.png" data-download-href="/uploads/short-url/g1TPdGD6eVVDe2C70Qf8HDsRhBg.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/0/7059c748c70e2e4c8c4c9437cd12f1282b96f442_2_690x374.png" alt="image" data-base62-sha1="g1TPdGD6eVVDe2C70Qf8HDsRhBg" width="690" height="374" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/0/7059c748c70e2e4c8c4c9437cd12f1282b96f442_2_690x374.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/0/7059c748c70e2e4c8c4c9437cd12f1282b96f442_2_1035x561.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/7/0/7059c748c70e2e4c8c4c9437cd12f1282b96f442_2_1380x748.png 2x" data-dominant-color="303038"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1041 159 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>After modifying the .mha file header (transform, ElementNumberOfChannels and DimSize) to display the images in the axial plane and reducing from 3 to 1 channel (to display only one capture at a time and not 3 by 3), I can display the ultrasound image correctly (correct orientation and format) when I import the sequence as a volume.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/5/e5351bbe618c712a2b922b5be3439e4945cc625a.png" data-download-href="/uploads/short-url/wHF7K6SvSGcfFbiiHPg6WCKXXnk.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/5/e5351bbe618c712a2b922b5be3439e4945cc625a_2_690x373.png" alt="image" data-base62-sha1="wHF7K6SvSGcfFbiiHPg6WCKXXnk" width="690" height="373" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/5/e5351bbe618c712a2b922b5be3439e4945cc625a_2_690x373.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/5/e5351bbe618c712a2b922b5be3439e4945cc625a_2_1035x559.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/5/e5351bbe618c712a2b922b5be3439e4945cc625a_2_1380x746.png 2x" data-dominant-color="313139"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1039 104 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>However, when I import the igt.mha sequence as a sequence in slicer I only get a slice of the Ultrasound image sequence.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/e/ee916c0c8567079eac2e59a77fccdfb10fad3bc7.png" data-download-href="/uploads/short-url/y2tcBvCP0jquejtYcWUkCW196HZ.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/e/ee916c0c8567079eac2e59a77fccdfb10fad3bc7_2_690x373.png" alt="image" data-base62-sha1="y2tcBvCP0jquejtYcWUkCW196HZ" width="690" height="373" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/e/ee916c0c8567079eac2e59a77fccdfb10fad3bc7_2_690x373.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/e/ee916c0c8567079eac2e59a77fccdfb10fad3bc7_2_1035x559.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/e/e/ee916c0c8567079eac2e59a77fccdfb10fad3bc7_2_1380x746.png 2x" data-dominant-color="2F2F37"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1038 72.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>How can I solve this problem? Is the .mha transformation matrix in the header read when it is imported as a sequence in slicer? Otherwise, is this a configuration problem?</p>
<p>Here are attached my plus server aquisition and files, and my original and edited (to obtain the image in the right format and orientation): <a href="https://we.tl/t-v2HonukPti" class="inline-onebox" rel="noopener nofollow ugc">WeTransfer - Send Large Files &amp; Share Photos Online - Up to 2GB Free</a></p>

---

## Post #6 by @Karl-Philippe (2022-05-06 13:00 UTC)

<p>Update:</p>
<p>Regarding the image decoding issue, I’m pretty sure it’s a bug in PLUS when recording in RGB_COLOR mode (causing a mismatch between the NDims=3 and DimSize parameters containing 4 in the .mha sequence file) that was resolved by recording the ultrasound images in BRIGHTNESS mode.</p>
<p>However, I still have problems with the volume reconstruction. The volume I get from the recorded sequence reconstruction looks resampled/reconstructed in a different plane than the image. Could this be a calibration problem? If so, where to define this calibration matrix to reconstruct the volume in the right orientation?</p>
<p>Thanks a lot,</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/f/b/fb3b32732dc96e59c6628986595709de8b88fb7b.jpeg" data-download-href="/uploads/short-url/zQuFNHyK1WCNjnmfm32bL6tS2Ez.jpeg?dl=1" title="Volume reconstruction.PNG" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/f/fb3b32732dc96e59c6628986595709de8b88fb7b_2_682x500.jpeg" alt="Volume reconstruction.PNG" data-base62-sha1="zQuFNHyK1WCNjnmfm32bL6tS2Ez" width="682" height="500" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/f/fb3b32732dc96e59c6628986595709de8b88fb7b_2_682x500.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/f/fb3b32732dc96e59c6628986595709de8b88fb7b_2_1023x750.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/f/b/fb3b32732dc96e59c6628986595709de8b88fb7b.jpeg 2x" data-dominant-color="2D2B32"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Volume reconstruction.PNG</span><span class="informations">1296×949 148 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>

---
