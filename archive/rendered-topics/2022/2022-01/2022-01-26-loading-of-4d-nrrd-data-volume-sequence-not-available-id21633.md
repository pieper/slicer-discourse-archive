---
topic_id: 21633
title: "Loading Of 4D Nrrd Data Volume Sequence Not Available"
date: 2022-01-26
url: https://discourse.slicer.org/t/21633
---

# Loading of 4D nrrd data - Volume Sequence not available

**Topic ID**: 21633
**Date**: 2022-01-26
**URL**: https://discourse.slicer.org/t/loading-of-4d-nrrd-data-volume-sequence-not-available/21633

---

## Post #1 by @kafux (2022-01-26 14:04 UTC)

<p>Dear all,</p>
<p>I am trying to load a 4D nrrd file with size 256x256x120x20 (4D MRI data).</p>
<p>However, it seems that the fourth dimension is not detected.</p>
<p>The header of the file is the following:</p>
<pre><code class="lang-auto">NRRD0004
# Complete NRRD file format specification at:
# http://teem.sourceforge.net/nrrd/format.html
type: float
dimension: 4
sizes: 256 256 120 20
thicknesses: 1.7578125 1.7578125 1.8 6.9515382523280928e-310
kinds: space space space time
labels: "x" "y" "z" "t"
endian: little
encoding: raw
# PatientPos order is Sag, Cor, Tra in mm
ImageOffset:=-215.285, -214.737, 109.759
SliceOrientation:=0
PatientPos:=-215.285, -214.737, -108.859
</code></pre>
<p>Am I missing something?</p>
<p>Thanks in advance!</p>

---

## Post #2 by @lassoan (2022-01-27 05:44 UTC)

<p>See how you can create a valid 4D volume <a href="https://slicer.readthedocs.io/en/latest/developer_guide/script_repository/sequences.html?highlight=nrrd#create-a-4d-volume-in-python-outside-slicer">here</a>.</p>
<p>Note that the image geometry fields are not set correctly in your example above. You can drop the custom fields (<code>ImageOffset</code>, <code>SliceOrientation</code>, <code>PatientPos</code>) and properly set the image geometry in the standard <code>space directions</code> (from <code>Image Position Patient</code> of the first slice) and <code>space origin</code> fields  (from <code>Image Orientation Patient</code> and <code>Pixel Spacing</code> DICOM tags and slice spacing that you compute from difference of <code>Image Position Patient</code> values in neighbor slices). The <code>thicknesses</code> field can be safely removed, too, as it is not used anywhere (slice thickness is not used when a 3D volume is reconstructed from slices). If the image header was generated by some software package and not just a result of your experimentation then notify the developer of that package that the changes are needed.</p>
<p>What kind of volume are you trying to load? A 4D cardiac CT, ultrasound, MRI…? Slicer should be able to load them correctly as a volume sequence.</p>

---

## Post #3 by @kafux (2022-01-27 08:38 UTC)

<p>Dear Andras,</p>
<p>many thanks for your reply.</p>
<p>The data is 4D MRI reconstructed from a 3D MRI dataset.<br>
Using your hints I will reiterate the generation of the data header within the reconstruction process.</p>

---

## Post #4 by @kafux (2022-01-27 12:00 UTC)

<p>Unfortunately, after changing the geometry fields as described, I am still not able to load the dataset into Slicer.<br>
The header now is the following:</p>
<pre><code class="lang-auto">NRRD0005
# This NRRD file was generated by pynrrd
# on 2022-01-27 11:44:32(GMT).
# Complete NRRD file format specification at:
# http://teem.sourceforge.net/nrrd/format.html
type: float
dimension: 4
space: left-posterior-superior
sizes: 256 256 120 20
space directions: (1.7578100000000001,0,0) (0,1.7578100000000001,0) (0,0,1.7999999999999972) none
kinds: domain domain domain time
endian: little
encoding: gzip
space origin: (-215.285,-214.73699999999999,105.34099999999999)
</code></pre>
<p>Additionally, I took the original 3D MRI Dicom data, loaded it into Slicer and saved ist as .nrrd to check on the header which looks like this:</p>
<pre><code class="lang-auto">NRRD0004
# Complete NRRD file format specification at:
# http://teem.sourceforge.net/nrrd/format.html
type: unsigned short
dimension: 3
space: left-posterior-superior
sizes: 256 256 120
space directions: (1.7578099999999999,0,0) (0,1.7578099999999999,0) (0,0,1.7999999999999996)
kinds: domain domain domain
endian: little
encoding: gzip
space origin: (-215.285,-214.73699999999999,105.34099999999998)
</code></pre>
<p>For me (as a Slicer/nrrd beginner) the header that was generated for the 4D dataset looks reasonable.</p>
<p>Might there be any other issue with the header or data?</p>
<p>An additional information: using other tools like e.g. Matlab I was able to read the data, so that I can assume that the dataset is not corrupt.</p>
<p>I would be happy about any hints, thanks in advance.</p>

---

## Post #5 by @lassoan (2022-01-27 14:01 UTC)

<p>This looks much better now! By default, NRRD fines are loaded as a 3D volume. You can either change the file extension to .seq.nrrd to change the default to “Volume Sequence” or select that in the Description column in the “Add data” window manually.</p>
<p>Have your tried to reconstruct the 4D data using SlicerIGSIO extension? See an example here:</p>
<div class="youtube-onebox lazy-video-container" data-video-id="hIxr9OKBvQ8" data-video-title="Reconstruct 3D or 4D cardiac volumes from sparse 2D frame set" data-provider-name="youtube">
  <a href="https://www.youtube.com/watch?v=hIxr9OKBvQ8" target="_blank" rel="noopener">
    <img class="youtube-thumbnail" src="https://img.youtube.com/vi/hIxr9OKBvQ8/maxresdefault.jpg" title="Reconstruct 3D or 4D cardiac volumes from sparse 2D frame set" width="" height="">
  </a>
</div>


---

## Post #6 by @kafux (2022-01-28 09:36 UTC)

<p>Thanks for coming back again to this question.</p>
<p>Unfortunately, the option “Volume Seqeunce” is not listed in the Description column.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/c/ec680a86674e134d6d818617fc1a6da930148683.jpeg" data-download-href="/uploads/short-url/xJlAAhmwPYNd8SHUt75iwO9VW8z.jpeg?dl=1" title="AddData" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/e/ec680a86674e134d6d818617fc1a6da930148683_2_690x197.jpeg" alt="AddData" data-base62-sha1="xJlAAhmwPYNd8SHUt75iwO9VW8z" width="690" height="197" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/2X/e/ec680a86674e134d6d818617fc1a6da930148683_2_690x197.jpeg, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/c/ec680a86674e134d6d818617fc1a6da930148683.jpeg 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/e/c/ec680a86674e134d6d818617fc1a6da930148683.jpeg 2x" data-dominant-color="DDDEDE"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">AddData</span><span class="informations">927×265 31.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
I tried to choose “Sequence” in the Description column which lead to the following error message:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/e/2e2f0860adbb28c109d97ccb33e24e56445f3dbf.png" data-download-href="/uploads/short-url/6AyJj9DAFWPBph18swB6y7i2x6n.png?dl=1" title="ErrorSequence" rel="noopener nofollow ugc"><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/e/2e2f0860adbb28c109d97ccb33e24e56445f3dbf_2_690x197.png" alt="ErrorSequence" data-base62-sha1="6AyJj9DAFWPBph18swB6y7i2x6n" width="690" height="197" srcset="https://us1.discourse-cdn.com/flex002/uploads/slicer/optimized/3X/2/e/2e2f0860adbb28c109d97ccb33e24e56445f3dbf_2_690x197.png, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/e/2e2f0860adbb28c109d97ccb33e24e56445f3dbf.png 1.5x, https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/2/e/2e2f0860adbb28c109d97ccb33e24e56445f3dbf.png 2x" data-dominant-color="E2E2E2"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">ErrorSequence</span><span class="informations">927×265 30.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>The version of Slicer I am using is 4.11.20210226.</p>
<p>Thank you for suggesting the SlicerIGSIO. After having a quick look, I guess that for our case this is not applicable, since we extract breathing information from the data in the reconstruction phase to sort the data accordingly.</p>

---

## Post #7 by @lassoan (2022-01-28 17:08 UTC)

<p>Please use the latest Slicer Preview Release and let us know if you still have questions.</p>

---

## Post #8 by @kafux (2022-01-31 10:38 UTC)

<p>Thank you for the suggestion.<br>
Now using version 4.13.0-2022-01-28 the issue remains, still not showing the Option “Volume Sequence” but bringing up the following error message:</p>
<p><img src="https://us1.discourse-cdn.com/flex002/uploads/slicer/original/3X/7/7/77619569b4c563db08a89bf96053b1f820d10fa3.jpeg" alt="AddingDataFailed" data-base62-sha1="h25TeUK3CaK3MILLYdre8EKYNN1" width="436" height="207"></p>
<p>One thing I was thinking about is, if the fourth entry “none” in space directions is correct?<br>
I would assume yes, but running out of ideas here.</p>

---
