---
topic_id: 7126
title: "Import Of Itk Transform File Failed"
date: 2019-06-11
url: https://discourse.slicer.org/t/7126
---

# Import of ITK transform file failed

**Topic ID**: 7126
**Date**: 2019-06-11
**URL**: https://discourse.slicer.org/t/import-of-itk-transform-file-failed/7126

---

## Post #1 by @mangotee (2019-06-11 14:47 UTC)

<p>Hi,</p>
<p>I am trying to import an affine transform that was computed with ANTs. I cannot attach the transform file, but it is a simple textfile with a .txt file ending. You can reproduce the error by copy&amp;pasting the contents below into a transform.txt file and loading it into Slicer. On my system, the file was first interpreted as a “Color” file in the file loading dialog. After changing the file type to “Transform”, the error message is:</p>
<blockquote>
<p>Could not create an instance of “MatrixOffsetTransformBase_double_3_3”<br>
The usual cause of this error is not registering the transform with TransformFactory</p>
</blockquote>
<p>The funny thing is that I can usually load transforms (linear and non-linear) that were generated by ANTs. Not sure why this suddenly does not work anymore (by the way, I tried Slicer 4.9.0 and the 4.11.0 nightly from 2019-06-02). Any help with this is appreciated!<br>
Here are the contents of the transform file:</p>
<p><span class="hashtag-raw">#Insight</span> Transform File V1.0<br>
<span class="hashtag-raw">#Transform</span> 0<br>
Transform: MatrixOffsetTransformBase_double_3_3<br>
Parameters: 1.0133883914175723 -0.007097997510931725 0.010305303746152204 0.006178933359632762 1.040581088926752 -0.05537898237481463 -0.01029277753621562 0.041969790000422336 0.9962926407286504 0.25692648074325647 0.26014893150818796 -0.08923845189838553<br>
FixedParameters: 0.34716075829563664 0.4464191942953437 -0.7178585998314816</p>
<p>Cheers,<br>
Ahmad</p>

---

## Post #2 by @lassoan (2019-06-11 16:07 UTC)

<p>Can you load the file if you save it in .h5 file format? Or, if you convert the transform to AffineTransform_double_3_3 before saving it?</p>

---

## Post #3 by @mangotee (2019-06-11 16:51 UTC)

<aside class="quote no-group" data-username="lassoan" data-post="2" data-topic="7126">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://sea2.discourse-cdn.com/flex020/user_avatar/discourse.slicer.org/lassoan/48/13_2.png" class="avatar"> lassoan:</div>
<blockquote>
<p>AffineTransform_double_3_3</p>
</blockquote>
</aside>
<p>Hi Andras,<br>
thx for the quick response.<br>
If I change the “Transform” tag in the txt file to “AffineTransform_double_3_3”, it correctly load the transform. The problem is that this txt file is part of the output from ANTs template building. I could manually correct this tag in all the files (e.g. with a script), but in the past, these files were loaded without error. In fact, I remember that I <a href="https://discourse.slicer.org/t/affine-matrices-insight-format-with-tag-matrixoffsettransformbase-double-3-3-cannot-be-loaded-into-slicer-anymore/2302">had this error before</a>, and back then, it was identified as a bug and it was fixed.<br>
Would you recommend me to change this tag in all files?</p>

---

## Post #4 by @lassoan (2019-06-11 19:04 UTC)

<p><code>MatrixOffsetTransformBase</code> is <a href="https://github.com/InsightSoftwareConsortium/ITK/blob/master/Modules/IO/TransformFactory/src/itkTransformFactoryBaseRegister.hxx" rel="nofollow noopener">not registered in the ITK transform factory</a>.</p>
<p>By executing these factory registrations, we could make <code>MatrixOffsetTransformBase</code> transform load:</p>
<pre><code>itk::TransformFactory&lt; itk::MatrixOffsetTransformBase&lt;float, 3&gt; &gt;::RegisterTransform();
itk::TransformFactory&lt; itk::MatrixOffsetTransformBase&lt;double, 3&gt; &gt;::RegisterTransform();
</code></pre>
<p>However, I’m not sure that registering transform factory for this base class is the right thing to do. Probably it was not left out from <code>itkTransformFactoryBaseRegister</code> by accident, but because it is not supposed to be instantiated. Could you please clarify with ANTs/ITK developers why the transform is written to file as <code>MatrixOffsetTransformBase</code> instead of some concrete child class?</p>

---

## Post #5 by @mangotee (2019-06-12 08:28 UTC)

<p>Thanks a lot <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> I will post my problem and your question in the ANTs forum.<br>
For future reference and others who might be having this problem: Following your suggestion, I searched the ANTs forum for the <code>MatrixOffsetTransformBase</code> tag, and found <a href="https://sourceforge.net/p/advants/discussion/840260/thread/f56e2cdd/?limit=25#7b87" rel="nofollow noopener">this thread</a>. It pointed me to a utility program I didn’t know about before, “ConvertTransformFile”. It can convert the .txt file to an affine .mat transform, by using the flag <code>--convertToAffineType</code>. Citing the documentation, “this is useful for using transforms in programs that do not register all available Transform factory types”. After conversion, Slicer loads the transform file.<br>
Thanks again for the help!</p>

---

## Post #6 by @lassoan (2019-06-12 14:30 UTC)

<p>If MatrixOffsetTransformBase is a valid choice then it should be added to the list of transforms registered by ITK by default. If ITK developers think that it is not appropriate to write this base class to file then ANTS should be changed to write it as affine (or other concrete transform class that is registered by ITK by default).</p>

---
